import { c, canvas, gameState, GameState } from './constants.js';
import { Setgame_started } from './PlatformView.js';
export default class Menu {
    constructor(Game_History) {
        this.title = "⏱️ Chrono Clash";
        this.options = ["▶ Start", "⚙ Options", "☷ History", "✖ Quit"];
        this.selectedOption = 0;
        this.optionSpacing = 60;
        this.titleFont = "bold 60px 'Press Start 2P', Black Ops One";
        this.optionFont = "30px 'Press Start 2P', Black Ops One";
        this.bgImage = new Image();
        this.bgImage.src = "/srcs/game/assets/City/bg_menu3.jpg";
        this.bgImageLoaded = false;
        this.bgImage.onload = () => {
            this.bgImageLoaded = true;
        };
        this.Game_History = Game_History;
        this.keyPressed = {};
        this.boundKeyDown = this.handleKeyDown.bind(this);
        this.boundKeyUp = this.handleKeyUp.bind(this);
        this.optionStart = 0;
        this.optionOptions = 1;
        this.optionHistory = 2;
        this.optionQuit = 3;
    }
    enableControls() {
        window.addEventListener("keydown", this.boundKeyDown);
        window.addEventListener("keyup", this.boundKeyUp);
    }
    disableControls() {
        window.removeEventListener("keydown", this.boundKeyDown);
        window.removeEventListener("keyup", this.boundKeyUp);
    }
    draw() {
        this.enableControls();
        c.fillStyle = "rgba(0, 0, 0, 0.75)";
        c.fillRect(0, 0, canvas.width, canvas.height);
        if (this.bgImageLoaded) {
            c.drawImage(this.bgImage, 0, 0, canvas.width, canvas.height);
        }
        c.font = this.titleFont;
        c.textAlign = "center";
        c.fillStyle = "#FFD700";
        c.shadowColor = "#000";
        c.shadowBlur = 10;
        c.fillText(this.title, canvas.width / 2, canvas.height / 4);
        c.shadowBlur = 0;
        c.font = this.optionFont;
        this.options.forEach((option, index) => {
            if (option === "✖ Quit" && index === this.selectedOption) {
                c.fillStyle = "red"; // Rouge si "Retour" est sélectionné
            }
            else if (index === this.selectedOption) {
                c.fillStyle = "#00FFFF"; // Bleu si autre option sélectionnée
            }
            else {
                c.fillStyle = "white"; // Sinon blanc
            }
            c.fillText(option, canvas.width / 2, canvas.height / 2 + index * this.optionSpacing);
        });
    }
    handleKeyDown(event) {
        const key = event.key;
        if (this.keyPressed[key])
            return;
        this.keyPressed[key] = true;
        if (gameState.current !== GameState.Menu)
            return;
        console.log("selectedOption = ", this.selectedOption);
        console.log("options = ", this.options);
        console.log("option.index = ", this.options.indexOf(this.options[this.selectedOption]));
        switch (key) {
            case "ArrowUp":
            case "w":
                this.selectedOption = (this.selectedOption - 1 + this.options.length) % this.options.length;
                break;
            case "ArrowDown":
            case "s":
                this.selectedOption = (this.selectedOption + 1) % this.options.length;
                break;
            case "Enter":
                this.handleSelect();
                break;
        }
    }
    handleKeyUp(event) {
        this.keyPressed[event.key] = false;
    }
    handleSelect() {
        const selected = this.options[this.selectedOption];
        console.log("Selected option:", selected);
        if (selected === "▶ Start") {
            this.disableControls();
            gameState.previous = gameState.current;
            gameState.current = GameState.MapMenu;
        }
        else if (selected === "⚙ Options") {
            this.disableControls();
            console.log("Open options");
            gameState.previous = gameState.current;
            gameState.current = GameState.Options;
        }
        else if (selected === "✖ Quit") {
            this.selectedOption = 0;
            this.disableControls();
            gameState.previous = GameState.Menu;
            gameState.current = GameState.Menu;
            Setgame_started(false);
            // window.close();
        }
        else if (selected === "☷ History") {
            this.disableControls();
            console.log("History selected");
            console.log("this.Game_History = ", this.Game_History);
            if (typeof this.Game_History.Game_History.saveGameIfNeeded === "function") {
                console.log("this.Game_History.Game_History.saveGameIfNeeded()");
                this.Game_History.Game_History.saveGameIfNeeded();
            }
            gameState.previous = gameState.current;
            gameState.current = GameState.GameHistory;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVudS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3B1YmxpYy9zdGF0aWMvanMvdmlld3MvcGxhdGZvcm1lci9NZW51LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFcEQsTUFBTSxDQUFDLE9BQU8sT0FBTyxJQUFJO0lBQ3hCLFlBQVksWUFBWTtRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLGlCQUFpQixDQUFDO1FBQy9CLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUUsQ0FBQztRQUNoRSxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsU0FBUyxHQUFHLDJDQUEyQyxDQUFDO1FBQzdELElBQUksQ0FBQyxVQUFVLEdBQUcsc0NBQXNDLENBQUM7UUFFekQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLHFDQUFxQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBQzNCLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtZQUMxQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztRQUMzQixDQUFDLENBQUE7UUFDRCxJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUVqQyxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxh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LENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFDaEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDdkQsSUFBSSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLGdCQUFnQixLQUFLLFVBQVUsRUFDekUsQ0FBQztnQkFDQSxPQUFPLENBQUMsR0FBRyxDQUFDLG1EQUFtRCxDQUFDLENBQUM7Z0JBQ2pFLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDbkQsQ0FBQztZQUNELFNBQVMsQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQztZQUN2QyxTQUFTLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUM7UUFDM0MsQ0FBQztJQUNGLENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGMsIGNhbnZhcywgZ2FtZVN0YXRlLCBHYW1lU3RhdGUgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBTZXRnYW1lX3N0YXJ0ZWQgfSBmcm9tICcuL1BsYXRmb3JtVmlldy5qcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lbnUge1xuXHRjb25zdHJ1Y3RvcihHYW1lX0hpc3RvcnkpIHtcblx0XHR0aGlzLnRpdGxlID0gXCLij7HvuI8gQ2hyb25vIENsYXNoXCI7XG5cdFx0dGhpcy5vcHRpb25zID0gW1wi4pa2IFN0YXJ0XCIsIFwi4pqZIE9wdGlvbnNcIiwgXCLimLcgSGlzdG9yeVwiLCBcIuKcliBRdWl0XCIgXTtcblx0XHR0aGlzLnNlbGVjdGVkT3B0aW9uID0gMDtcblx0XHR0aGlzLm9wdGlvblNwYWNpbmcgPSA2MDtcblx0XHR0aGlzLnRpdGxlRm9udCA9IFwiYm9sZCA2MHB4ICdQcmVzcyBTdGFydCAyUCcsIEJsYWNrIE9wcyBPbmVcIjtcblx0XHR0aGlzLm9wdGlvbkZvbnQgPSBcIjMwcHggJ1ByZXNzIFN0YXJ0IDJQJywgQmxhY2sgT3BzIE9uZVwiO1xuXG5cdFx0dGhpcy5iZ0ltYWdlID0gbmV3IEltYWdlKCk7XG5cdFx0dGhpcy5iZ0ltYWdlLnNyYyA9IFwiL3NyY3MvZ2FtZS9hc3NldHMvQ2l0eS9iZ19tZW51My5qcGdcIjtcblx0XHR0aGlzLmJnSW1hZ2VMb2FkZWQgPSBmYWxzZTtcblx0XHR0aGlzLmJnSW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuXHRcdFx0dGhpcy5iZ0ltYWdlTG9hZGVkID0gdHJ1ZTtcblx0XHR9XG5cdFx0dGhpcy5HYW1lX0hpc3RvcnkgPSBHYW1lX0hpc3Rvcnk7XG5cblx0XHR0aGlzLmtleVByZXNzZWQgPSB7fTtcblx0XHR0aGlzLmJvdW5kS2V5RG93biA9IHRoaXMuaGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpO1xuXHRcdHRoaXMuYm91bmRLZXlVcCA9IHRoaXMuaGFuZGxlS2V5VXAuYmluZCh0aGlzKTtcblx0XHR0aGlzLm9wdGlvblN0YXJ0ID0gMDtcblx0XHR0aGlzLm9wdGlvbk9wdGlvbnMgPSAxO1xuXHRcdHRoaXMub3B0aW9uSGlzdG9yeSA9IDI7XG5cdFx0dGhpcy5vcHRpb25RdWl0ID0gMztcblxuXHRcdFxuXHR9XG5cblx0ZW5hYmxlQ29udHJvbHMoKSB7XG5cblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5ib3VuZEtleURvd24pO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5ib3VuZEtleVVwKTtcblx0fVxuXG5cdGRpc2FibGVDb250cm9scygpIHtcblx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5ib3VuZEtleURvd24pO1xuXHRcdHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5ib3VuZEtleVVwKTtcblx0fVxuXG5cdGRyYXcoKSB7XG5cdFx0dGhpcy5lbmFibGVDb250cm9scygpO1xuXG5cdFx0Yy5maWxsU3R5bGUgPSBcInJnYmEoMCwgMCwgMCwgMC43NSlcIjtcblx0XHRjLmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cdFx0aWYgKHRoaXMuYmdJbWFnZUxvYWRlZCkge1xuXHRcdFx0Yy5kcmF3SW1hZ2UodGhpcy5iZ0ltYWdlLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXHRcdH1cblxuXG5cdFx0Yy5mb250ID0gdGhpcy50aXRsZUZvbnQ7XG5cdFx0Yy50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuXHRcdGMuZmlsbFN0eWxlID0gXCIjRkZENzAwXCI7XG5cdFx0Yy5zaGFkb3dDb2xvciA9IFwiIzAwMFwiO1xuXHRcdGMuc2hhZG93Qmx1ciA9IDEwO1xuXHRcdGMuZmlsbFRleHQodGhpcy50aXRsZSwgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAvIDQpO1xuXHRcdGMuc2hhZG93Qmx1ciA9IDA7XG5cblx0XHRjLmZvbnQgPSB0aGlzLm9wdGlvbkZvbnQ7XG5cdFx0dGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbiwgaW5kZXgpID0+IHtcblx0XHRcdGlmIChvcHRpb24gPT09IFwi4pyWIFF1aXRcIiAmJiBpbmRleCA9PT0gdGhpcy5zZWxlY3RlZE9wdGlvbikge1xuXHRcdFx0XHRjLmZpbGxTdHlsZSA9IFwicmVkXCI7IC8vIFJvdWdlIHNpIFwiUmV0b3VyXCIgZXN0IHPDqWxlY3Rpb25uw6lcblx0XHRcdH0gZWxzZSBpZiAoaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRPcHRpb24pIHtcblx0XHRcdFx0Yy5maWxsU3R5bGUgPSBcIiMwMEZGRkZcIjsgLy8gQmxldSBzaSBhdXRyZSBvcHRpb24gc8OpbGVjdGlvbm7DqWVcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiOyAvLyBTaW5vbiBibGFuY1xuXHRcdFx0fVxuXHRcdFx0Yy5maWxsVGV4dChvcHRpb24sIGNhbnZhcy53aWR0aCAvIDIsIGNhbnZhcy5oZWlnaHQgLyAyICsgaW5kZXggKiB0aGlzLm9wdGlvblNwYWNpbmcpO1xuXHRcdH0pO1xuXHR9XG5cblx0aGFuZGxlS2V5RG93bihldmVudCkge1xuXHRcdGNvbnN0IGtleSA9IGV2ZW50LmtleTtcblx0XHRpZiAodGhpcy5rZXlQcmVzc2VkW2tleV0pIHJldHVybjtcblx0XHR0aGlzLmtleVByZXNzZWRba2V5XSA9IHRydWU7XG5cblx0XHRpZiAoZ2FtZVN0YXRlLmN1cnJlbnQgIT09IEdhbWVTdGF0ZS5NZW51KSByZXR1cm47XG5cdFx0Y29uc29sZS5sb2coXCJzZWxlY3RlZE9wdGlvbiA9IFwiLCB0aGlzLnNlbGVjdGVkT3B0aW9uKTtcblx0XHRjb25zb2xlLmxvZyhcIm9wdGlvbnMgPSBcIiwgdGhpcy5vcHRpb25zKTtcblx0XHRjb25zb2xlLmxvZyhcIm9wdGlvbi5pbmRleCA9IFwiLCB0aGlzLm9wdGlvbnMuaW5kZXhPZih0aGlzLm9wdGlvbnNbdGhpcy5zZWxlY3RlZE9wdGlvbl0pKTtcblxuXHRcdHN3aXRjaCAoa2V5KSB7XG5cdFx0XHRjYXNlIFwiQXJyb3dVcFwiOlxuXHRcdFx0Y2FzZSBcIndcIjpcblx0XHRcdFx0dGhpcy5zZWxlY3RlZE9wdGlvbiA9ICh0aGlzLnNlbGVjdGVkT3B0aW9uIC0gMSArIHRoaXMub3B0aW9ucy5sZW5ndGgpICUgdGhpcy5vcHRpb25zLmxlbmd0aDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIFwiQXJyb3dEb3duXCI6XG5cdFx0XHRjYXNlIFwic1wiOlxuXHRcdFx0XHR0aGlzLnNlbGVjdGVkT3B0aW9uID0gKHRoaXMuc2VsZWN0ZWRPcHRpb24gKyAxKSAlIHRoaXMub3B0aW9ucy5sZW5ndGg7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcIkVudGVyXCI6XG5cdFx0XHRcdHRoaXMuaGFuZGxlU2VsZWN0KCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fVxuXG5cdGhhbmRsZUtleVVwKGV2ZW50KSB7XG5cdFx0dGhpcy5rZXlQcmVzc2VkW2V2ZW50LmtleV0gPSBmYWxzZTtcblx0fVxuXG5cdGhhbmRsZVNlbGVjdCgpIHtcblx0XHRjb25zdCBzZWxlY3RlZCA9IHRoaXMub3B0aW9uc1t0aGlzLnNlbGVjdGVkT3B0aW9uXTtcblx0XHRjb25zb2xlLmxvZyhcIlNlbGVjdGVkIG9wdGlvbjpcIiwgc2VsZWN0ZWQpO1xuXHRcdGlmIChzZWxlY3RlZCA9PT0gXCLilrYgU3RhcnRcIiApIHtcblx0XHRcdHRoaXMuZGlzYWJsZUNvbnRyb2xzKCk7XG5cdFx0XHRnYW1lU3RhdGUucHJldmlvdXMgPSBnYW1lU3RhdGUuY3VycmVudDtcblx0XHRcdGdhbWVTdGF0ZS5jdXJyZW50ID0gR2FtZVN0YXRlLk1hcE1lbnU7XG5cdFx0fVxuXHRcdGVsc2UgaWYgKHNlbGVjdGVkID09PSBcIuKamSBPcHRpb25zXCIpIHtcblx0XHRcdHRoaXMuZGlzYWJsZUNvbnRyb2xzKCk7XG5cdFx0XHRjb25zb2xlLmxvZyhcIk9wZW4gb3B0aW9uc1wiKTtcblx0XHRcdGdhbWVTdGF0ZS5wcmV2aW91cyA9IGdhbWVTdGF0ZS5jdXJyZW50O1xuXHRcdFx0Z2FtZVN0YXRlLmN1cnJlbnQgPSBHYW1lU3RhdGUuT3B0aW9ucztcblx0XHR9XG5cdFx0ZWxzZSBpZiAoc2VsZWN0ZWQgPT09IFwi4pyWIFF1aXRcIikge1xuXHRcdFx0dGhpcy5zZWxlY3RlZE9wdGlvbiA9IDA7XG5cdFx0XHR0aGlzLmRpc2FibGVDb250cm9scygpO1xuXHRcdFx0Z2FtZVN0YXRlLnByZXZpb3VzID0gR2FtZVN0YXRlLk1lbnU7XG5cdFx0XHRnYW1lU3RhdGUuY3VycmVudCA9IEdhbWVTdGF0ZS5NZW51O1xuXHRcdFx0U2V0Z2FtZV9zdGFydGVkKGZhbHNlKTtcblx0XHRcdC8vIHdpbmRvdy5jbG9zZSgpO1xuXHRcdH1cblxuXHRcdGVsc2UgaWYgKHNlbGVjdGVkID09PSBcIuKYtyBIaXN0b3J5XCIpIHtcblx0XHRcdHRoaXMuZGlzYWJsZUNvbnRyb2xzKCk7XG5cdFx0XHRjb25zb2xlLmxvZyhcIkhpc3Rvcnkgc2VsZWN0ZWRcIik7XG5cdFx0XHRjb25zb2xlLmxvZyhcInRoaXMuR2FtZV9IaXN0b3J5ID0gXCIsIHRoaXMuR2FtZV9IaXN0b3J5KTtcblx0XHRcdGlmICh0eXBlb2YgdGhpcy5HYW1lX0hpc3RvcnkuR2FtZV9IaXN0b3J5LnNhdmVHYW1lSWZOZWVkZWQgPT09IFwiZnVuY3Rpb25cIilcblx0XHRcdHtcblx0XHRcdFx0Y29uc29sZS5sb2coXCJ0aGlzLkdhbWVfSGlzdG9yeS5HYW1lX0hpc3Rvcnkuc2F2ZUdhbWVJZk5lZWRlZCgpXCIpO1xuXHRcdFx0XHR0aGlzLkdhbWVfSGlzdG9yeS5HYW1lX0hpc3Rvcnkuc2F2ZUdhbWVJZk5lZWRlZCgpO1xuXHRcdFx0fVxuXHRcdFx0Z2FtZVN0YXRlLnByZXZpb3VzID0gZ2FtZVN0YXRlLmN1cnJlbnQ7XG5cdFx0XHRnYW1lU3RhdGUuY3VycmVudCA9IEdhbWVTdGF0ZS5HYW1lSGlzdG9yeTtcblx0XHR9XG5cdH1cbn1cbiJdfQ==