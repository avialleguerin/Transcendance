import { c, canvas } from "./constants.js";
import { gameState, GameState } from "./constants.js";
export default class EndGameFirstGame {
    constructor({ position, width, height, gameCanvas, player, coins }) {
        this.position = position;
        this.width = width;
        this.height = height;
        this.GameIsFinished = false;
        this.nb_player_play_game = 0;
        this.first_game_finished = false;
        // this.image = new Image();
        // this.image.src = "/static/img/platformer/gameover.png";
        // this.loaded = false;
        // this.image.onload = () => {
        // 	this.loaded = true;
        // };
        this.gameCanvas = gameCanvas;
        this.player = player;
        this.coins = coins;
        this.Score = 0;
        this.ScoreText = "Score : " + this.Score;
        this.ScoreFont = "20px 'Press Start 2P', Black Ops One";
        this.title = "Game Finished";
        this.titleFont = "bold 40px Black Ops One";
        this.optionFont = "20px 'Press Start 2P', Black Ops One";
        this.optionSpacing = 60;
        this.time_endGame = 0;
        this.option1 = "Player 2, Your Time Has Come ‚Äì Press ENTER";
        this.option2 = "Game Stats : ";
        this.gameCanvasFont = "20px 'Press Start 2P', Black Ops One";
        this.option3 = "Score : ";
        this.keyPressed = {};
        this.boundKeyDown = this.handleKeyDown.bind(this);
        this.boundKeyUp = this.handleKeyUp.bind(this);
    }
    enableControls() {
        window.addEventListener("keydown", this.boundKeyDown);
        window.addEventListener("keyup", this.boundKeyUp);
    }
    disableControls() {
        window.removeEventListener("keydown", this.boundKeyDown);
        window.removeEventListener("keyup", this.boundKeyUp);
    }
    handleKeyDown(event) {
        const key = event.key;
        // if (this.keyPressed[key]) return;
        this.keyPressed[key] = true;
        if (key === "Enter") {
            this.handleSelect();
        }
    }
    handleKeyUp(event) {
        this.keyPressed[event.key] = false;
    }
    handleSelect() {
        console.log("Game Finished");
        this.first_game_finished = true;
        // üîÅ Reset le joueur
        if (this.player && typeof this.player.reset_Game === "function") {
            this.player.reset_Game();
        }
        // üîÅ Reset la GameCanvas (√† adapter selon ta classe GameCanvas)
        if (this.gameCanvas) {
            this.gameCanvas.nb_coin = 0;
            this.gameCanvas.timer = 0;
            // ajoute d'autres resets si t‚Äôen as (plateformes, objets, etc.)
        }
        if (this.coins && Array.isArray(this.coins)) {
            console.log("this.coins =", this.coins);
            console.log("Resetting coins...");
            this.coins.forEach(coins => {
                if (typeof coins.Reset_coin === "function") {
                    coins.Reset_coin();
                }
            });
        }
        // üîÅ Change l‚Äô√©tat du jeu
        gameState.previous = gameState.current;
        gameState.current = GameState.Play;
        this.disableControls();
    }
    draw() {
        this.enableControls();
        this.CoinCollected = "Coin Collected : " + this.gameCanvas.nb_coin_text;
        this.time_endGame = "Time : " + this.gameCanvas.timer + " seconds";
        this.Score = (300 - this.gameCanvas.timer) + this.gameCanvas.nb_coin * 100;
        this.ScoreText = this.Score;
        c.fillStyle = "rgba(0, 0, 0, 0.75)";
        c.fillRect(0, 0, canvas.width, canvas.height);
        c.font = this.titleFont;
        c.textAlign = "left";
        c.fillStyle = "#FFD700"; // dor√©
        c.shadowColor = "#000";
        c.shadowBlur = 10;
        c.fillText(this.title, 350, 50);
        //coin text
        c.fillStyle = "white";
        c.font = this.gameCanvasFont;
        c.fillText(this.CoinCollected, 100, 250);
        //time text
        c.fillStyle = "white";
        c.font = this.gameCanvasFont;
        c.fillText(this.time_endGame, 100, 280);
        c.font = this.optionFont;
        c.fillStyle = "white";
        c.shadowColor = "#000";
        c.fillText(this.option1, 250, 400);
        c.fillStyle = "gold";
        c.fillText(this.option2, 100, 200);
        c.fillStyle = "white";
        c.fillStyle = "gold";
        c.fillText(this.option3, 700, 200);
        c.fillStyle = "white";
        c.font = this.ScoreFont;
        c.fillText(this.ScoreText, 790, 200);
        c.shadowBlur = 0; // reset
    }
    checkCollision(player) {
        const hitboxOffsetX = 60;
        const hitboxOffsetY = 90;
        const hitboxOffsetBottom = 25;
        const hitboxX = player.position.x + hitboxOffsetX;
        const hitboxY = player.position.y + hitboxOffsetY;
        const hitboxWidth = player.width - hitboxOffsetX * 2;
        const hitboxHeight = player.height - hitboxOffsetY - hitboxOffsetBottom;
        // V√©rifie l'intersection entre la hitbox du joueur et la bo√Æte
        const collision = hitboxX < this.position.x + this.width &&
            hitboxX + hitboxWidth > this.position.x &&
            hitboxY < this.position.y + this.height &&
            hitboxY + hitboxHeight > this.position.y;
        // if (collision)
        // {
        // 	this.GameIsFinished = true;
        // 	this.nb_player_play_game++;
        // 	if (this.nb_player_play_game === 1)
        // 	{
        // 		this.draw();
        // 		this.first_game_finished = true;
        // 	}
        // 	else if (this.nb_player_play_game === 2 && this.first_game_finished)
        // 	{
        // 		this.GameIsFinished = true;
        // 		this.nb_player_play_game = 0;
        // 	}
        // }
        return collision;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW5kR2FtZUZpcnN0R2FtZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3B1YmxpYy9zdGF0aWMvanMvdmlld3MvcGxhdGZvcm1lci9FbmRHYW1lRmlyc3RHYW1lLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RCxNQUFNLENBQUMsT0FBTyxPQUFPLGdCQUFnQjtJQUNwQyxZQUFhLEVBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUM7UUFDaEUsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUM7UUFDNUIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ2pDLDRCQUE0QjtRQUM1QiwwREFBMEQ7UUFDMUQsdUJBQXVCO1FBQ3ZCLDhCQUE4QjtRQUM5Qix1QkFBdUI7UUFDdkIsS0FBSztRQUNMLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLFNBQVMsR0FBRyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxHQUFHLHNDQUFzQyxDQUFDO1FBRXhELElBQUksQ0FBQyxLQUFLLEdBQUcsZUFBZSxDQUFDO1FBQzdCLElBQUksQ0FBQyxTQUFTLEdBQUcseUJBQXlCLENBQUM7UUFDM0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxzQ0FBc0MsQ0FBQztRQUN6RCxJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsT0FBTyxHQUFHLDRDQUE0QyxDQUFDO1FBQzVELElBQUksQ0FBQyxPQUFPLEdBQUcsZUFBZSxDQUFBO1FBQzlCLElBQUksQ0FBQyxjQUFjLEdBQUcsc0NBQXNDLENBQUM7UUFDN0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUM7UUFFMUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRy9DLENBQUM7SUFFRCxjQUFjO1FBQ2IsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdEQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELGVBQWU7UUFDZCxNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN6RCxNQUFNLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQUs7UUFFbEIsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQztRQUN0QixvQ0FBb0M7UUFDcEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7UUFFNUIsSUFBSSxHQUFHLEtBQUssT0FBTyxFQUFFLENBQUM7WUFDckIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3JCLENBQUM7SUFDRixDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQUs7UUFDaEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxZQUFZO1FBRVgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO1FBRWhDLHFCQUFxQjtRQUNyQixJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsS0FBSyxVQUFVLEVBQUUsQ0FBQztZQUNqRSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzFCLENBQUM7UUFFRCxnRUFBZ0U7UUFDaEUsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDckIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO1lBQzVCLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUMxQixnRUFBZ0U7UUFDakUsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN4QyxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQzFCLElBQUksT0FBTyxLQUFLLENBQUMsVUFBVSxLQUFLLFVBQVUsRUFBRSxDQUFDO29CQUM1QyxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ3BCLENBQUM7WUFDRixDQUFDLENBQUMsQ0FBQztRQUNKLENBQUM7UUFFRCwwQkFBMEI7UUFDMUIsU0FBUyxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDO1FBQ3ZDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQztRQUNuQyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUk7UUFDSCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQztRQUN4RSxJQUFJLENBQUMsWUFBWSxHQUFHLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUM7UUFDbkUsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztRQUMzRSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFNUIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxxQkFBcUIsQ0FBQztRQUNwQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUMsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUMsT0FBTztRQUNoQyxDQUFDLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQztRQUN2QixDQUFDLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNsQixDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWhDLFdBQVc7UUFFWCxDQUFDLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQztRQUN0QixDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDN0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUV6QyxXQUFXO1FBRVgsQ0FBQyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7UUFDdEIsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFeEMsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pCLENBQUMsQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxXQUFXLEdBQUcsTUFBTSxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFbkMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7UUFDckIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQztRQUV0QixDQUFDLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztRQUNyQixDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUN4QixDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRXJDLENBQUMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUTtJQUMzQixDQUFDO0lBRUQsY0FBYyxDQUFDLE1BQU07UUFDcEIsTUFBTSxhQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLE1BQU0sYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN6QixNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUU5QixNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxhQUFhLENBQUM7UUFDbEQsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsYUFBYSxDQUFDO1FBQ2xELE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEdBQUcsYUFBYSxHQUFHLENBQUMsQ0FBQztRQUNyRCxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsTUFBTSxHQUFHLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQztRQUV4RSwrREFBK0Q7UUFDL0QsTUFBTSxTQUFTLEdBQUcsT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLO1lBQ3BELE9BQU8sR0FBRyxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZDLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTTtZQUN2QyxPQUFPLEdBQUcsWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBRTdDLGlCQUFpQjtRQUNqQixJQUFJO1FBQ0osK0JBQStCO1FBQy9CLCtCQUErQjtRQUMvQix1Q0FBdUM7UUFDdkMsS0FBSztRQUNMLGlCQUFpQjtRQUNqQixxQ0FBcUM7UUFDckMsS0FBSztRQUNMLHdFQUF3RTtRQUN4RSxLQUFLO1FBQ0wsZ0NBQWdDO1FBQ2hDLGtDQUFrQztRQUNsQyxLQUFLO1FBQ0wsSUFBSTtRQUVKLE9BQU8sU0FBUyxDQUFDO0lBQ2xCLENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGMsIGNhbnZhcyB9IGZyb20gXCIuL2NvbnN0YW50cy5qc1wiO1xuaW1wb3J0IHsgZ2FtZVN0YXRlLCBHYW1lU3RhdGUgfSBmcm9tIFwiLi9jb25zdGFudHMuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRW5kR2FtZUZpcnN0R2FtZSB7XG5cdGNvbnN0cnVjdG9yICh7cG9zaXRpb24sIHdpZHRoLCBoZWlnaHQsIGdhbWVDYW52YXMsIHBsYXllciwgY29pbnN9KSB7XG5cdFx0dGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuXHRcdHRoaXMud2lkdGggPSB3aWR0aDtcblx0XHR0aGlzLmhlaWdodCA9IGhlaWdodDtcblx0XHR0aGlzLkdhbWVJc0ZpbmlzaGVkID0gZmFsc2U7XG5cdFx0dGhpcy5uYl9wbGF5ZXJfcGxheV9nYW1lID0gMDtcblx0XHR0aGlzLmZpcnN0X2dhbWVfZmluaXNoZWQgPSBmYWxzZTtcblx0XHQvLyB0aGlzLmltYWdlID0gbmV3IEltYWdlKCk7XG5cdFx0Ly8gdGhpcy5pbWFnZS5zcmMgPSBcIi9zdGF0aWMvaW1nL3BsYXRmb3JtZXIvZ2FtZW92ZXIucG5nXCI7XG5cdFx0Ly8gdGhpcy5sb2FkZWQgPSBmYWxzZTtcblx0XHQvLyB0aGlzLmltYWdlLm9ubG9hZCA9ICgpID0+IHtcblx0XHQvLyBcdHRoaXMubG9hZGVkID0gdHJ1ZTtcblx0XHQvLyB9O1xuXHRcdHRoaXMuZ2FtZUNhbnZhcyA9IGdhbWVDYW52YXM7XG5cdFx0dGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XG5cdFx0dGhpcy5jb2lucyA9IGNvaW5zO1xuXHRcdHRoaXMuU2NvcmUgPSAwO1xuXHRcdHRoaXMuU2NvcmVUZXh0ID0gXCJTY29yZSA6IFwiICsgdGhpcy5TY29yZTtcblx0XHR0aGlzLlNjb3JlRm9udCA9IFwiMjBweCAnUHJlc3MgU3RhcnQgMlAnLCBCbGFjayBPcHMgT25lXCI7XG5cblx0XHR0aGlzLnRpdGxlID0gXCJHYW1lIEZpbmlzaGVkXCI7XG5cdFx0dGhpcy50aXRsZUZvbnQgPSBcImJvbGQgNDBweCBCbGFjayBPcHMgT25lXCI7XG5cdFx0dGhpcy5vcHRpb25Gb250ID0gXCIyMHB4ICdQcmVzcyBTdGFydCAyUCcsIEJsYWNrIE9wcyBPbmVcIjtcblx0XHR0aGlzLm9wdGlvblNwYWNpbmcgPSA2MDtcblx0XHR0aGlzLnRpbWVfZW5kR2FtZSA9IDA7XG5cdFx0dGhpcy5vcHRpb24xID0gXCJQbGF5ZXIgMiwgWW91ciBUaW1lIEhhcyBDb21lIOKAkyBQcmVzcyBFTlRFUlwiO1xuXHRcdHRoaXMub3B0aW9uMiA9IFwiR2FtZSBTdGF0cyA6IFwiXG5cdFx0dGhpcy5nYW1lQ2FudmFzRm9udCA9IFwiMjBweCAnUHJlc3MgU3RhcnQgMlAnLCBCbGFjayBPcHMgT25lXCI7XG5cdFx0dGhpcy5vcHRpb24zID0gXCJTY29yZSA6IFwiO1xuXG5cdFx0dGhpcy5rZXlQcmVzc2VkID0ge307XG5cdFx0dGhpcy5ib3VuZEtleURvd24gPSB0aGlzLmhhbmRsZUtleURvd24uYmluZCh0aGlzKTtcblx0XHR0aGlzLmJvdW5kS2V5VXAgPSB0aGlzLmhhbmRsZUtleVVwLmJpbmQodGhpcyk7XG5cblxuXHR9XG5cblx0ZW5hYmxlQ29udHJvbHMoKSB7XG5cdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuYm91bmRLZXlEb3duKTtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuYm91bmRLZXlVcCk7XG5cdH1cblxuXHRkaXNhYmxlQ29udHJvbHMoKSB7XG5cdFx0d2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuYm91bmRLZXlEb3duKTtcblx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuYm91bmRLZXlVcCk7XG5cdH1cblxuXHRoYW5kbGVLZXlEb3duKGV2ZW50KSB7XG5cblx0XHRjb25zdCBrZXkgPSBldmVudC5rZXk7XG5cdFx0Ly8gaWYgKHRoaXMua2V5UHJlc3NlZFtrZXldKSByZXR1cm47XG5cdFx0dGhpcy5rZXlQcmVzc2VkW2tleV0gPSB0cnVlO1xuXG5cdFx0aWYgKGtleSA9PT0gXCJFbnRlclwiKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVNlbGVjdCgpO1xuXHRcdH1cblx0fVxuXG5cdGhhbmRsZUtleVVwKGV2ZW50KSB7XG5cdFx0dGhpcy5rZXlQcmVzc2VkW2V2ZW50LmtleV0gPSBmYWxzZTtcblx0fVxuXG5cdGhhbmRsZVNlbGVjdCgpXG5cdHtcblx0XHRjb25zb2xlLmxvZyhcIkdhbWUgRmluaXNoZWRcIik7XG5cdFx0dGhpcy5maXJzdF9nYW1lX2ZpbmlzaGVkID0gdHJ1ZTtcblx0XHRcblx0XHQvLyDwn5SBIFJlc2V0IGxlIGpvdWV1clxuXHRcdGlmICh0aGlzLnBsYXllciAmJiB0eXBlb2YgdGhpcy5wbGF5ZXIucmVzZXRfR2FtZSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHR0aGlzLnBsYXllci5yZXNldF9HYW1lKCk7XG5cdFx0fVxuXHRcdFxuXHRcdC8vIPCflIEgUmVzZXQgbGEgR2FtZUNhbnZhcyAow6AgYWRhcHRlciBzZWxvbiB0YSBjbGFzc2UgR2FtZUNhbnZhcylcblx0XHRpZiAodGhpcy5nYW1lQ2FudmFzKSB7XG5cdFx0XHR0aGlzLmdhbWVDYW52YXMubmJfY29pbiA9IDA7XG5cdFx0XHR0aGlzLmdhbWVDYW52YXMudGltZXIgPSAwO1xuXHRcdFx0Ly8gYWpvdXRlIGQnYXV0cmVzIHJlc2V0cyBzaSB04oCZZW4gYXMgKHBsYXRlZm9ybWVzLCBvYmpldHMsIGV0Yy4pXG5cdFx0fVxuXHRcdFxuXHRcdGlmICh0aGlzLmNvaW5zICYmIEFycmF5LmlzQXJyYXkodGhpcy5jb2lucykpIHtcblx0XHRcdGNvbnNvbGUubG9nKFwidGhpcy5jb2lucyA9XCIsIHRoaXMuY29pbnMpO1xuXHRcdFx0Y29uc29sZS5sb2coXCJSZXNldHRpbmcgY29pbnMuLi5cIik7XG5cdFx0XHR0aGlzLmNvaW5zLmZvckVhY2goY29pbnMgPT4ge1xuXHRcdFx0XHRpZiAodHlwZW9mIGNvaW5zLlJlc2V0X2NvaW4gPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdGNvaW5zLlJlc2V0X2NvaW4oKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdFxuXHRcdC8vIPCflIEgQ2hhbmdlIGzigJnDqXRhdCBkdSBqZXVcblx0XHRnYW1lU3RhdGUucHJldmlvdXMgPSBnYW1lU3RhdGUuY3VycmVudDtcblx0XHRnYW1lU3RhdGUuY3VycmVudCA9IEdhbWVTdGF0ZS5QbGF5O1xuXHRcdHRoaXMuZGlzYWJsZUNvbnRyb2xzKCk7XG5cdH1cblx0XG5cdGRyYXcoKSB7XG5cdFx0dGhpcy5lbmFibGVDb250cm9scygpO1xuXHRcdHRoaXMuQ29pbkNvbGxlY3RlZCA9IFwiQ29pbiBDb2xsZWN0ZWQgOiBcIiArIHRoaXMuZ2FtZUNhbnZhcy5uYl9jb2luX3RleHQ7XG5cdFx0dGhpcy50aW1lX2VuZEdhbWUgPSBcIlRpbWUgOiBcIiArIHRoaXMuZ2FtZUNhbnZhcy50aW1lciArIFwiIHNlY29uZHNcIjtcblx0XHR0aGlzLlNjb3JlID0gKDMwMCAtIHRoaXMuZ2FtZUNhbnZhcy50aW1lcikgKyB0aGlzLmdhbWVDYW52YXMubmJfY29pbiAqIDEwMDtcblx0XHR0aGlzLlNjb3JlVGV4dCA9IHRoaXMuU2NvcmU7XG5cblx0XHRjLmZpbGxTdHlsZSA9IFwicmdiYSgwLCAwLCAwLCAwLjc1KVwiO1xuXHRcdGMuZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcblx0XHRjLmZvbnQgPSB0aGlzLnRpdGxlRm9udDtcblx0XHRjLnRleHRBbGlnbiA9IFwibGVmdFwiO1xuXHRcdGMuZmlsbFN0eWxlID0gXCIjRkZENzAwXCI7IC8vIGRvcsOpXG5cdFx0Yy5zaGFkb3dDb2xvciA9IFwiIzAwMFwiO1xuXHRcdGMuc2hhZG93Qmx1ciA9IDEwO1xuXHRcdGMuZmlsbFRleHQodGhpcy50aXRsZSwgMzUwLCA1MCk7XG5cblx0XHQvL2NvaW4gdGV4dFxuXG5cdFx0Yy5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG5cdFx0Yy5mb250ID0gdGhpcy5nYW1lQ2FudmFzRm9udDtcblx0XHRjLmZpbGxUZXh0KHRoaXMuQ29pbkNvbGxlY3RlZCwgMTAwLCAyNTApO1xuXG5cdFx0Ly90aW1lIHRleHRcblxuXHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuXHRcdGMuZm9udCA9IHRoaXMuZ2FtZUNhbnZhc0ZvbnQ7XG5cdFx0Yy5maWxsVGV4dCh0aGlzLnRpbWVfZW5kR2FtZSwgMTAwLCAyODApO1xuXG5cdFx0Yy5mb250ID0gdGhpcy5vcHRpb25Gb250O1xuXHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuXHRcdGMuc2hhZG93Q29sb3IgPSBcIiMwMDBcIjtcblx0XHRjLmZpbGxUZXh0KHRoaXMub3B0aW9uMSwgMjUwLCA0MDApO1xuXG5cdFx0Yy5maWxsU3R5bGUgPSBcImdvbGRcIjtcblx0XHRjLmZpbGxUZXh0KHRoaXMub3B0aW9uMiwgMTAwLCAyMDApO1xuXHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuXG5cdFx0Yy5maWxsU3R5bGUgPSBcImdvbGRcIjtcblx0XHRjLmZpbGxUZXh0KHRoaXMub3B0aW9uMywgNzAwLCAyMDApO1xuXHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuXHRcdGMuZm9udCA9IHRoaXMuU2NvcmVGb250O1xuXHRcdGMuZmlsbFRleHQodGhpcy5TY29yZVRleHQsIDc5MCwgMjAwKTtcblx0XHRcblx0XHRjLnNoYWRvd0JsdXIgPSAwOyAvLyByZXNldFxuXHR9XG5cblx0Y2hlY2tDb2xsaXNpb24ocGxheWVyKSB7XG5cdFx0Y29uc3QgaGl0Ym94T2Zmc2V0WCA9IDYwO1xuXHRcdGNvbnN0IGhpdGJveE9mZnNldFkgPSA5MDtcblx0XHRjb25zdCBoaXRib3hPZmZzZXRCb3R0b20gPSAyNTtcblx0XG5cdFx0Y29uc3QgaGl0Ym94WCA9IHBsYXllci5wb3NpdGlvbi54ICsgaGl0Ym94T2Zmc2V0WDtcblx0XHRjb25zdCBoaXRib3hZID0gcGxheWVyLnBvc2l0aW9uLnkgKyBoaXRib3hPZmZzZXRZO1xuXHRcdGNvbnN0IGhpdGJveFdpZHRoID0gcGxheWVyLndpZHRoIC0gaGl0Ym94T2Zmc2V0WCAqIDI7XG5cdFx0Y29uc3QgaGl0Ym94SGVpZ2h0ID0gcGxheWVyLmhlaWdodCAtIGhpdGJveE9mZnNldFkgLSBoaXRib3hPZmZzZXRCb3R0b207XG5cdFxuXHRcdC8vIFbDqXJpZmllIGwnaW50ZXJzZWN0aW9uIGVudHJlIGxhIGhpdGJveCBkdSBqb3VldXIgZXQgbGEgYm/DrnRlXG5cdFx0Y29uc3QgY29sbGlzaW9uID0gaGl0Ym94WCA8IHRoaXMucG9zaXRpb24ueCArIHRoaXMud2lkdGggJiZcblx0XHRcdFx0XHRcdGhpdGJveFggKyBoaXRib3hXaWR0aCA+IHRoaXMucG9zaXRpb24ueCAmJlxuXHRcdFx0XHRcdFx0aGl0Ym94WSA8IHRoaXMucG9zaXRpb24ueSArIHRoaXMuaGVpZ2h0ICYmXG5cdFx0XHRcdFx0XHRoaXRib3hZICsgaGl0Ym94SGVpZ2h0ID4gdGhpcy5wb3NpdGlvbi55O1xuXHRcdFxuXHRcdC8vIGlmIChjb2xsaXNpb24pXG5cdFx0Ly8ge1xuXHRcdC8vIFx0dGhpcy5HYW1lSXNGaW5pc2hlZCA9IHRydWU7XG5cdFx0Ly8gXHR0aGlzLm5iX3BsYXllcl9wbGF5X2dhbWUrKztcblx0XHQvLyBcdGlmICh0aGlzLm5iX3BsYXllcl9wbGF5X2dhbWUgPT09IDEpXG5cdFx0Ly8gXHR7XG5cdFx0Ly8gXHRcdHRoaXMuZHJhdygpO1xuXHRcdC8vIFx0XHR0aGlzLmZpcnN0X2dhbWVfZmluaXNoZWQgPSB0cnVlO1xuXHRcdC8vIFx0fVxuXHRcdC8vIFx0ZWxzZSBpZiAodGhpcy5uYl9wbGF5ZXJfcGxheV9nYW1lID09PSAyICYmIHRoaXMuZmlyc3RfZ2FtZV9maW5pc2hlZClcblx0XHQvLyBcdHtcblx0XHQvLyBcdFx0dGhpcy5HYW1lSXNGaW5pc2hlZCA9IHRydWU7XG5cdFx0Ly8gXHRcdHRoaXMubmJfcGxheWVyX3BsYXlfZ2FtZSA9IDA7XG5cdFx0Ly8gXHR9XG5cdFx0Ly8gfVxuXHRcblx0XHRyZXR1cm4gY29sbGlzaW9uO1xuXHR9XG59Il19