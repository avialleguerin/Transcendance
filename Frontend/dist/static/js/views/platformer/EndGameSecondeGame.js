import { c, canvas } from "./constants.js";
import { gameState, GameState } from "./constants.js";
export default class EndGameSecondeGame {
    constructor({ gameCanvas, player, coins, EndGame_FirstGame, historyGame, MapMenu }) {
        this.nb_player_play_game = 0;
        this.seconde_game_finished = false;
        this.gameCanvas = gameCanvas;
        this.player = player;
        this.coins = coins;
        this.Score = 0;
        this.ScoreText = "Score : " + this.Score;
        this.ScoreFont = "20px 'Press Start 2P', Black Ops One";
        this.options = ["Menu", "Restart"];
        this.selectedOption = 0;
        this.optionSpacing = 60;
        this.historyGame = historyGame;
        this.EndGame_FirstGame = EndGame_FirstGame;
        this.MapMenu = MapMenu;
        this.title = "Game Finished";
        this.titleFont = "bold 40px Black Ops One";
        this.optionFont = "20px 'Press Start 2P', Black Ops One";
        this.optionSpacing = 60;
        this.time_endGame = 0;
        this.option2 = "Game Stats : ";
        this.gameCanvasFont = "20px 'Press Start 2P', Black Ops One";
        this.option3 = "Score : ";
        this.option4 = "Game Result : ";
        this.option5 = "";
        this.option6 = "";
        this.option7 = "";
        this.option8 = "Winner : ";
        this.winner = "";
        this.WinnerScore = 0;
        this.option5font = "15px 'Press Start 2P', Black Ops One";
        this.option6font = "20px 'Press Start 2P', Black Ops One";
        this.keyPressed = {};
        this.boundKeyDown = this.handleKeyDown.bind(this);
        this.boundKeyUp = this.handleKeyUp.bind(this);
    }
    enableControls() {
        window.addEventListener("keydown", this.boundKeyDown);
        window.addEventListener("keyup", this.boundKeyUp);
    }
    disableControls() {
        window.removeEventListener("keydown", this.boundKeyDown);
        window.removeEventListener("keyup", this.boundKeyUp);
    }
    handleKeyDown(event) {
        const key = event.key;
        // if (this.keyPressed[key]) return;
        this.keyPressed[key] = true;
        switch (key) {
            case "ArrowUp":
            case "w":
                this.selectedOption = (this.selectedOption - 1 + this.options.length) % this.options.length;
                break;
            case "ArrowDown":
            case "s":
                this.selectedOption = (this.selectedOption + 1) % this.options.length;
                break;
            case "Enter":
                this.handleSelect();
                break;
        }
    }
    handleKeyUp(event) {
        this.keyPressed[event.key] = false;
    }
    handleSelect() {
        console.log("Game Finished");
        const selected = this.options[this.selectedOption];
        console.log("selected =", selected);
        if (selected === "Menu") {
            // üîÅ Reset le joueur
            this.EndGame_FirstGame.first_game_finished = false;
            console.log("Resetting player...");
            console.log("this.winner =", this.winner);
            console.log("this.Score =", this.Score);
            console.log("this.gameCanvas.timer =", this.gameCanvas.timer);
            console.log("this.nbGame =", this.MapMenu.nb_game_started);
            if (this.Score > this.EndGame_FirstGame.Score) {
                this.WinnerScore = this.Score;
            }
            else {
                this.WinnerScore = this.EndGame_FirstGame.Score;
            }
            this.MapMenu.nb_game_started++;
            this.historyGame.saveGameIfNeeded(this.MapMenu.nb_game_started, this.winner, this.WinnerScore, this.gameCanvas.timer);
            if (this.player && typeof this.player.reset_Game === "function") {
                this.player.reset_Game();
            }
            // üîÅ Reset la GameCanvas (√† adapter selon ta classe GameCanvas)
            if (this.gameCanvas) {
                this.gameCanvas.nb_coin = 0;
                this.gameCanvas.timer = 0;
                // ajoute d'autres resets si t‚Äôen as (plateformes, objets, etc.)
            }
            if (this.coins && Array.isArray(this.coins)) {
                console.log("this.coins =", this.coins);
                console.log("Resetting coins...");
                this.coins.forEach(coins => {
                    if (typeof coins.Reset_coin === "function") {
                        coins.Reset_coin();
                    }
                });
            }
            // üîÅ Change l‚Äô√©tat du jeu
            this.disableControls();
            gameState.previous = gameState.current;
            gameState.current = GameState.MapMenu;
        }
        if (selected === "Restart") {
            // üîÅ Reset le joueur
            this.EndGame_FirstGame.first_game_finished = false;
            if (this.player && typeof this.player.reset_Game === "function") {
                this.player.reset_Game();
            }
            // üîÅ Reset la GameCanvas (√† adapter selon ta classe GameCanvas)
            if (this.gameCanvas) {
                this.gameCanvas.nb_coin = 0;
                this.gameCanvas.timer = 0;
                // ajoute d'autres resets si t‚Äôen as (plateformes, objets, etc.)
            }
            if (this.coins && Array.isArray(this.coins)) {
                console.log("this.coins =", this.coins);
                console.log("Resetting coins...");
                this.coins.forEach(coins => {
                    if (typeof coins.Reset_coin === "function") {
                        coins.Reset_coin();
                    }
                });
            }
            // üîÅ Change l‚Äô√©tat du jeu
            this.disableControls();
            gameState.previous = gameState.current;
            gameState.current = GameState.Play;
        }
    }
    draw() {
        this.enableControls();
        this.CoinCollected = "Coin Collected : " + this.gameCanvas.nb_coin_text;
        this.time_endGame = "Time : " + this.gameCanvas.timer + " seconds";
        this.Score = (300 - this.gameCanvas.timer) + this.gameCanvas.nb_coin * 100;
        this.ScoreText = this.Score;
        this.option5 = "Player 1 has finished the game with : " + this.EndGame_FirstGame.Score + " score";
        this.option6 = "Player 2 has finished the game with : " + this.Score + " score";
        if (this.EndGame_FirstGame.Score > this.Score) {
            this.winner = "Player 1";
        }
        else if (this.EndGame_FirstGame.Score < this.Score) {
            this.winner = "Player 2";
        }
        this.option7 = this.winner;
        c.fillStyle = "rgba(0, 0, 0, 0.75)";
        c.fillRect(0, 0, canvas.width, canvas.height);
        c.font = this.titleFont;
        c.textAlign = "left";
        c.fillStyle = "#FFD700"; // dor√©
        c.shadowColor = "#000";
        c.shadowBlur = 10;
        c.fillText(this.title, 350, 50);
        //coin text
        c.fillStyle = "white";
        c.font = this.gameCanvasFont;
        c.fillText(this.CoinCollected, 100, 150);
        //time text
        c.fillStyle = "white";
        c.font = this.gameCanvasFont;
        c.fillText(this.time_endGame, 100, 180);
        c.font = this.optionFont;
        c.fillStyle = "gold";
        c.fillText(this.option2, 100, 100);
        c.fillStyle = "gold";
        c.fillText(this.option3, 700, 100);
        c.fillStyle = "white";
        c.font = this.ScoreFont;
        c.fillText(this.ScoreText, 790, 100);
        c.font = this.ScoreFont;
        c.fillStyle = "gold";
        c.fillText(this.option4, 100, 300);
        c.font = this.option5font;
        c.fillStyle = "white";
        c.fillText(this.option5, 260, 300);
        c.font = this.option5font;
        c.fillStyle = "white";
        c.fillText(this.option6, 260, 330);
        c.font = this.ScoreFont;
        c.fillStyle = "gold";
        c.fillText(this.option8, 100, 450);
        c.font = this.option6font;
        c.fillStyle = "green";
        c.fillText(this.option7, 200, 450);
        c.shadowBlur = 0; // reset
        const optionPositions = [
            { x: 900, y: 550 }, // position de "Menu"
            { x: 900, y: 520 }, // position de "Restart"
        ];
        this.options.forEach((option, index) => {
            const pos = optionPositions[index];
            if (index === this.selectedOption) {
                c.fillStyle = "#00FFFF"; // Bleu si autre option s√©lectionn√©e
            }
            else {
                c.fillStyle = "white"; // Sinon blanc
            }
            c.fillText(option, pos.x, pos.y);
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW5kR2FtZVNlY29uZGVHYW1lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHVibGljL3N0YXRpYy9qcy92aWV3cy9wbGF0Zm9ybWVyL0VuZEdhbWVTZWNvbmRlR2FtZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFdEQsTUFBTSxDQUFDLE9BQU8sT0FBTyxrQkFBa0I7SUFDdEMsWUFBYSxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUM7UUFDaEYsSUFBSSxDQUFDLG1CQUFtQixHQUFHLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMscUJBQXFCLEdBQUcsS0FBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLFNBQVMsR0FBRyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxHQUFHLHNDQUFzQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFFL0IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLGlCQUFpQixDQUFD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QyxTQUFTLENBQUM7UUFDeEIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUVyQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDeEIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7UUFDckIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUduQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDMUIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7UUFDdEIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUduQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDMUIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7UUFDdEIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUVuQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDeEIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7UUFDckIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUVuQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDMUIsQ0FBQyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7UUFDdEIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVE7UUFFMUIsTUFBTSxlQUFlLEdBQUc7WUFDdkIsRUFBQyxDQUFDLEVBQUcsR0FBRyxFQUFFLENBQUMsRUFBRyxHQUFHLEVBQUMsRUFBRSxxQkFBcUI7WUFDekMsRUFBQyxDQUFDLEVBQUcsR0FBRyxFQUFFLENBQUMsRUFBRyxHQUFHLEVBQUMsRUFBRSx3QkFBd0I7U0FDNUMsQ0FBQztRQUVGLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQ3RDLE1BQU0sR0FBRyxHQUFHLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQyxJQUFJLEtBQUssS0FBSyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ25DLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUMsb0NBQW9DO1lBQzlELENBQUM7aUJBQU0sQ0FBQztnQkFDUCxDQUFDLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxDQUFDLGNBQWM7WUFDdEMsQ0FBQztZQUNELENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBRUosQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYywgY2FudmFzIH0gZnJvbSBcIi4vY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgeyBnYW1lU3RhdGUsIEdhbWVTdGF0ZSB9IGZyb20gXCIuL2NvbnN0YW50cy5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFbmRHYW1lU2Vjb25kZUdhbWV7XG5cdGNvbnN0cnVjdG9yICh7Z2FtZUNhbnZhcywgcGxheWVyLCBjb2lucywgRW5kR2FtZV9GaXJzdEdhbWUsIGhpc3RvcnlHYW1lLCBNYXBNZW51fSkge1xuXHRcdHRoaXMubmJfcGxheWVyX3BsYXlfZ2FtZSA9IDA7XG5cdFx0dGhpcy5zZWNvbmRlX2dhbWVfZmluaXNoZWQgPSBmYWxzZTtcblx0XHR0aGlzLmdhbWVDYW52YXMgPSBnYW1lQ2FudmFzO1xuXHRcdHRoaXMucGxheWVyID0gcGxheWVyO1xuXHRcdHRoaXMuY29pbnMgPSBjb2lucztcblx0XHR0aGlzLlNjb3JlID0gMDtcblx0XHR0aGlzLlNjb3JlVGV4dCA9IFwiU2NvcmUgOiBcIiArIHRoaXMuU2NvcmU7XG5cdFx0dGhpcy5TY29yZUZvbnQgPSBcIjIwcHggJ1ByZXNzIFN0YXJ0IDJQJywgQmxhY2sgT3BzIE9uZVwiO1xuXHRcdHRoaXMub3B0aW9ucyA9IFtcIk1lbnVcIiwgXCJSZXN0YXJ0XCJdO1xuXHRcdHRoaXMuc2VsZWN0ZWRPcHRpb24gPSAwO1xuXHRcdHRoaXMub3B0aW9uU3BhY2luZyA9IDYwO1xuXHRcdHRoaXMuaGlzdG9yeUdhbWUgPSBoaXN0b3J5R2FtZTtcblxuXHRcdHRoaXMuRW5kR2FtZV9GaXJzdEdhbWUgPSBFbmRHYW1lX0ZpcnN0R2FtZTtcblx0XHR0aGlzLk1hcE1lbnUgPSBNYXBNZW51O1xuXG5cdFx0dGhpcy50aXRsZSA9IFwiR2FtZSBGaW5pc2hlZFwiO1xuXHRcdHRoaXMudGl0bGVGb250ID0gXCJib2xkIDQwcHggQmxhY2sgT3BzIE9uZVwiO1xuXHRcdHRoaXMub3B0aW9uRm9udCA9IFwiMjBweCAnUHJlc3MgU3RhcnQgMlAnLCBCbGFjayBPcHMgT25lXCI7XG5cdFx0dGhpcy5vcHRpb25TcGFjaW5nID0gNjA7XG5cdFx0dGhpcy50aW1lX2VuZEdhbWUgPSAwO1xuXHRcdHRoaXMub3B0aW9uMiA9IFwiR2FtZSBTdGF0cyA6IFwiO1xuXHRcdHRoaXMuZ2FtZUNhbnZhc0ZvbnQgPSBcIjIwcHggJ1ByZXNzIFN0YXJ0IDJQJywgQmxhY2sgT3BzIE9uZVwiO1xuXHRcdHRoaXMub3B0aW9uMyA9IFwiU2NvcmUgOiBcIjtcblxuXHRcdHRoaXMub3B0aW9uNCA9IFwiR2FtZSBSZXN1bHQgOiBcIjtcblx0XHR0aGlzLm9wdGlvbjUgPSBcIlwiO1xuXHRcdHRoaXMub3B0aW9uNiA9IFwiXCI7XG5cdFx0dGhpcy5vcHRpb243ID0gXCJcIjtcblx0XHR0aGlzLm9wdGlvbjggPSBcIldpbm5lciA6IFwiO1xuXHRcdHRoaXMud2lubmVyID0gXCJcIjtcblx0XHR0aGlzLldpbm5lclNjb3JlID0gMDtcblxuXHRcdHRoaXMub3B0aW9uNWZvbnQgPSBcIjE1cHggJ1ByZXNzIFN0YXJ0IDJQJywgQmxhY2sgT3BzIE9uZVwiO1xuXHRcdHRoaXMub3B0aW9uNmZvbnQgPSBcIjIwcHggJ1ByZXNzIFN0YXJ0IDJQJywgQmxhY2sgT3BzIE9uZVwiO1xuXG5cblx0XHR0aGlzLmtleVByZXNzZWQgPSB7fTtcblx0XHR0aGlzLmJvdW5kS2V5RG93biA9IHRoaXMuaGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpO1xuXHRcdHRoaXMuYm91bmRLZXlVcCA9IHRoaXMuaGFuZGxlS2V5VXAuYmluZCh0aGlzKTtcblxuXG5cdH1cblxuXHRlbmFibGVDb250cm9scygpIHtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5ib3VuZEtleURvd24pO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5ib3VuZEtleVVwKTtcblx0fVxuXG5cdGRpc2FibGVDb250cm9scygpIHtcblx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5ib3VuZEtleURvd24pO1xuXHRcdHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5ib3VuZEtleVVwKTtcblx0fVxuXG5cdGhhbmRsZUtleURvd24oZXZlbnQpIHtcblx0XHRjb25zdCBrZXkgPSBldmVudC5rZXk7XG5cdFx0Ly8gaWYgKHRoaXMua2V5UHJlc3NlZFtrZXldKSByZXR1cm47XG5cdFx0dGhpcy5rZXlQcmVzc2VkW2tleV0gPSB0cnVlO1xuXG5cdFx0c3dpdGNoIChrZXkpIHtcblx0XHRcdGNhc2UgXCJBcnJvd1VwXCI6XG5cdFx0XHRjYXNlIFwid1wiOlxuXHRcdFx0XHR0aGlzLnNlbGVjdGVkT3B0aW9uID0gKHRoaXMuc2VsZWN0ZWRPcHRpb24gLSAxICsgdGhpcy5vcHRpb25zLmxlbmd0aCkgJSB0aGlzLm9wdGlvbnMubGVuZ3RoO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgXCJBcnJvd0Rvd25cIjpcblx0XHRcdGNhc2UgXCJzXCI6XG5cdFx0XHRcdHRoaXMuc2VsZWN0ZWRPcHRpb24gPSAodGhpcy5zZWxlY3RlZE9wdGlvbiArIDEpICUgdGhpcy5vcHRpb25zLmxlbmd0aDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIFwiRW50ZXJcIjpcblx0XHRcdFx0dGhpcy5oYW5kbGVTZWxlY3QoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cblx0aGFuZGxlS2V5VXAoZXZlbnQpIHtcblx0XHR0aGlzLmtleVByZXNzZWRbZXZlbnQua2V5XSA9IGZhbHNlO1xuXHR9XG5cblx0aGFuZGxlU2VsZWN0KClcblx0e1xuXHRcdGNvbnNvbGUubG9nKFwiR2FtZSBGaW5pc2hlZFwiKTtcblx0XHRjb25zdCBzZWxlY3RlZCA9IHRoaXMub3B0aW9uc1t0aGlzLnNlbGVjdGVkT3B0aW9uXTtcblx0XHRjb25zb2xlLmxvZyhcInNlbGVjdGVkID1cIiwgc2VsZWN0ZWQpO1xuXHRcdGlmIChzZWxlY3RlZCA9PT0gXCJNZW51XCIpXG5cdFx0e1xuXHRcdFx0Ly8g8J+UgSBSZXNldCBsZSBqb3VldXJcblx0XHRcdHRoaXMuRW5kR2FtZV9GaXJzdEdhbWUuZmlyc3RfZ2FtZV9maW5pc2hlZCA9IGZhbHNlO1xuXHRcdFx0Y29uc29sZS5sb2coXCJSZXNldHRpbmcgcGxheWVyLi4uXCIpO1xuXHRcdFx0Y29uc29sZS5sb2coXCJ0aGlzLndpbm5lciA9XCIsIHRoaXMud2lubmVyKTtcblx0XHRcdGNvbnNvbGUubG9nKFwidGhpcy5TY29yZSA9XCIsIHRoaXMuU2NvcmUpO1xuXHRcdFx0Y29uc29sZS5sb2coXCJ0aGlzLmdhbWVDYW52YXMudGltZXIgPVwiLCB0aGlzLmdhbWVDYW52YXMudGltZXIpO1xuXHRcdFx0Y29uc29sZS5sb2coXCJ0aGlzLm5iR2FtZSA9XCIsIHRoaXMuTWFwTWVudS5uYl9nYW1lX3N0YXJ0ZWQpO1xuXG5cdFx0XHRpZiAodGhpcy5TY29yZSA+IHRoaXMuRW5kR2FtZV9GaXJzdEdhbWUuU2NvcmUpXG5cdFx0XHR7XG5cdFx0XHRcdHRoaXMuV2lubmVyU2NvcmUgPSB0aGlzLlNjb3JlO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHR0aGlzLldpbm5lclNjb3JlID0gdGhpcy5FbmRHYW1lX0ZpcnN0R2FtZS5TY29yZTtcblx0XHRcdH1cblx0XHRcdHRoaXMuTWFwTWVudS5uYl9nYW1lX3N0YXJ0ZWQrKztcblx0XHRcdHRoaXMuaGlzdG9yeUdhbWUuc2F2ZUdhbWVJZk5lZWRlZCh0aGlzLk1hcE1lbnUubmJfZ2FtZV9zdGFydGVkLCB0aGlzLndpbm5lciwgdGhpcy5XaW5uZXJTY29yZSwgdGhpcy5nYW1lQ2FudmFzLnRpbWVyKTtcblx0XHRcdGlmICh0aGlzLnBsYXllciAmJiB0eXBlb2YgdGhpcy5wbGF5ZXIucmVzZXRfR2FtZSA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdHRoaXMucGxheWVyLnJlc2V0X0dhbWUoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Ly8g8J+UgSBSZXNldCBsYSBHYW1lQ2FudmFzICjDoCBhZGFwdGVyIHNlbG9uIHRhIGNsYXNzZSBHYW1lQ2FudmFzKVxuXHRcdFx0aWYgKHRoaXMuZ2FtZUNhbnZhcykge1xuXHRcdFx0XHR0aGlzLmdhbWVDYW52YXMubmJfY29pbiA9IDA7XG5cdFx0XHRcdHRoaXMuZ2FtZUNhbnZhcy50aW1lciA9IDA7XG5cdFx0XHRcdC8vIGFqb3V0ZSBkJ2F1dHJlcyByZXNldHMgc2kgdOKAmWVuIGFzIChwbGF0ZWZvcm1lcywgb2JqZXRzLCBldGMuKVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZiAodGhpcy5jb2lucyAmJiBBcnJheS5pc0FycmF5KHRoaXMuY29pbnMpKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwidGhpcy5jb2lucyA9XCIsIHRoaXMuY29pbnMpO1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcIlJlc2V0dGluZyBjb2lucy4uLlwiKTtcblx0XHRcdFx0dGhpcy5jb2lucy5mb3JFYWNoKGNvaW5zID0+IHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvaW5zLlJlc2V0X2NvaW4gPT09IFwiZnVuY3Rpb25cIikge1xuXHRcdFx0XHRcdFx0Y29pbnMuUmVzZXRfY29pbigpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdC8vIPCflIEgQ2hhbmdlIGzigJnDqXRhdCBkdSBqZXVcblx0XHRcdHRoaXMuZGlzYWJsZUNvbnRyb2xzKCk7XG5cdFx0XHRnYW1lU3RhdGUucHJldmlvdXMgPSBnYW1lU3RhdGUuY3VycmVudDtcblx0XHRcdGdhbWVTdGF0ZS5jdXJyZW50ID0gR2FtZVN0YXRlLk1hcE1lbnU7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGVjdGVkID09PSBcIlJlc3RhcnRcIikge1xuXHRcdFx0Ly8g8J+UgSBSZXNldCBsZSBqb3VldXJcblx0XHRcdHRoaXMuRW5kR2FtZV9GaXJzdEdhbWUuZmlyc3RfZ2FtZV9maW5pc2hlZCA9IGZhbHNlO1xuXHRcdFx0aWYgKHRoaXMucGxheWVyICYmIHR5cGVvZiB0aGlzLnBsYXllci5yZXNldF9HYW1lID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRcdFx0dGhpcy5wbGF5ZXIucmVzZXRfR2FtZSgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHQvLyDwn5SBIFJlc2V0IGxhIEdhbWVDYW52YXMgKMOgIGFkYXB0ZXIgc2Vsb24gdGEgY2xhc3NlIEdhbWVDYW52YXMpXG5cdFx0XHRpZiAodGhpcy5nYW1lQ2FudmFzKSB7XG5cdFx0XHRcdHRoaXMuZ2FtZUNhbnZhcy5uYl9jb2luID0gMDtcblx0XHRcdFx0dGhpcy5nYW1lQ2FudmFzLnRpbWVyID0gMDtcblx0XHRcdFx0Ly8gYWpvdXRlIGQnYXV0cmVzIHJlc2V0cyBzaSB04oCZZW4gYXMgKHBsYXRlZm9ybWVzLCBvYmpldHMsIGV0Yy4pXG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmICh0aGlzLmNvaW5zICYmIEFycmF5LmlzQXJyYXkodGhpcy5jb2lucykpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coXCJ0aGlzLmNvaW5zID1cIiwgdGhpcy5jb2lucyk7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiUmVzZXR0aW5nIGNvaW5zLi4uXCIpO1xuXHRcdFx0XHR0aGlzLmNvaW5zLmZvckVhY2goY29pbnMgPT4ge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29pbnMuUmVzZXRfY29pbiA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdFx0XHRjb2lucy5SZXNldF9jb2luKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Ly8g8J+UgSBDaGFuZ2UgbOKAmcOpdGF0IGR1IGpldVxuXHRcdFx0dGhpcy5kaXNhYmxlQ29udHJvbHMoKTtcblx0XHRcdGdhbWVTdGF0ZS5wcmV2aW91cyA9IGdhbWVTdGF0ZS5jdXJyZW50O1xuXHRcdFx0Z2FtZVN0YXRlLmN1cnJlbnQgPSBHYW1lU3RhdGUuUGxheTtcblx0XHR9XG5cdH1cblxuXHRkcmF3KCkge1xuXHRcdHRoaXMuZW5hYmxlQ29udHJvbHMoKTtcblx0XHR0aGlzLkNvaW5Db2xsZWN0ZWQgPSBcIkNvaW4gQ29sbGVjdGVkIDogXCIgKyB0aGlzLmdhbWVDYW52YXMubmJfY29pbl90ZXh0O1xuXHRcdHRoaXMudGltZV9lbmRHYW1lID0gXCJUaW1lIDogXCIgKyB0aGlzLmdhbWVDYW52YXMudGltZXIgKyBcIiBzZWNvbmRzXCI7XG5cdFx0dGhpcy5TY29yZSA9ICgzMDAgLSB0aGlzLmdhbWVDYW52YXMudGltZXIpICsgdGhpcy5nYW1lQ2FudmFzLm5iX2NvaW4gKiAxMDA7XG5cdFx0dGhpcy5TY29yZVRleHQgPSB0aGlzLlNjb3JlO1xuXHRcdHRoaXMub3B0aW9uNSA9IFwiUGxheWVyIDEgaGFzIGZpbmlzaGVkIHRoZSBnYW1lIHdpdGggOiBcIiArIHRoaXMuRW5kR2FtZV9GaXJzdEdhbWUuU2NvcmUgKyBcIiBzY29yZVwiO1xuXHRcdHRoaXMub3B0aW9uNiA9IFwiUGxheWVyIDIgaGFzIGZpbmlzaGVkIHRoZSBnYW1lIHdpdGggOiBcIiArIHRoaXMuU2NvcmUgKyBcIiBzY29yZVwiO1xuXG5cdFx0aWYgKHRoaXMuRW5kR2FtZV9GaXJzdEdhbWUuU2NvcmUgPiB0aGlzLlNjb3JlKVxuXHRcdHtcblx0XHRcdHRoaXMud2lubmVyID0gXCJQbGF5ZXIgMVwiO1xuXHRcdH1cblx0XHRlbHNlIGlmICh0aGlzLkVuZEdhbWVfRmlyc3RHYW1lLlNjb3JlIDwgdGhpcy5TY29yZSlcblx0XHR7XG5cdFx0XHR0aGlzLndpbm5lciA9IFwiUGxheWVyIDJcIjtcblx0XHR9XG5cblx0XHR0aGlzLm9wdGlvbjcgPSB0aGlzLndpbm5lcjtcblxuXG5cdFx0Yy5maWxsU3R5bGUgPSBcInJnYmEoMCwgMCwgMCwgMC43NSlcIjtcblx0XHRjLmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cdFx0Yy5mb250ID0gdGhpcy50aXRsZUZvbnQ7XG5cdFx0Yy50ZXh0QWxpZ24gPSBcImxlZnRcIjtcblx0XHRjLmZpbGxTdHlsZSA9IFwiI0ZGRDcwMFwiOyAvLyBkb3LDqVxuXHRcdGMuc2hhZG93Q29sb3IgPSBcIiMwMDBcIjtcblx0XHRjLnNoYWRvd0JsdXIgPSAxMDtcblx0XHRjLmZpbGxUZXh0KHRoaXMudGl0bGUsIDM1MCwgNTApO1xuXG5cdFx0Ly9jb2luIHRleHRcblxuXHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuXHRcdGMuZm9udCA9IHRoaXMuZ2FtZUNhbnZhc0ZvbnQ7XG5cdFx0Yy5maWxsVGV4dCh0aGlzLkNvaW5Db2xsZWN0ZWQsIDEwMCwgMTUwKTtcblxuXHRcdC8vdGltZSB0ZXh0XG5cblx0XHRjLmZpbGxTdHlsZSA9IFwid2hpdGVcIjtcblx0XHRjLmZvbnQgPSB0aGlzLmdhbWVDYW52YXNGb250O1xuXHRcdGMuZmlsbFRleHQodGhpcy50aW1lX2VuZEdhbWUsIDEwMCwgMTgwKTtcblxuXHRcdGMuZm9udCA9IHRoaXMub3B0aW9uRm9udDtcblx0XHRjLmZpbGxTdHlsZSA9IFwiZ29sZFwiO1xuXHRcdGMuZmlsbFRleHQodGhpcy5vcHRpb24yLCAxMDAsIDEwMCk7XG5cdFx0XG5cblx0XHRjLmZpbGxTdHlsZSA9IFwiZ29sZFwiO1xuXHRcdGMuZmlsbFRleHQodGhpcy5vcHRpb24zLCA3MDAsIDEwMCk7XG5cdFx0Yy5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG5cdFx0Yy5mb250ID0gdGhpcy5TY29yZUZvbnQ7XG5cdFx0Yy5maWxsVGV4dCh0aGlzLlNjb3JlVGV4dCwgNzkwLCAxMDApO1xuXG5cdFx0Yy5mb250ID0gdGhpcy5TY29yZUZvbnQ7XG5cdFx0Yy5maWxsU3R5bGUgPSBcImdvbGRcIjtcblx0XHRjLmZpbGxUZXh0KHRoaXMub3B0aW9uNCwgMTAwLCAzMDApO1xuXG5cblx0XHRjLmZvbnQgPSB0aGlzLm9wdGlvbjVmb250O1xuXHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuXHRcdGMuZmlsbFRleHQodGhpcy5vcHRpb241LCAyNjAsIDMwMCk7XG5cblxuXHRcdGMuZm9udCA9IHRoaXMub3B0aW9uNWZvbnQ7XG5cdFx0Yy5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG5cdFx0Yy5maWxsVGV4dCh0aGlzLm9wdGlvbjYsIDI2MCwgMzMwKTtcblxuXHRcdGMuZm9udCA9IHRoaXMuU2NvcmVGb250O1xuXHRcdGMuZmlsbFN0eWxlID0gXCJnb2xkXCI7XG5cdFx0Yy5maWxsVGV4dCh0aGlzLm9wdGlvbjgsIDEwMCwgNDUwKTtcblxuXHRcdGMuZm9udCA9IHRoaXMub3B0aW9uNmZvbnQ7XG5cdFx0Yy5maWxsU3R5bGUgPSBcImdyZWVuXCI7XG5cdFx0Yy5maWxsVGV4dCh0aGlzLm9wdGlvbjcsIDIwMCwgNDUwKTtcblx0XHRjLnNoYWRvd0JsdXIgPSAwOyAvLyByZXNldFxuXHRcdFxuXHRcdGNvbnN0IG9wdGlvblBvc2l0aW9ucyA9IFtcblx0XHRcdHt4IDogOTAwLCB5IDogNTUwfSwgLy8gcG9zaXRpb24gZGUgXCJNZW51XCJcblx0XHRcdHt4IDogOTAwLCB5IDogNTIwfSwgLy8gcG9zaXRpb24gZGUgXCJSZXN0YXJ0XCJcblx0XHRdO1xuXG5cdFx0dGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbiwgaW5kZXgpID0+IHtcblx0XHRcdGNvbnN0IHBvcyA9IG9wdGlvblBvc2l0aW9uc1tpbmRleF07XG5cdFx0XHRpZiAoaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRPcHRpb24pIHtcblx0XHRcdFx0Yy5maWxsU3R5bGUgPSBcIiMwMEZGRkZcIjsgLy8gQmxldSBzaSBhdXRyZSBvcHRpb24gc8OpbGVjdGlvbm7DqWVcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGMuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiOyAvLyBTaW5vbiBibGFuY1xuXHRcdFx0fVxuXHRcdFx0Yy5maWxsVGV4dChvcHRpb24sIHBvcy54LCBwb3MueSk7XG5cdFx0fSk7XG5cdFx0XG5cdH1cbn0iXX0=