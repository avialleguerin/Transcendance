import { c, canvas, gameState, GameState } from './constants.js';
export default class MapMenu_c {
    constructor() {
        this.title = "Choisis ta carte üåè";
        this.options = ["Carte 1", "Carte 2", "Retour"];
        this.selectedOption = 0;
        this.optionSpacing = 60;
        this.titleFont = "bold 60px 'Press Start 2P', Black Ops One";
        this.optionFont = "30px 'Press Start 2P', Black Ops One";
        this.mapPreview = new Image();
        this.mapPreview.src = "/srcs/game/assets/City/bg.png";
        this.mapPreviewLoaded = false;
        this.mapPreview.onload = () => {
            this.mapPreviewLoaded = true;
        };
        this.bgImage = new Image();
        this.bgImage.src = "/srcs/game/assets/City/bg_menu3.jpg";
        this.bgImageLoaded = false;
        this.bgImage.onload = () => {
            this.bgImageLoaded = true;
        };
        this.nb_game_started = 0;
        this.keyPressed = {};
        this.boundKeyDown = this.handleKeyDown.bind(this);
        this.boundKeyUp = this.handleKeyUp.bind(this);
    }
    enableControls() {
        window.addEventListener("keydown", this.boundKeyDown);
        window.addEventListener("keyup", this.boundKeyUp);
    }
    disableControls() {
        window.removeEventListener("keydown", this.boundKeyDown);
        window.removeEventListener("keyup", this.boundKeyUp);
    }
    draw() {
        this.enableControls();
        c.fillStyle = "rgba(0, 0, 0, 0.75)";
        c.fillRect(0, 0, canvas.width, canvas.height);
        if (this.bgImageLoaded) {
            c.drawImage(this.bgImage, 0, 0, canvas.width, canvas.height);
        }
        c.font = this.titleFont;
        c.textAlign = "center";
        c.fillStyle = "#FFD700"; // dor√©
        c.shadowColor = "#000";
        c.shadowBlur = 10;
        c.fillText(this.title, canvas.width / 2, canvas.height / 4);
        c.shadowBlur = 0; // reset
        if (this.mapPreviewLoaded) {
            const imgWidth = 200;
            const imgHeight = 100;
            const imgX = 250;
            const imgY = 220;
            c.drawImage(this.mapPreview, imgX, imgY, imgWidth, imgHeight);
        }
        const optionPositions = [
            { x: 350, y: 350 }, // position de "Carte 1"
            { x: 700, y: 350 }, // position de "Carte 2"
            { x: 950, y: 550 }, // position de "Retour"
        ];
        c.font = this.optionFont;
        this.options.forEach((option, index) => {
            const pos = optionPositions[index];
            if (option === "Retour" && index === this.selectedOption) {
                c.fillStyle = "red"; // Rouge si "Retour" est s√©lectionn√©
            }
            else if (index === this.selectedOption) {
                c.fillStyle = "#00FFFF"; // Bleu si autre option s√©lectionn√©e
            }
            else {
                c.fillStyle = "white"; // Sinon blanc
            }
            c.fillText(option, pos.x, pos.y);
        });
    }
    handleKeyDown(event) {
        const key = event.key;
        if (this.keyPressed[key])
            return;
        this.keyPressed[key] = true;
        switch (key) {
            case "ArrowUp":
            case "w":
                this.selectedOption = (this.selectedOption - 1 + this.options.length) % this.options.length;
                break;
            case "ArrowDown":
            case "s":
                this.selectedOption = (this.selectedOption + 1) % this.options.length;
                break;
            case "Enter":
                this.handleSelect();
                break;
        }
    }
    handleKeyUp(event) {
        this.keyPressed[event.key] = false;
    }
    handleSelect() {
        const selected = this.options[this.selectedOption];
        if (selected === "Carte 1") {
            this.disableControls();
            gameState.previous = gameState.current;
            gameState.current = GameState.Play;
        }
        else if (selected === "Retour") {
            this.disableControls();
            gameState.previous = gameState.current;
            gameState.current = GameState.Menu;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFwX21lbnUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wdWJsaWMvc3RhdGljL2pzL3ZpZXdzL3BsYXRmb3JtZXIvTWFwX21lbnUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWpFLE1BQU0sQ0FBQyxPQUFPLE9BQU8sU0FBUztJQUM3QjtRQUNDLElBQUksQ0FBQyxLQUFLLEdBQUcscUJBQXFCLENBQUM7UUFDbkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLFNBQVMsR0FBRywyQ0FBMkMsQ0FBQztRQUM3RCxJQUFJLENBQUMsVUFBVSxHQUFHLHNDQUFzQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRywrQkFBK0IsQ0FBQztRQUN0RCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO1FBRTlCLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtZQUM3QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1FBQzlCLENBQUMsQ0FBQztRQUVGLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxxQ0FBcUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztRQUMzQixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxHQUFHLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7UUFDM0IsQ0FBQyxDQUFBO1FBRUQsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLENBQUM7UUFHekIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRS9DLENBQUM7SUFFRCxjQUFjO1FBQ2IsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdEQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELGVBQWU7UUFDZCxNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN6RCxNQUFNLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsSUFBSTtRQUNILElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUMsU0FBUyxHQUFHLHFCQUFxQixDQUFDO1FBQ3BDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN4QixDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5RCxDQUFDO1FBRUQsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUMsT0FBTztRQUNoQyxDQUFDLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQztRQUN2QixDQUFDLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNsQixDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM1RCxDQUFDLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVE7UUFDMUIsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUMzQixNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUM7WUFDckIsTUFBTSxTQUFTLEdBQUcsR0FBRyxDQUFDO1lBQ3RCLE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQztZQUNqQixNQUFNLElBQUksR0FBRyxHQUFHLENBQUM7WUFDakIsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQy9ELENBQUM7UUFFRCxNQUFNLGVBQWUsR0FBRztZQUN2QixFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLHdCQUF3QjtZQUM1QyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBQyxFQUFFLHdCQUF3QjtZQUMzQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLHVCQUF1QjtTQUMzQyxDQUFDO1FBRUYsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBRXpCLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQ3RDLE1BQU0sR0FBRyxHQUFHLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQyxJQUFJLE1BQU0sS0FBSyxRQUFRLElBQUksS0FBSyxLQUFLLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDMUQsQ0FBQyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBQyxvQ0FBb0M7WUFDMUQsQ0FBQztpQkFBTSxJQUFJLEtBQUssS0FBSyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQzFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUMsb0NBQW9DO1lBQzlELENBQUM7aUJBQU0sQ0FBQztnQkFDUCxDQUFDLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxDQUFDLGNBQWM7WUFDdEMsQ0FBQztZQUNELENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVELGFBQWEsQ0FBQyxLQUFLO1FBQ2xCLE1BQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUM7UUFDdEIsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQztZQUFFLE9BQU87UUFDakMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7UUFFNUIsUUFBUSxHQUFHLEVBQUUsQ0FBQztZQUNiLEtBQUssU0FBUyxDQUFDO1lBQ2YsS0FBSyxHQUFHO2dCQUNQLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO2dCQUM1RixNQUFNO1lBQ1AsS0FBSyxXQUFXLENBQUM7WUFDakIsS0FBSyxHQUFHO2dCQUNQLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO2dCQUN0RSxNQUFNO1lBQ1AsS0FBSyxPQUFPO2dCQUNYLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDcEIsTUFBTTtRQUNSLENBQUM7SUFDRixDQUFDO0lBRUQsV0FBVyxDQUFDLEtBQUs7UUFDaEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxZQUFZO1FBRVgsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDbkQsSUFBSSxRQUFRLEtBQUssU0FBUyxFQUMxQixDQUFDO1lBQ0EsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3ZCLFNBQVMsQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQztZQUN2QyxTQUFTLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUM7UUFDcEMsQ0FBQzthQUNJLElBQUksUUFBUSxLQUFLLFFBQVEsRUFDOUIsQ0FBQztZQUNBLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN2QixTQUFTLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUM7WUFDdkMsU0FBUyxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDO1FBQ3BDLENBQUM7SUFDRixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjLCBjYW52YXMsIGdhbWVTdGF0ZSwgR2FtZVN0YXRlIH0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNYXBNZW51X2Mge1xuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLnRpdGxlID0gXCJDaG9pc2lzIHRhIGNhcnRlIPCfjI9cIjtcblx0XHR0aGlzLm9wdGlvbnMgPSBbXCJDYXJ0ZSAxXCIsIFwiQ2FydGUgMlwiLCBcIlJldG91clwiXTtcblx0XHR0aGlzLnNlbGVjdGVkT3B0aW9uID0gMDtcblx0XHR0aGlzLm9wdGlvblNwYWNpbmcgPSA2MDtcblx0XHR0aGlzLnRpdGxlRm9udCA9IFwiYm9sZCA2MHB4ICdQcmVzcyBTdGFydCAyUCcsIEJsYWNrIE9wcyBPbmVcIjtcblx0XHR0aGlzLm9wdGlvbkZvbnQgPSBcIjMwcHggJ1ByZXNzIFN0YXJ0IDJQJywgQmxhY2sgT3BzIE9uZVwiO1xuXHRcdHRoaXMubWFwUHJldmlldyA9IG5ldyBJbWFnZSgpO1xuXHRcdHRoaXMubWFwUHJldmlldy5zcmMgPSBcIi9zcmNzL2dhbWUvYXNzZXRzL0NpdHkvYmcucG5nXCI7XG5cdFx0dGhpcy5tYXBQcmV2aWV3TG9hZGVkID0gZmFsc2U7XG5cblx0XHR0aGlzLm1hcFByZXZpZXcub25sb2FkID0gKCkgPT4ge1xuXHRcdFx0dGhpcy5tYXBQcmV2aWV3TG9hZGVkID0gdHJ1ZTtcblx0XHR9O1xuXG5cdFx0dGhpcy5iZ0ltYWdlID0gbmV3IEltYWdlKCk7XG5cdFx0dGhpcy5iZ0ltYWdlLnNyYyA9IFwiL3NyY3MvZ2FtZS9hc3NldHMvQ2l0eS9iZ19tZW51My5qcGdcIjtcblx0XHR0aGlzLmJnSW1hZ2VMb2FkZWQgPSBmYWxzZTtcblx0XHR0aGlzLmJnSW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuXHRcdFx0dGhpcy5iZ0ltYWdlTG9hZGVkID0gdHJ1ZTtcblx0XHR9XG5cblx0XHR0aGlzLm5iX2dhbWVfc3RhcnRlZCA9IDA7XG5cblxuXHRcdHRoaXMua2V5UHJlc3NlZCA9IHt9O1xuXHRcdHRoaXMuYm91bmRLZXlEb3duID0gdGhpcy5oYW5kbGVLZXlEb3duLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5ib3VuZEtleVVwID0gdGhpcy5oYW5kbGVLZXlVcC5iaW5kKHRoaXMpO1xuXG5cdH1cblxuXHRlbmFibGVDb250cm9scygpIHtcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5ib3VuZEtleURvd24pO1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5ib3VuZEtleVVwKTtcblx0fVxuXG5cdGRpc2FibGVDb250cm9scygpIHtcblx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5ib3VuZEtleURvd24pO1xuXHRcdHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5ib3VuZEtleVVwKTtcblx0fVxuXHRcblx0ZHJhdygpIHtcblx0XHR0aGlzLmVuYWJsZUNvbnRyb2xzKCk7XG5cdFx0Yy5maWxsU3R5bGUgPSBcInJnYmEoMCwgMCwgMCwgMC43NSlcIjtcblx0XHRjLmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cdFx0aWYgKHRoaXMuYmdJbWFnZUxvYWRlZCkge1xuXHRcdFx0Yy5kcmF3SW1hZ2UodGhpcy5iZ0ltYWdlLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXHRcdH1cblxuXHRcdGMuZm9udCA9IHRoaXMudGl0bGVGb250O1xuXHRcdGMudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcdFxuXHRcdGMuZmlsbFN0eWxlID0gXCIjRkZENzAwXCI7IC8vIGRvcsOpXG5cdFx0Yy5zaGFkb3dDb2xvciA9IFwiIzAwMFwiO1xuXHRcdGMuc2hhZG93Qmx1ciA9IDEwO1xuXHRcdGMuZmlsbFRleHQodGhpcy50aXRsZSwgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAvIDQpO1xuXHRcdGMuc2hhZG93Qmx1ciA9IDA7IC8vIHJlc2V0XG5cdFx0aWYgKHRoaXMubWFwUHJldmlld0xvYWRlZCkge1xuXHRcdFx0Y29uc3QgaW1nV2lkdGggPSAyMDA7XG5cdFx0XHRjb25zdCBpbWdIZWlnaHQgPSAxMDA7XG5cdFx0XHRjb25zdCBpbWdYID0gMjUwO1xuXHRcdFx0Y29uc3QgaW1nWSA9IDIyMDtcblx0XHRcdGMuZHJhd0ltYWdlKHRoaXMubWFwUHJldmlldywgaW1nWCwgaW1nWSwgaW1nV2lkdGgsIGltZ0hlaWdodCk7XG5cdFx0fVxuXG5cdFx0Y29uc3Qgb3B0aW9uUG9zaXRpb25zID0gW1xuXHRcdFx0eyB4OiAzNTAsIHk6IDM1MCB9LCAvLyBwb3NpdGlvbiBkZSBcIkNhcnRlIDFcIlxuXHRcdFx0eyB4OiA3MDAsIHk6IDM1MH0sIC8vIHBvc2l0aW9uIGRlIFwiQ2FydGUgMlwiXG5cdFx0XHR7IHg6IDk1MCwgeTogNTUwIH0sIC8vIHBvc2l0aW9uIGRlIFwiUmV0b3VyXCJcblx0XHRdO1xuXHRcblx0XHRjLmZvbnQgPSB0aGlzLm9wdGlvbkZvbnQ7XG5cblx0XHR0aGlzLm9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4ge1xuXHRcdFx0Y29uc3QgcG9zID0gb3B0aW9uUG9zaXRpb25zW2luZGV4XTtcblx0XHRcdGlmIChvcHRpb24gPT09IFwiUmV0b3VyXCIgJiYgaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRPcHRpb24pIHtcblx0XHRcdFx0Yy5maWxsU3R5bGUgPSBcInJlZFwiOyAvLyBSb3VnZSBzaSBcIlJldG91clwiIGVzdCBzw6lsZWN0aW9ubsOpXG5cdFx0XHR9IGVsc2UgaWYgKGluZGV4ID09PSB0aGlzLnNlbGVjdGVkT3B0aW9uKSB7XG5cdFx0XHRcdGMuZmlsbFN0eWxlID0gXCIjMDBGRkZGXCI7IC8vIEJsZXUgc2kgYXV0cmUgb3B0aW9uIHPDqWxlY3Rpb25uw6llXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjLmZpbGxTdHlsZSA9IFwid2hpdGVcIjsgLy8gU2lub24gYmxhbmNcblx0XHRcdH1cblx0XHRcdGMuZmlsbFRleHQob3B0aW9uLCBwb3MueCwgcG9zLnkpO1xuXHRcdH0pO1xuXHR9XG5cblx0aGFuZGxlS2V5RG93bihldmVudCkge1xuXHRcdGNvbnN0IGtleSA9IGV2ZW50LmtleTtcblx0XHRpZiAodGhpcy5rZXlQcmVzc2VkW2tleV0pIHJldHVybjtcblx0XHR0aGlzLmtleVByZXNzZWRba2V5XSA9IHRydWU7XG5cblx0XHRzd2l0Y2ggKGtleSkge1xuXHRcdFx0Y2FzZSBcIkFycm93VXBcIjpcblx0XHRcdGNhc2UgXCJ3XCI6XG5cdFx0XHRcdHRoaXMuc2VsZWN0ZWRPcHRpb24gPSAodGhpcy5zZWxlY3RlZE9wdGlvbiAtIDEgKyB0aGlzLm9wdGlvbnMubGVuZ3RoKSAlIHRoaXMub3B0aW9ucy5sZW5ndGg7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcIkFycm93RG93blwiOlxuXHRcdFx0Y2FzZSBcInNcIjpcblx0XHRcdFx0dGhpcy5zZWxlY3RlZE9wdGlvbiA9ICh0aGlzLnNlbGVjdGVkT3B0aW9uICsgMSkgJSB0aGlzLm9wdGlvbnMubGVuZ3RoO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgXCJFbnRlclwiOlxuXHRcdFx0XHR0aGlzLmhhbmRsZVNlbGVjdCgpO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH1cblxuXHRoYW5kbGVLZXlVcChldmVudCkge1xuXHRcdHRoaXMua2V5UHJlc3NlZFtldmVudC5rZXldID0gZmFsc2U7XG5cdH1cblxuXHRoYW5kbGVTZWxlY3QoKVxuXHR7XG5cdFx0Y29uc3Qgc2VsZWN0ZWQgPSB0aGlzLm9wdGlvbnNbdGhpcy5zZWxlY3RlZE9wdGlvbl07XG5cdFx0aWYgKHNlbGVjdGVkID09PSBcIkNhcnRlIDFcIilcblx0XHR7XG5cdFx0XHR0aGlzLmRpc2FibGVDb250cm9scygpO1xuXHRcdFx0Z2FtZVN0YXRlLnByZXZpb3VzID0gZ2FtZVN0YXRlLmN1cnJlbnQ7XG5cdFx0XHRnYW1lU3RhdGUuY3VycmVudCA9IEdhbWVTdGF0ZS5QbGF5O1xuXHRcdH1cblx0XHRlbHNlIGlmIChzZWxlY3RlZCA9PT0gXCJSZXRvdXJcIilcblx0XHR7XG5cdFx0XHR0aGlzLmRpc2FibGVDb250cm9scygpO1xuXHRcdFx0Z2FtZVN0YXRlLnByZXZpb3VzID0gZ2FtZVN0YXRlLmN1cnJlbnQ7XG5cdFx0XHRnYW1lU3RhdGUuY3VycmVudCA9IEdhbWVTdGF0ZS5NZW51O1xuXHRcdH1cblx0fVxufSJdfQ==