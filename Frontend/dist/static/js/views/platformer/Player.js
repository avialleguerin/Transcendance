import Sprite from './Sprite.js';
import { c, GRAVITY, camera, canvas } from './constants.js';
export default class Player extends Sprite {
    constructor({ position, Image_src_prefix, keys }) {
        // Commencer avec la première image
        super({ position, Image_src: Image_src_prefix + "idle_0.png", scaleX: 0.08, scaleY: 0.08 });
        this.position = position;
        this.velocity = {
            x: 0,
            y: 1,
        };
        this.keys = keys;
        // Animation properties
        this.frames = 0;
        this.frameSpeed = 10;
        this.currentSprite = 0;
        this.totalSprites = 5;
        this.state = "idle";
        this.imageSrcPrefix = Image_src_prefix;
        this.doubleJump = false;
        this.jump = 0;
        this.cantraverse = false;
        this.isGrounded = false;
        this.cantraverseDown = false;
        this.jumps = 0;
        this.cameraBox = {
            position: {
                x: this.position.x,
                y: this.position.y,
            },
            width: 200,
            height: 80,
        };
        // Cache des images
        this.imageCache = {};
        this.preloadImages();
        this.jumpCooldown = false;
        this.jumpCooldownTime = 250; // 150ms de délai entre les sauts
        console.log("keys", keys);
    }
    // Précharger toutes les images pour éviter les problèmes de chargement
    preloadImages() {
        const states = ["idle", "walk", "jumpStart", "jumpEnd", "fall", "roll"];
        const frameCount = {
            "idle": 5,
            "walk": 8,
            "jumpStart": 2,
            "jumpEnd": 3,
            "fall": 5,
            "roll": 5
        };
        states.forEach(state => {
            this.imageCache[state] = [];
            for (let i = 0; i < frameCount[state]; i++) {
                const img = new Image();
                img.src = `${this.imageSrcPrefix}${state}_${i}.png`;
                this.imageCache[state][i] = img;
            }
        });
    }
    isMoving() {
        return this.keys.left.pressed || this.keys.right.pressed;
    }
    changeState(newState) {
        if (this.state === newState)
            return; // Ne pas changer l'état si c'est le même
        this.state = newState;
        if (this.state === "idle") {
            this.totalSprites = 5;
        }
        else if (this.state === "walk") {
            this.totalSprites = 8;
        }
        else if (this.state === "jumpStart") {
            this.totalSprites = 2;
        }
        else if (this.state === "jumpEnd") {
            this.totalSprites = 3;
        }
        else if (this.state === "fall") {
            this.totalSprites = 5;
        }
        else if (this.state === "roll") {
            this.totalSprites = 5;
        }
        // Réinitialiser le sprite courant au changement d'état
        this.currentSprite = 0;
        this.updateCurrentImage();
    }
    updateCurrentImage() {
        // Utiliser l'image du cache au lieu d'en créer une nouvelle
        if (this.imageCache[this.state] && this.imageCache[this.state][this.currentSprite]) {
            this.image = this.imageCache[this.state][this.currentSprite];
        }
    }
    changeSprite() {
        if (this.frames % this.frameSpeed === 0) {
            this.currentSprite++;
            if (this.currentSprite >= this.totalSprites) {
                this.currentSprite = 0;
                if (this.state === "jumpStart" && this.velocity.y < 0) {
                    this.changeState("fall");
                }
                else if (this.state === "jumpEnd") {
                    this.changeState(this.isMoving() ? "walk" : "idle");
                }
            }
            this.updateCurrentImage();
        }
        this.frames = (this.frames + 1) % 1000;
    }
    rotate_sprite() {
        if (this.velocity.x > 0) {
            this.scaleX = Math.abs(this.scaleX);
        }
        else if (this.velocity.x < 0) {
            this.scaleX = -Math.abs(this.scaleX);
        }
    }
    drawCameraBox() {
        c.fillStyle = 'rgba(0, 255, 0, 0.5)';
        c.fillRect(this.cameraBox.position.x, this.cameraBox.position.y, this.cameraBox.width, this.cameraBox.height);
    }
    updateCameraBox() {
        this.cameraBox = {
            position: {
                x: this.position.x - 250,
                y: this.position.y - 100,
            },
            width: 800,
            height: 400,
        };
    }
    shouldPanCameraToRight({ canvas, camera }) {
        const cameraBoxRightSide = this.cameraBox.position.x + this.cameraBox.width;
        if (cameraBoxRightSide >= canvas.width + Math.abs(camera.position.x))
            camera.position.x += this.velocity.x;
    }
    shouldPanCameraToLeft({ canvas, camera }) {
        if (this.cameraBox.position.x <= 0)
            return;
        if (this.cameraBox.position.x <= Math.abs(camera.position.x))
            camera.position.x += this.velocity.x;
    }
    forceCameraToFollow({ canvas, camera }) {
        camera.position.x = this.position.x - canvas.width / 2 + this.width / 2;
        camera.position.y = this.position.y - canvas.height / 2 + this.height / 2;
    }
    shouldPanCameraToDown({ canvas, camera }) {
        if (this.cameraBox.position.y <= 0)
            return;
        if (this.cameraBox.position.y <= Math.abs(camera.position.y))
            camera.position.y += this.velocity.y;
    }
    shouldPanCameraToUP({ canvas, camera }) {
        if (this.cameraBox.position.y + this.cameraBox.height >= canvas.height + Math.abs(camera.position.y))
            camera.position.y += this.velocity.y;
    }
    update() {
        if (this.velocity.y > 1)
            this.isGrounded = false;
        this.position.y += this.velocity.y;
        this.position.x += this.velocity.x;
        if (this.isGrounded) {
            this.velocity.y = 0;
            this.doubleJump = false;
            this.jumps = 0;
            if (["fall", "jumpStart", "roll"].includes(this.state)) {
                this.changeState("jumpEnd");
                setTimeout(() => {
                    this.changeState(this.isMoving() ? "walk" : "idle");
                }, this.totalSprites * this.frameSpeed * 16);
            }
        }
        else {
            this.velocity.y += GRAVITY;
            if (this.velocity.y > 1 && this.state !== "fall")
                this.changeState("fall");
        }
        this.changeSprite();
        this.rotate_sprite();
        this.draw();
        this.updateCameraBox();
        // this.drawCameraBox();
    }
    handleJump() {
        // Vérifier si le joueur est en cooldown de saut
        if (this.jumpCooldown)
            return;
        if (this.jumps < 2) {
            if (this.jumps === 0) {
                this.velocity.y = -10;
                this.changeState("jumpStart");
                this.jumps = 1;
                this.isGrounded = false;
                this.cantraverse = false;
                // Activer le cooldown
                this.jumpCooldown = true;
                setTimeout(() => {
                    this.jumpCooldown = false;
                }, this.jumpCooldownTime);
            }
            else if (this.jumps === 1 && !this.doubleJump) {
                this.velocity.y = -10;
                this.changeState("roll");
                this.jumps = 2;
                this.doubleJump = true;
                this.isGrounded = false;
                this.cantraverse = false;
                // Activer le cooldown
                this.jumpCooldown = true;
                setTimeout(() => {
                    this.jumpCooldown = false;
                }, this.jumpCooldownTime);
            }
        }
    }
    checkCollision(platforms) {
        const hitboxOffsetX = 60;
        const hitboxOffsetY = 90;
        const hitboxOffsetBottom = 25;
        const hitboxX = this.position.x + hitboxOffsetX;
        const hitboxY = this.position.y + hitboxOffsetY;
        const hitboxWidth = this.width - hitboxOffsetX * 2;
        const hitboxHeight = this.height - hitboxOffsetY - hitboxOffsetBottom;
        let onPlatform = false;
        for (let platform of platforms) {
            const px = platform.position.x;
            const py = platform.position.y;
            const pw = platform.width;
            const ph = platform.height;
            const collision = hitboxX < px + pw &&
                hitboxX + hitboxWidth > px &&
                hitboxY < py + ph &&
                hitboxY + hitboxHeight > py;
            if (collision) {
                const prevBottom = hitboxY + hitboxHeight - this.velocity.y;
                const prevTop = hitboxY - this.velocity.y;
                const prevRight = hitboxX + hitboxWidth - this.velocity.x;
                const prevLeft = hitboxX - this.velocity.x;
                if (prevBottom <= py && this.velocity.y >= 0) {
                    if (!this.cantraverseDown) {
                        this.velocity.y = 0;
                        this.jumps = 0;
                        this.doubleJump = false;
                        this.position.y = py - this.height + hitboxOffsetBottom;
                        this.isGrounded = true;
                        onPlatform = true;
                    }
                }
                else if (prevTop >= py + ph && this.velocity.y < 0) {
                    if (!this.cantraverse)
                        this.velocity.y = 0;
                }
                else if (prevLeft >= px + pw && this.velocity.x < 0) {
                    this.velocity.x = 0;
                    this.position.x = px + pw - hitboxOffsetX;
                }
                else if (prevRight <= px && this.velocity.x > 0) {
                    this.velocity.x = 0;
                }
            }
        }
        if (!onPlatform && this.isGrounded && this.velocity.y === 0) {
            this.isGrounded = false;
            this.velocity.y = 0.1;
        }
    }
    drawHitbox() {
        const hitboxOffsetX = 60;
        const hitboxOffsetY = 90;
        const hitboxOffsetBottom = 25;
        c.fillStyle = 'rgba(255, 0, 0, 0.5)';
        c.fillRect(this.position.x + hitboxOffsetX, this.position.y + hitboxOffsetY, this.width - (hitboxOffsetX * 2), this.height - hitboxOffsetY - hitboxOffsetBottom);
    }
    reset_Game() {
        this.position.x = 931;
        this.position.y = 629.16;
        this.velocity.x = 0;
        this.velocity.y = 1;
        this.isGrounded = false;
        this.doubleJump = false;
        this.jumps = 0;
        this.cantraverse = false;
        this.cantraverseDown = false;
        this.jumpCooldown = false;
        this.changeState("idle");
        this.forceCameraToFollow({ canvas, camera });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGxheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHVibGljL3N0YXRpYy9qcy92aWV3cy9wbGF0Zm9ybWVyL1BsYXllci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLE1BQU0sTUFBTSxhQUFhLENBQUM7QUFDakMsT0FBTyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzVELE1BQU0sQ0FBQyxPQUFPLE9BQU8sTUFBTyxTQUFRLE1BQU07SUFFdEMsWUFBWSxFQUFDLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUM7UUFDMUMsbUNBQW1DO1FBQ25DLEtBQUssQ0FBQyxFQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEdBQUcsWUFBWSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7UUFFMUYsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLFFBQVEsR0FBRztZQUNaLENBQUMsRUFBRSxDQUFDO1lBQ0osQ0FBQyxFQUFFLENBQUM7U0FDUCxDQUFDO1FBQ0YsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFFakIsdUJBQXVCO1FBQ3ZCLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxjQUFjLEdBQUcsZ0JBQWdCLENBQUM7UUFDdkMsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDeEIsSUFBSSxDQUFDLElBQUksR0FB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Q0FBQztRQUN0QixJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDekIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUN4QixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1FBQzdCLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1FBQzFCLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFNwcml0ZSBmcm9tICcuL1Nwcml0ZS5qcyc7XG5pbXBvcnQgeyBjLCBHUkFWSVRZLCBjYW1lcmEsIGNhbnZhcyB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQbGF5ZXIgZXh0ZW5kcyBTcHJpdGUge1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKHtwb3NpdGlvbiwgSW1hZ2Vfc3JjX3ByZWZpeCwga2V5c30pIHtcbiAgICAgICAgLy8gQ29tbWVuY2VyIGF2ZWMgbGEgcHJlbWnDqHJlIGltYWdlXG4gICAgICAgIHN1cGVyKHtwb3NpdGlvbiwgSW1hZ2Vfc3JjOiBJbWFnZV9zcmNfcHJlZml4ICsgXCJpZGxlXzAucG5nXCIsIHNjYWxlWDogMC4wOCwgc2NhbGVZOiAwLjA4fSk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIHRoaXMudmVsb2NpdHkgPSB7XG4gICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgeTogMSxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5rZXlzID0ga2V5cztcbiAgICAgICAgXG4gICAgICAgIC8vIEFuaW1hdGlvbiBwcm9wZXJ0aWVzXG4gICAgICAgIHRoaXMuZnJhbWVzID0gMDtcbiAgICAgICAgdGhpcy5mcmFtZVNwZWVkID0gMTA7XG4gICAgICAgIHRoaXMuY3VycmVudFNwcml0ZSA9IDA7XG4gICAgICAgIHRoaXMudG90YWxTcHJpdGVzID0gNTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IFwiaWRsZVwiO1xuICAgICAgICB0aGlzLmltYWdlU3JjUHJlZml4ID0gSW1hZ2Vfc3JjX3ByZWZpeDtcbiAgICAgICAgdGhpcy5kb3VibGVKdW1wID0gZmFsc2U7XG4gICAgICAgIHRoaXMuanVtcCA9IDA7XG4gICAgICAgIHRoaXMuY2FudHJhdmVyc2UgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0dyb3VuZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2FudHJhdmVyc2VEb3duID0gZmFsc2U7XG4gICAgICAgIHRoaXMuanVtcHMgPSAwO1xuICAgICAgICB0aGlzLmNhbWVyYUJveCA9IHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgeDogdGhpcy5wb3NpdGlvbi54LFxuICAgICAgICAgICAgICAgIHk6IHRoaXMucG9zaXRpb24ueSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3aWR0aDogMjAwLFxuICAgICAgICAgICAgaGVpZ2h0OiA4MCxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBDYWNoZSBkZXMgaW1hZ2VzXG4gICAgICAgIHRoaXMuaW1hZ2VDYWNoZSA9IHt9O1xuICAgICAgICB0aGlzLnByZWxvYWRJbWFnZXMoKTtcblxuXHRcdHRoaXMuanVtcENvb2xkb3duID0gZmFsc2U7XG4gICBcdFx0dGhpcy5qdW1wQ29vbGRvd25UaW1lID0gMjUwOyAvLyAxNTBtcyBkZSBkw6lsYWkgZW50cmUgbGVzIHNhdXRzXG5cbiAgICAgICAgY29uc29sZS5sb2coXCJrZXlzXCIsIGtleXMpO1xuICAgIH1cblxuICAgIC8vIFByw6ljaGFyZ2VyIHRvdXRlcyBsZXMgaW1hZ2VzIHBvdXIgw6l2aXRlciBsZXMgcHJvYmzDqG1lcyBkZSBjaGFyZ2VtZW50XG4gICAgcHJlbG9hZEltYWdlcygpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVzID0gW1wiaWRsZVwiLCBcIndhbGtcIiwgXCJqdW1wU3RhcnRcIiwgXCJqdW1wRW5kXCIsIFwiZmFsbFwiLCBcInJvbGxcIl07XG4gICAgICAgIGNvbnN0IGZyYW1lQ291bnQgPSB7XG4gICAgICAgICAgICBcImlkbGVcIjogNSxcbiAgICAgICAgICAgIFwid2Fsa1wiOiA4LFxuICAgICAgICAgICAgXCJqdW1wU3RhcnRcIjogMixcbiAgICAgICAgICAgIFwianVtcEVuZFwiOiAzLFxuICAgICAgICAgICAgXCJmYWxsXCI6IDUsXG4gICAgICAgICAgICBcInJvbGxcIjogNVxuICAgICAgICB9O1xuXG4gICAgICAgIHN0YXRlcy5mb3JFYWNoKHN0YXRlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VDYWNoZVtzdGF0ZV0gPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZnJhbWVDb3VudFtzdGF0ZV07IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgICAgIGltZy5zcmMgPSBgJHt0aGlzLmltYWdlU3JjUHJlZml4fSR7c3RhdGV9XyR7aX0ucG5nYDtcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlQ2FjaGVbc3RhdGVdW2ldID0gaW1nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpc01vdmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua2V5cy5sZWZ0LnByZXNzZWQgfHwgdGhpcy5rZXlzLnJpZ2h0LnByZXNzZWQ7XG4gICAgfVxuICAgIFxuICAgIGNoYW5nZVN0YXRlKG5ld1N0YXRlKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBuZXdTdGF0ZSkgcmV0dXJuOyAvLyBOZSBwYXMgY2hhbmdlciBsJ8OpdGF0IHNpIGMnZXN0IGxlIG3Dqm1lXG4gICAgICAgIFxuICAgICAgICB0aGlzLnN0YXRlID0gbmV3U3RhdGU7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBcImlkbGVcIikge1xuICAgICAgICAgICAgdGhpcy50b3RhbFNwcml0ZXMgPSA1O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdGUgPT09IFwid2Fsa1wiKSB7XG4gICAgICAgICAgICB0aGlzLnRvdGFsU3ByaXRlcyA9IDg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0ZSA9PT0gXCJqdW1wU3RhcnRcIikge1xuICAgICAgICAgICAgdGhpcy50b3RhbFNwcml0ZXMgPSAyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdGUgPT09IFwianVtcEVuZFwiKSB7XG4gICAgICAgICAgICB0aGlzLnRvdGFsU3ByaXRlcyA9IDM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0ZSA9PT0gXCJmYWxsXCIpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWxTcHJpdGVzID0gNTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXRlID09PSBcInJvbGxcIikge1xuICAgICAgICAgICAgdGhpcy50b3RhbFNwcml0ZXMgPSA1O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBSw6lpbml0aWFsaXNlciBsZSBzcHJpdGUgY291cmFudCBhdSBjaGFuZ2VtZW50IGQnw6l0YXRcbiAgICAgICAgdGhpcy5jdXJyZW50U3ByaXRlID0gMDtcbiAgICAgICAgdGhpcy51cGRhdGVDdXJyZW50SW1hZ2UoKTtcbiAgICB9XG5cbiAgICB1cGRhdGVDdXJyZW50SW1hZ2UoKSB7XG4gICAgICAgIC8vIFV0aWxpc2VyIGwnaW1hZ2UgZHUgY2FjaGUgYXUgbGlldSBkJ2VuIGNyw6llciB1bmUgbm91dmVsbGVcbiAgICAgICAgaWYgKHRoaXMuaW1hZ2VDYWNoZVt0aGlzLnN0YXRlXSAmJiB0aGlzLmltYWdlQ2FjaGVbdGhpcy5zdGF0ZV1bdGhpcy5jdXJyZW50U3ByaXRlXSkge1xuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuaW1hZ2VDYWNoZVt0aGlzLnN0YXRlXVt0aGlzLmN1cnJlbnRTcHJpdGVdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2hhbmdlU3ByaXRlKCkge1xuICAgICAgICBpZiAodGhpcy5mcmFtZXMgJSB0aGlzLmZyYW1lU3BlZWQgPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNwcml0ZSsrO1xuICAgIFxuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFNwcml0ZSA+PSB0aGlzLnRvdGFsU3ByaXRlcykge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFNwcml0ZSA9IDA7XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IFwianVtcFN0YXJ0XCIgJiYgdGhpcy52ZWxvY2l0eS55IDwgMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKFwiZmFsbFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0ZSA9PT0gXCJqdW1wRW5kXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VTdGF0ZSh0aGlzLmlzTW92aW5nKCkgPyBcIndhbGtcIiA6IFwiaWRsZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnJlbnRJbWFnZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZnJhbWVzID0gKHRoaXMuZnJhbWVzICsgMSkgJSAxMDAwO1xuICAgIH1cblx0XG5cblx0cm90YXRlX3Nwcml0ZSgpXG5cdHtcblx0XHRpZiAodGhpcy52ZWxvY2l0eS54ID4gMClcblx0XHR7XG5cdFx0XHR0aGlzLnNjYWxlWCA9IE1hdGguYWJzKHRoaXMuc2NhbGVYKTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAodGhpcy52ZWxvY2l0eS54IDwgMClcblx0XHR7XG5cdFx0XHR0aGlzLnNjYWxlWCA9IC1NYXRoLmFicyh0aGlzLnNjYWxlWCk7XG5cdFx0fVxuXHR9XG5cblx0ZHJhd0NhbWVyYUJveCgpXG5cdHtcblx0XHRjLmZpbGxTdHlsZSA9ICdyZ2JhKDAsIDI1NSwgMCwgMC41KSc7XG5cdFx0Yy5maWxsUmVjdChcblx0XHRcdHRoaXMuY2FtZXJhQm94LnBvc2l0aW9uLngsXG5cdFx0XHR0aGlzLmNhbWVyYUJveC5wb3NpdGlvbi55LFxuXHRcdFx0dGhpcy5jYW1lcmFCb3gud2lkdGgsXG5cdFx0XHR0aGlzLmNhbWVyYUJveC5oZWlnaHRcblx0XHQpO1xuXHR9XG5cblx0dXBkYXRlQ2FtZXJhQm94KClcblx0e1xuXHRcdHRoaXMuY2FtZXJhQm94ID0ge1xuXHRcdFx0cG9zaXRpb246IHtcblx0XHRcdFx0eDogdGhpcy5wb3NpdGlvbi54IC0gMjUwLFxuXHRcdFx0XHR5OiB0aGlzLnBvc2l0aW9uLnkgLSAxMDAsXG5cdFx0XHR9LFxuXHRcdFx0d2lkdGg6IDgwMCxcblx0XHRcdGhlaWdodDogNDAwLFxuXHRcdH07XG5cdH1cblxuXHRzaG91bGRQYW5DYW1lcmFUb1JpZ2h0KHtjYW52YXMsIGNhbWVyYX0pXG5cdHtcblx0XHRjb25zdCBjYW1lcmFCb3hSaWdodFNpZGUgPSB0aGlzLmNhbWVyYUJveC5wb3NpdGlvbi54ICsgdGhpcy5jYW1lcmFCb3gud2lkdGg7XG5cblx0XHRpZiAoY2FtZXJhQm94UmlnaHRTaWRlID49IGNhbnZhcy53aWR0aCArIE1hdGguYWJzKGNhbWVyYS5wb3NpdGlvbi54KSlcblx0XHRcdGNhbWVyYS5wb3NpdGlvbi54ICs9IHRoaXMudmVsb2NpdHkueDtcblx0fVxuXG5cdHNob3VsZFBhbkNhbWVyYVRvTGVmdCh7Y2FudmFzLCBjYW1lcmF9KVxuXHR7XG5cdFx0aWYgKHRoaXMuY2FtZXJhQm94LnBvc2l0aW9uLnggPD0gMClcblx0XHRcdHJldHVybjtcblx0XG5cdFx0aWYgKHRoaXMuY2FtZXJhQm94LnBvc2l0aW9uLnggPD0gTWF0aC5hYnMoY2FtZXJhLnBvc2l0aW9uLngpKVxuXHRcdFx0Y2FtZXJhLnBvc2l0aW9uLnggKz0gdGhpcy52ZWxvY2l0eS54O1xuXHR9XG5cblx0Zm9yY2VDYW1lcmFUb0ZvbGxvdyh7IGNhbnZhcywgY2FtZXJhIH0pXG5cdHtcblx0XHRjYW1lcmEucG9zaXRpb24ueCA9IHRoaXMucG9zaXRpb24ueCAtIGNhbnZhcy53aWR0aCAvIDIgKyB0aGlzLndpZHRoIC8gMjtcblx0XHRjYW1lcmEucG9zaXRpb24ueSA9IHRoaXMucG9zaXRpb24ueSAtIGNhbnZhcy5oZWlnaHQgLyAyICsgdGhpcy5oZWlnaHQgLyAyO1xuXHR9XG5cblx0c2hvdWxkUGFuQ2FtZXJhVG9Eb3duKHtjYW52YXMsIGNhbWVyYX0pIHtcblx0XHRpZiAodGhpcy5jYW1lcmFCb3gucG9zaXRpb24ueSA8PSAwKVxuXHRcdFx0cmV0dXJuO1xuXHRcdGlmICh0aGlzLmNhbWVyYUJveC5wb3NpdGlvbi55IDw9IE1hdGguYWJzKGNhbWVyYS5wb3NpdGlvbi55KSlcblx0XHRcdGNhbWVyYS5wb3NpdGlvbi55ICs9IHRoaXMudmVsb2NpdHkueTtcblx0fVxuXG5cdHNob3VsZFBhbkNhbWVyYVRvVVAoe2NhbnZhcywgY2FtZXJhfSlcblx0e1xuXHRcdGlmICh0aGlzLmNhbWVyYUJveC5wb3NpdGlvbi55ICsgdGhpcy5jYW1lcmFCb3guaGVpZ2h0ID49IGNhbnZhcy5oZWlnaHQgKyBNYXRoLmFicyhjYW1lcmEucG9zaXRpb24ueSkpXG5cdFx0XHRjYW1lcmEucG9zaXRpb24ueSArPSB0aGlzLnZlbG9jaXR5Lnk7XG5cdH1cblxuXHR1cGRhdGUoKVxuXHR7XG5cdFx0aWYgKHRoaXMudmVsb2NpdHkueSA+IDEpXG5cdFx0XHR0aGlzLmlzR3JvdW5kZWQgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLnBvc2l0aW9uLnkgKz0gdGhpcy52ZWxvY2l0eS55O1xuXHRcdHRoaXMucG9zaXRpb24ueCArPSB0aGlzLnZlbG9jaXR5Lng7XG5cdFxuXHRcdGlmICh0aGlzLmlzR3JvdW5kZWQpXG5cdFx0e1xuXHRcdFx0dGhpcy52ZWxvY2l0eS55ID0gMDtcblx0XHRcdHRoaXMuZG91YmxlSnVtcCA9IGZhbHNlO1xuXHRcdFx0dGhpcy5qdW1wcyA9IDA7XG5cdFxuXHRcdFx0aWYgKFtcImZhbGxcIiwgXCJqdW1wU3RhcnRcIiwgXCJyb2xsXCJdLmluY2x1ZGVzKHRoaXMuc3RhdGUpKVxuXHRcdFx0e1xuXHRcdFx0XHR0aGlzLmNoYW5nZVN0YXRlKFwianVtcEVuZFwiKTtcblx0XG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT5cblx0XHRcdFx0e1xuXHRcdFx0XHRcdHRoaXMuY2hhbmdlU3RhdGUodGhpcy5pc01vdmluZygpID8gXCJ3YWxrXCIgOiBcImlkbGVcIik7XG5cdFx0XHRcdH0sIHRoaXMudG90YWxTcHJpdGVzICogdGhpcy5mcmFtZVNwZWVkICogMTYpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dGhpcy52ZWxvY2l0eS55ICs9IEdSQVZJVFk7XG5cdFxuXHRcdFx0aWYgKHRoaXMudmVsb2NpdHkueSA+IDEgJiYgdGhpcy5zdGF0ZSAhPT0gXCJmYWxsXCIpXG5cdFx0XHRcdHRoaXMuY2hhbmdlU3RhdGUoXCJmYWxsXCIpO1xuXHRcdH1cblx0XG5cdFx0dGhpcy5jaGFuZ2VTcHJpdGUoKTtcblx0XHR0aGlzLnJvdGF0ZV9zcHJpdGUoKTtcblx0XHR0aGlzLmRyYXcoKTtcblx0XHR0aGlzLnVwZGF0ZUNhbWVyYUJveCgpO1xuXHRcdC8vIHRoaXMuZHJhd0NhbWVyYUJveCgpO1xuXHR9XG5cdFxuXHRcblx0aGFuZGxlSnVtcCgpIHtcblx0XHQvLyBWw6lyaWZpZXIgc2kgbGUgam91ZXVyIGVzdCBlbiBjb29sZG93biBkZSBzYXV0XG5cdFx0aWYgKHRoaXMuanVtcENvb2xkb3duKSByZXR1cm47XG5cdFx0XG5cdFx0aWYgKHRoaXMuanVtcHMgPCAyKSB7XG5cdFx0XHRpZiAodGhpcy5qdW1wcyA9PT0gMCkge1xuXHRcdFx0XHR0aGlzLnZlbG9jaXR5LnkgPSAtMTA7XG5cdFx0XHRcdHRoaXMuY2hhbmdlU3RhdGUoXCJqdW1wU3RhcnRcIik7XG5cdFx0XHRcdHRoaXMuanVtcHMgPSAxO1xuXHRcdFx0XHR0aGlzLmlzR3JvdW5kZWQgPSBmYWxzZTtcblx0XHRcdFx0dGhpcy5jYW50cmF2ZXJzZSA9IGZhbHNlO1xuXHRcdFx0XHRcblx0XHRcdFx0Ly8gQWN0aXZlciBsZSBjb29sZG93blxuXHRcdFx0XHR0aGlzLmp1bXBDb29sZG93biA9IHRydWU7XG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMuanVtcENvb2xkb3duID0gZmFsc2U7XG5cdFx0XHRcdH0sIHRoaXMuanVtcENvb2xkb3duVGltZSk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmICh0aGlzLmp1bXBzID09PSAxICYmICF0aGlzLmRvdWJsZUp1bXApIHtcblx0XHRcdFx0dGhpcy52ZWxvY2l0eS55ID0gLTEwO1xuXHRcdFx0XHR0aGlzLmNoYW5nZVN0YXRlKFwicm9sbFwiKTtcblx0XHRcdFx0dGhpcy5qdW1wcyA9IDI7XG5cdFx0XHRcdHRoaXMuZG91YmxlSnVtcCA9IHRydWU7XG5cdFx0XHRcdHRoaXMuaXNHcm91bmRlZCA9IGZhbHNlO1xuXHRcdFx0XHR0aGlzLmNhbnRyYXZlcnNlID0gZmFsc2U7XG5cdFx0XHRcdFxuXHRcdFx0XHQvLyBBY3RpdmVyIGxlIGNvb2xkb3duXG5cdFx0XHRcdHRoaXMuanVtcENvb2xkb3duID0gdHJ1ZTtcblx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5qdW1wQ29vbGRvd24gPSBmYWxzZTtcblx0XHRcdFx0fSwgdGhpcy5qdW1wQ29vbGRvd25UaW1lKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGNoZWNrQ29sbGlzaW9uKHBsYXRmb3Jtcylcblx0e1xuXHRcdGNvbnN0IGhpdGJveE9mZnNldFggPSA2MDtcblx0XHRjb25zdCBoaXRib3hPZmZzZXRZID0gOTA7XG5cdFx0Y29uc3QgaGl0Ym94T2Zmc2V0Qm90dG9tID0gMjU7XG5cdFxuXHRcdGNvbnN0IGhpdGJveFggPSB0aGlzLnBvc2l0aW9uLnggKyBoaXRib3hPZmZzZXRYO1xuXHRcdGNvbnN0IGhpdGJveFkgPSB0aGlzLnBvc2l0aW9uLnkgKyBoaXRib3hPZmZzZXRZO1xuXHRcdGNvbnN0IGhpdGJveFdpZHRoID0gdGhpcy53aWR0aCAtIGhpdGJveE9mZnNldFggKiAyO1xuXHRcdGNvbnN0IGhpdGJveEhlaWdodCA9IHRoaXMuaGVpZ2h0IC0gaGl0Ym94T2Zmc2V0WSAtIGhpdGJveE9mZnNldEJvdHRvbTtcblxuXHRcdGxldCBvblBsYXRmb3JtID0gZmFsc2U7XG5cdFxuXHRcdGZvciAobGV0IHBsYXRmb3JtIG9mIHBsYXRmb3Jtcylcblx0XHR7XG5cdFx0XHRjb25zdCBweCA9IHBsYXRmb3JtLnBvc2l0aW9uLng7XG5cdFx0XHRjb25zdCBweSA9IHBsYXRmb3JtLnBvc2l0aW9uLnk7XG5cdFx0XHRjb25zdCBwdyA9IHBsYXRmb3JtLndpZHRoO1xuXHRcdFx0Y29uc3QgcGggPSBwbGF0Zm9ybS5oZWlnaHQ7XG5cblx0XHRcdGNvbnN0IGNvbGxpc2lvbiA9IGhpdGJveFggPCBweCArIHB3ICYmXG5cdFx0XHRcdFx0XHRcdGhpdGJveFggKyBoaXRib3hXaWR0aCA+IHB4ICYmXG5cdFx0XHRcdFx0XHRcdGhpdGJveFkgPCBweSArIHBoICYmXG5cdFx0XHRcdFx0XHRcdGhpdGJveFkgKyBoaXRib3hIZWlnaHQgPiBweTtcblx0XG5cdFx0XHRpZiAoY29sbGlzaW9uKVxuXHRcdFx0e1xuXHRcdFx0XHRjb25zdCBwcmV2Qm90dG9tID0gaGl0Ym94WSArIGhpdGJveEhlaWdodCAtIHRoaXMudmVsb2NpdHkueTtcblx0XHRcdFx0Y29uc3QgcHJldlRvcCA9IGhpdGJveFkgLSB0aGlzLnZlbG9jaXR5Lnk7XG5cdFx0XHRcdGNvbnN0IHByZXZSaWdodCA9IGhpdGJveFggKyBoaXRib3hXaWR0aCAtIHRoaXMudmVsb2NpdHkueDtcblx0XHRcdFx0Y29uc3QgcHJldkxlZnQgPSBoaXRib3hYIC0gdGhpcy52ZWxvY2l0eS54O1xuXG5cdFx0XHRcdGlmIChwcmV2Qm90dG9tIDw9IHB5ICYmIHRoaXMudmVsb2NpdHkueSA+PSAwKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0aWYgKCF0aGlzLmNhbnRyYXZlcnNlRG93bilcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHR0aGlzLnZlbG9jaXR5LnkgPSAwO1xuXHRcdFx0XHRcdFx0dGhpcy5qdW1wcyA9IDA7XG5cdFx0XHRcdFx0XHR0aGlzLmRvdWJsZUp1bXAgPSBmYWxzZTtcblx0XHRcdFx0XHRcdHRoaXMucG9zaXRpb24ueSA9IHB5IC0gdGhpcy5oZWlnaHQgKyBoaXRib3hPZmZzZXRCb3R0b207XG5cdFx0XHRcdFx0XHR0aGlzLmlzR3JvdW5kZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0b25QbGF0Zm9ybSA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2UgaWYgKHByZXZUb3AgPj0gcHkgKyBwaCAmJiB0aGlzLnZlbG9jaXR5LnkgPCAwKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0aWYgKCF0aGlzLmNhbnRyYXZlcnNlKVxuXHRcdFx0XHRcdFx0dGhpcy52ZWxvY2l0eS55ID0gMDtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIGlmIChwcmV2TGVmdCA+PSBweCArIHB3ICYmIHRoaXMudmVsb2NpdHkueCA8IDApXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0aGlzLnZlbG9jaXR5LnggPSAwO1xuXHRcdFx0XHRcdHRoaXMucG9zaXRpb24ueCA9IHB4ICsgcHcgLSBoaXRib3hPZmZzZXRYO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZWxzZSBpZiAocHJldlJpZ2h0IDw9IHB4ICYmIHRoaXMudmVsb2NpdHkueCA+IDApIHtcblx0XHRcdFx0XHR0aGlzLnZlbG9jaXR5LnggPSAwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGlmICghb25QbGF0Zm9ybSAmJiB0aGlzLmlzR3JvdW5kZWQgJiYgdGhpcy52ZWxvY2l0eS55ID09PSAwKVxuXHRcdHtcblx0XHRcdHRoaXMuaXNHcm91bmRlZCA9IGZhbHNlO1xuXHRcdFx0dGhpcy52ZWxvY2l0eS55ID0gMC4xO1xuXHRcdH1cblx0fVxuXHRcblx0ZHJhd0hpdGJveCgpXG5cdHtcblx0XHRjb25zdCBoaXRib3hPZmZzZXRYID0gNjA7XG5cdFx0Y29uc3QgaGl0Ym94T2Zmc2V0WSA9IDkwO1xuXHRcdGNvbnN0IGhpdGJveE9mZnNldEJvdHRvbSA9IDI1O1xuXHRcdFxuXHRcdGMuZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAwLCAwLCAwLjUpJztcblx0XHRjLmZpbGxSZWN0KFxuXHRcdFx0dGhpcy5wb3NpdGlvbi54ICsgaGl0Ym94T2Zmc2V0WCwgXG5cdFx0XHR0aGlzLnBvc2l0aW9uLnkgKyBoaXRib3hPZmZzZXRZLFxuXHRcdFx0dGhpcy53aWR0aCAtIChoaXRib3hPZmZzZXRYICogMiksXG5cdFx0XHR0aGlzLmhlaWdodCAtIGhpdGJveE9mZnNldFkgLSBoaXRib3hPZmZzZXRCb3R0b21cblx0XHQpO1xuXHR9XG5cblx0cmVzZXRfR2FtZSgpXG5cdHtcblx0XHR0aGlzLnBvc2l0aW9uLnggPSA5MzE7XG5cdFx0dGhpcy5wb3NpdGlvbi55ID0gNjI5LjE2O1xuXHRcdHRoaXMudmVsb2NpdHkueCA9IDA7XG5cdFx0dGhpcy52ZWxvY2l0eS55ID0gMTtcblx0XHR0aGlzLmlzR3JvdW5kZWQgPSBmYWxzZTtcblx0XHR0aGlzLmRvdWJsZUp1bXAgPSBmYWxzZTtcblx0XHR0aGlzLmp1bXBzID0gMDtcblx0XHR0aGlzLmNhbnRyYXZlcnNlID0gZmFsc2U7XG5cdFx0dGhpcy5jYW50cmF2ZXJzZURvd24gPSBmYWxzZTtcblx0XHR0aGlzLmp1bXBDb29sZG93biA9IGZhbHNlO1xuXHRcdHRoaXMuY2hhbmdlU3RhdGUoXCJpZGxlXCIpO1xuXHRcdHRoaXMuZm9yY2VDYW1lcmFUb0ZvbGxvdyh7IGNhbnZhcywgY2FtZXJhIH0pO1xuXHR9XG59Il19