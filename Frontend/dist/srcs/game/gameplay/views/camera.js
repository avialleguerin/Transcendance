import { createLoadingOverlay, removeLoadingOverlay } from './loading_screen.js';
import { create_environment_view1, create_environment_view2 } from '../init_game.js';
import { init_skins_perso_player1, init_skins_perso_player2 } from '../solo/skin/init_skin_perso.js';
import { init_skins_perso_player1_multi, init_skins_perso_player2_multi, init_skins_perso_player3_multi, init_skins_perso_player4_multi } from '../multiplayer/init_skin_perso_multi.js';
import { destroy_all_by_metadata_skin } from '../solo/skin/init_skin_perso.js';
import { init_skins_perso_first, init_skins_perso_seconde } from '../solo/skin/init_skin_player_podium.js';
import { init_skins_perso_player1_multi_podium, init_skins_perso_player2_multi_podium, init_skins_perso_player3_multi_podium, init_skins_perso_player4_multi_podium } from '../multiplayer/init_teamPlayer_podium.js';
import { getSoloGameStart, getAIGameStart, getMultiGameStart } from '../babylon.js';
const views = {
    default: {
        position: new BABYLON.Vector3(-45.79301951065982, 5.879735371044789, -31.342210947081313),
        rotation: new BABYLON.Vector3(-0.029665280069011667, -2.566387085794712, 0)
    },
    vue1: {
        position: new BABYLON.Vector3(-121.10280824924784, 24.6207952767514, -174.07209971938224),
        rotation: new BABYLON.Vector3(-0.11883037823762914, -2.5943873381271416, 0)
    },
    vue2: {
        position: new BABYLON.Vector3(-18.362079870354155, 108.25251269427612, 25.862876364155152),
        rotation: new BABYLON.Vector3(0.030709202934622, -3.1253471752812234, 0)
    },
    vue3: {
        position: new BABYLON.Vector3(-54.75561421839585, 323.8935256263618, -69.46923226717574),
        rotation: new BABYLON.Vector3(0.04110218558828448, -1.5940112517089828, 0)
    },
    vue4: {
        position: new BABYLON.Vector3(86.16210646582958, 341.93369480348, -72.48687267164757),
        rotation: new BABYLON.Vector3(0.27911301240509906, -1.572511251708983, 0)
    },
    aerienne: {
        position: new BABYLON.Vector3(0, 100, 0),
        rotation: new BABYLON.Vector3(Math.PI / 2, 0, 0)
    },
    winner: {
        position: new BABYLON.Vector3(-30, 309, -55),
        rotation: new BABYLON.Vector3(0.04585831303667534, -1.5694725474476896, 0)
    },
    tournament: {
        position: new BABYLON.Vector3(-18.428470385182532, 107.62138152604801, -14.139896745255728),
        rotation: new BABYLON.Vector3(-0.03079079706537804, -3.1248471752812232, 0)
    },
    platformer: {
        position: new BABYLON.Vector3(-6.5182094677032865, 105.9949400814292, -3.0295165949940666),
        rotation: new BABYLON.Vector3(0.30031205500253655, -4.721353872946304, 0)
    }
};
let currentTransitionAnimation = null;
let isLoading = false;
let targetView = null;
// Fonction de transition améliorée avec courbe d'animation
export function smoothTransition(targetPosition, targetRotation, duration = 1.5) {
    // Annuler l'animation précédente si elle existe
    if (currentTransitionAnimation) {
        scene.onBeforeRenderObservable.remove(currentTransitionAnimation);
    }
    const startPosition = camera.position.clone();
    const startRotation = camera.rotation.clone();
    const startTime = performance.now();
    // Créer des vecteurs temporaires pour éviter la création d'objets pendant l'animation
    const tempPosition = new BABYLON.Vector3();
    const tempRotation = new BABYLON.Vector3();
    // Fonction d'ease (lissage)
    const easeInOutCubic = t => t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
    currentTransitionAnimation = scene.onBeforeRenderObservable.add(() => {
        const currentTime = performance.now();
        let t = (currentTime - startTime) / (duration * 1000);
        if (t >= 1) {
            camera.position.copyFrom(targetPosition);
            camera.rotation.copyFrom(targetRotation);
            scene.onBeforeRenderObservable.remove(currentTransitionAnimation);
            currentTransitionAnimation = null;
            return;
        }
        // Appliquer la fonction d'ease
        const easedT = easeInOutCubic(t);
        // Interpolation de la position
        BABYLON.Vector3.LerpToRef(startPosition, targetPosition, easedT, tempPosition);
        camera.position.copyFrom(tempPosition);
        // Interpolation de la rotation
        BABYLON.Vector3.LerpToRef(startRotation, targetRotation, easedT, tempRotation);
        camera.rotation.copyFrom(tempRotation);
    });
}
export function changeView(viewName, force = false) {
    const view = views[viewName];
    if (!view || (window.currentView === viewName && !force))
        return;
    const previousView = window.currentView;
    if (!isLoading || force) {
        window.currentView = viewName;
        targetView = viewName;
        smoothTransition(view.position, view.rotation, 1.5);
    }
    if (!force) {
        handleViewTransitions(viewName, previousView);
    }
}
export function handleViewTransitions(viewName, previousView) {
    console.log("je rentre dans handleViewTransitions");
    console.log(viewName, previousView);
    if (isLoading)
        return;
    if (!previousView)
        previousView = 'default';
    if (viewName === 'vue1' && previousView === 'default') {
        changeView('vue1', true);
        setTimeout(() => {
            window.currentView = 'vue1';
            createLoadingOverlay();
        }, 1200);
        setTimeout(() => {
            changeView('vue2', true);
        }, 3500);
        setTimeout(() => removeLoadingOverlay(), 5000);
    }
    if (viewName === 'vue3' && previousView === 'vue2') {
        createLoadingOverlay();
        setTimeout(() => {
            changeView('vue3', true);
            window.currentView = 'vue3';
        }, 1500);
        setTimeout(() => {
            removeLoadingOverlay();
            changeView('vue4', true);
        }, 5000);
    }
    if (viewName === 'vue2' && (previousView === 'vue4' || previousView === 'winner')) {
        isLoading = true;
        changeView('vue3', true);
        setTimeout(() => {
            createLoadingOverlay();
        }, 1500);
        setTimeout(() => {
            changeView('vue2', true);
            window.currentView = 'vue2';
        }, 2000);
        setTimeout(() => {
            removeLoadingOverlay();
            isLoading = false;
        }, 5000);
    }
    if (viewName === 'vue1' && previousView === 'vue2') {
        console.log('je suis la ');
        isLoading = true;
        createLoadingOverlay();
        setTimeout(() => {
            changeView('vue1', true);
        }, 1500);
        setTimeout(() => {
            removeLoadingOverlay();
            changeView('default', true);
            isLoading = false;
        }, 5000);
    }
    if (viewName === 'winner') {
        changeView('winner', true);
    }
    if (viewName === 'tournament') {
        changeView('tournament', true);
    }
    if (viewName === 'vue2' && previousView === 'tournament') {
        changeView('vue2', true);
    }
    if (viewName === 'tournament_game_start' && previousView === 'tournament') {
        createLoadingOverlay();
        setTimeout(() => {
            changeView('vue3', true);
            window.currentView = 'vue3';
        }, 1500);
        setTimeout(() => {
            removeLoadingOverlay();
            changeView('vue4', true);
        }, 5000);
    }
    if (viewName === 'tournament' && previousView === 'vue4') {
        isLoading = true;
        changeView('vue3', true);
        setTimeout(() => {
            createLoadingOverlay();
        }, 1500);
        setTimeout(() => {
            changeView('tournament', true);
            window.currentView = 'tournament';
        }, 3500);
        setTimeout(() => {
            removeLoadingOverlay();
            isLoading = false;
        }, 5000);
    }
    if (viewName === 'platformer' && previousView === 'vue2') {
        changeView('platformer', true);
    }
    if (viewName === 'vue2' && previousView === 'platformer') {
        changeView('vue2', true);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FtZXJhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHVibGljL3NyY3MvZ2FtZS9nYW1lcGxheS92aWV3cy9jYW1lcmEuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakYsT0FBTyxFQUFFLHdCQUF3QixFQUFFLHdCQUF3QixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDckYsT0FBTyxFQUFFLHdCQUF3QixFQUFFLHdCQUF3QixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDckcsT0FBTyxFQUFFLDhCQUE4QixFQUFFLDhCQUE4QixFQUFFLDhCQUE4QixFQUFFLDhCQUE4QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDekwsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDL0UsT0FBTyxFQUFFLHNCQUFzQixFQUFFLHdCQUF3QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDM0csT0FBTyxFQUFFLHFDQUFxQyxFQUFFLHFDQUFxQyxFQUFFLHFDQUFxQyxFQUFFLHFDQUFxQyxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDdE4sT0FBTyxFQUFFLGdCQUFnQixFQUFFLGNBQWMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUdwRixNQUFNLEtBQUssR0FBRztJQUNiLE9BQU8sRUFDUDtRQUNDLFFBQVEsRUFBRSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxpQkFBaUIsRUFBRSxDQUFDLGtCQUFrQixDQUFDO1FBQ3pGLFFBQVEsRUFBRSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQztLQUMzRTtJQUNELElBQUksRUFDSjtRQUNDLFFBQVEsRUFBRSxJQUFJLE9BQU8sQ0FBQyxP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QUFDLEdBQUcsRUFBRTtZQUNmLG9CQUFvQixFQUFFLENBQUM7WUFDdkIsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUNuQixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDVixDQUFDO0lBQ0QsSUFBSSxRQUFRLEtBQUssWUFBWSxJQUFJLFlBQVksS0FBSyxNQUFNLEVBQ3hELENBQUM7UUFDQSxVQUFVLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFDRCxJQUFJLFFBQVEsS0FBSyxNQUFNLElBQUksWUFBWSxLQUFLLFlBQVksRUFDeEQsQ0FBQztRQUNBLFVBQVUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDMUIsQ0FBQztBQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVMb2FkaW5nT3ZlcmxheSwgcmVtb3ZlTG9hZGluZ092ZXJsYXkgfSBmcm9tICcuL2xvYWRpbmdfc2NyZWVuLmpzJztcbmltcG9ydCB7IGNyZWF0ZV9lbnZpcm9ubWVudF92aWV3MSwgY3JlYXRlX2Vudmlyb25tZW50X3ZpZXcyIH0gZnJvbSAnLi4vaW5pdF9nYW1lLmpzJztcbmltcG9ydCB7IGluaXRfc2tpbnNfcGVyc29fcGxheWVyMSwgaW5pdF9za2luc19wZXJzb19wbGF5ZXIyIH0gZnJvbSAnLi4vc29sby9za2luL2luaXRfc2tpbl9wZXJzby5qcyc7XG5pbXBvcnQgeyBpbml0X3NraW5zX3BlcnNvX3BsYXllcjFfbXVsdGksIGluaXRfc2tpbnNfcGVyc29fcGxheWVyMl9tdWx0aSwgaW5pdF9za2luc19wZXJzb19wbGF5ZXIzX211bHRpLCBpbml0X3NraW5zX3BlcnNvX3BsYXllcjRfbXVsdGkgfSBmcm9tICcuLi9tdWx0aXBsYXllci9pbml0X3NraW5fcGVyc29fbXVsdGkuanMnO1xuaW1wb3J0IHsgZGVzdHJveV9hbGxfYnlfbWV0YWRhdGFfc2tpbiB9IGZyb20gJy4uL3NvbG8vc2tpbi9pbml0X3NraW5fcGVyc28uanMnO1xuaW1wb3J0IHsgaW5pdF9za2luc19wZXJzb19maXJzdCwgaW5pdF9za2luc19wZXJzb19zZWNvbmRlIH0gZnJvbSAnLi4vc29sby9za2luL2luaXRfc2tpbl9wbGF5ZXJfcG9kaXVtLmpzJztcbmltcG9ydCB7IGluaXRfc2tpbnNfcGVyc29fcGxheWVyMV9tdWx0aV9wb2RpdW0sIGluaXRfc2tpbnNfcGVyc29fcGxheWVyMl9tdWx0aV9wb2RpdW0sIGluaXRfc2tpbnNfcGVyc29fcGxheWVyM19tdWx0aV9wb2RpdW0sIGluaXRfc2tpbnNfcGVyc29fcGxheWVyNF9tdWx0aV9wb2RpdW0gfSBmcm9tICcuLi9tdWx0aXBsYXllci9pbml0X3RlYW1QbGF5ZXJfcG9kaXVtLmpzJztcbmltcG9ydCB7IGdldFNvbG9HYW1lU3RhcnQsIGdldEFJR2FtZVN0YXJ0LCBnZXRNdWx0aUdhbWVTdGFydCB9IGZyb20gJy4uL2JhYnlsb24uanMnO1xuXG5cbmNvbnN0IHZpZXdzID0ge1xuXHRkZWZhdWx0OlxuXHR7XG5cdFx0cG9zaXRpb246IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTQ1Ljc5MzAxOTUxMDY1OTgyLCA1Ljg3OTczNTM3MTA0NDc4OSwgLTMxLjM0MjIxMDk0NzA4MTMxMyksXG5cdFx0cm90YXRpb246IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTAuMDI5NjY1MjgwMDY5MDExNjY3LCAtMi41NjYzODcwODU3OTQ3MTIsIDApXG5cdH0sXG5cdHZ1ZTE6XG5cdHtcblx0XHRwb3NpdGlvbjogbmV3IEJBQllMT04uVmVjdG9yMygtMTIxLjEwMjgwODI0OTI0Nzg0LCAyNC42MjA3OTUyNzY3NTE0LCAtMTc0LjA3MjA5OTcxOTM4MjI0KSxcblx0XHRyb3RhdGlvbjogbmV3IEJBQllMT04uVmVjdG9yMygtMC4xMTg4MzAzNzgyMzc2MjkxNCwgLTIuNTk0Mzg3MzM4MTI3MTQxNiwgMClcblx0fSxcblx0dnVlMjpcblx0e1xuXHRcdHBvc2l0aW9uOiBuZXcgQkFCWUxPTi5WZWN0b3IzKC0xOC4zNjIwNzk4NzAzNTQxNTUsIDEwOC4yNTI1MTI2OTQyNzYxMiwgMjUuODYyODc2MzY0MTU1MTUyKSxcblx0XHRyb3RhdGlvbjogbmV3IEJBQllMT04uVmVjdG9yMygwLjAzMDcwOTIwMjkzNDYyMiwgLTMuMTI1MzQ3MTc1MjgxMjIzNCwgMClcblx0fSxcblx0dnVlMzpcblx0e1xuXHRcdHBvc2l0aW9uOiBuZXcgQkFCWUxPTi5WZWN0b3IzKC01NC43NTU2MTQyMTgzOTU4NSwgMzIzLjg5MzUyNTYyNjM2MTgsIC02OS40NjkyMzIyNjcxNzU3NCksXG5cdFx0cm90YXRpb246IG5ldyBCQUJZTE9OLlZlY3RvcjMoMC4wNDExMDIxODU1ODgyODQ0OCwgLTEuNTk0MDExMjUxNzA4OTgyOCwgMClcblx0fSxcblx0dnVlNDpcblx0e1xuXHRcdHBvc2l0aW9uOiBuZXcgQkFCWUxPTi5WZWN0b3IzKDg2LjE2MjEwNjQ2NTgyOTU4LCAzNDEuOTMzNjk0ODAzNDgsIC03Mi40ODY4NzI2NzE2NDc1NyksXG5cdFx0cm90YXRpb246IG5ldyBCQUJZTE9OLlZlY3RvcjMoMC4yNzkxMTMwMTI0MDUwOTkwNiwgLTEuNTcyNTExMjUxNzA4OTgzLCAwKVxuXHR9LFxuXHRhZXJpZW5uZTpcblx0e1xuXHRcdHBvc2l0aW9uOiBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDEwMCwgMCksXG5cdFx0cm90YXRpb246IG5ldyBCQUJZTE9OLlZlY3RvcjMoTWF0aC5QSS8yLCAwLCAwKVxuXHR9LFxuXHR3aW5uZXI6XG5cdHtcblx0XHRwb3NpdGlvbjogbmV3IEJBQllMT04uVmVjdG9yMygtMzAsIDMwOSwgLTU1KSxcblx0XHRyb3RhdGlvbjogbmV3IEJBQllMT04uVmVjdG9yMygwLjA0NTg1ODMxMzAzNjY3NTM0LCAtMS41Njk0NzI1NDc0NDc2ODk2LCAwKVxuXHR9LFxuXHR0b3VybmFtZW50OlxuXHR7XG5cdFx0cG9zaXRpb246IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTE4LjQyODQ3MDM4NTE4MjUzMiwgMTA3LjYyMTM4MTUyNjA0ODAxLCAtMTQuMTM5ODk2NzQ1MjU1NzI4KSxcblx0XHRyb3RhdGlvbjogbmV3IEJBQllMT04uVmVjdG9yMygtMC4wMzA3OTA3OTcwNjUzNzgwNCwgLTMuMTI0ODQ3MTc1MjgxMjIzMiwgMClcblx0fSxcblx0cGxhdGZvcm1lcjpcblx0e1xuXHRcdHBvc2l0aW9uOiBuZXcgQkFCWUxPTi5WZWN0b3IzKC02LjUxODIwOTQ2NzcwMzI4NjUsIDEwNS45OTQ5NDAwODE0MjkyLCAtMy4wMjk1MTY1OTQ5OTQwNjY2KSxcblx0XHRyb3RhdGlvbjogbmV3IEJBQllMT04uVmVjdG9yMygwLjMwMDMxMjA1NTAwMjUzNjU1LCAtNC43MjEzNTM4NzI5NDYzMDQsIDApXG5cdH1cbn07XG5cbmxldCBjdXJyZW50VHJhbnNpdGlvbkFuaW1hdGlvbiA9IG51bGw7XG5sZXQgaXNMb2FkaW5nID0gZmFsc2U7XG5sZXQgdGFyZ2V0VmlldyA9IG51bGw7XG4vLyBGb25jdGlvbiBkZSB0cmFuc2l0aW9uIGFtw6lsaW9yw6llIGF2ZWMgY291cmJlIGQnYW5pbWF0aW9uXG5leHBvcnQgZnVuY3Rpb24gc21vb3RoVHJhbnNpdGlvbih0YXJnZXRQb3NpdGlvbiwgdGFyZ2V0Um90YXRpb24sIGR1cmF0aW9uID0gMS41KVxue1xuXHQvLyBBbm51bGVyIGwnYW5pbWF0aW9uIHByw6ljw6lkZW50ZSBzaSBlbGxlIGV4aXN0ZVxuXHRpZiAoY3VycmVudFRyYW5zaXRpb25BbmltYXRpb24pIHtcblx0XHRzY2VuZS5vbkJlZm9yZVJlbmRlck9ic2VydmFibGUucmVtb3ZlKGN1cnJlbnRUcmFuc2l0aW9uQW5pbWF0aW9uKTtcblx0fVxuXG5cdGNvbnN0IHN0YXJ0UG9zaXRpb24gPSBjYW1lcmEucG9zaXRpb24uY2xvbmUoKTtcblx0Y29uc3Qgc3RhcnRSb3RhdGlvbiA9IGNhbWVyYS5yb3RhdGlvbi5jbG9uZSgpO1xuXHRjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuXHQvLyBDcsOpZXIgZGVzIHZlY3RldXJzIHRlbXBvcmFpcmVzIHBvdXIgw6l2aXRlciBsYSBjcsOpYXRpb24gZCdvYmpldHMgcGVuZGFudCBsJ2FuaW1hdGlvblxuXHRjb25zdCB0ZW1wUG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKCk7XG5cdGNvbnN0IHRlbXBSb3RhdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoKTtcblxuXHQvLyBGb25jdGlvbiBkJ2Vhc2UgKGxpc3NhZ2UpXG5cdGNvbnN0IGVhc2VJbk91dEN1YmljID0gdCA9PiB0IDwgMC41ID8gNCAqIHQgKiB0ICogdCA6IDEgLSBNYXRoLnBvdygtMiAqIHQgKyAyLCAzKSAvIDI7XG5cblx0Y3VycmVudFRyYW5zaXRpb25BbmltYXRpb24gPSBzY2VuZS5vbkJlZm9yZVJlbmRlck9ic2VydmFibGUuYWRkKCgpID0+IHtcblx0XHRjb25zdCBjdXJyZW50VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXHRcdGxldCB0ID0gKGN1cnJlbnRUaW1lIC0gc3RhcnRUaW1lKSAvIChkdXJhdGlvbiAqIDEwMDApO1xuXG5cdFx0aWYgKHQgPj0gMSkge1xuXHRcdFx0Y2FtZXJhLnBvc2l0aW9uLmNvcHlGcm9tKHRhcmdldFBvc2l0aW9uKTtcblx0XHRcdGNhbWVyYS5yb3RhdGlvbi5jb3B5RnJvbSh0YXJnZXRSb3RhdGlvbik7XG5cdFx0XHRzY2VuZS5vbkJlZm9yZVJlbmRlck9ic2VydmFibGUucmVtb3ZlKGN1cnJlbnRUcmFuc2l0aW9uQW5pbWF0aW9uKTtcblx0XHRcdGN1cnJlbnRUcmFuc2l0aW9uQW5pbWF0aW9uID0gbnVsbDtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyBBcHBsaXF1ZXIgbGEgZm9uY3Rpb24gZCdlYXNlXG5cdFx0Y29uc3QgZWFzZWRUID0gZWFzZUluT3V0Q3ViaWModCk7XG5cblx0XHQvLyBJbnRlcnBvbGF0aW9uIGRlIGxhIHBvc2l0aW9uXG5cdFx0QkFCWUxPTi5WZWN0b3IzLkxlcnBUb1JlZihzdGFydFBvc2l0aW9uLCB0YXJnZXRQb3NpdGlvbiwgZWFzZWRULCB0ZW1wUG9zaXRpb24pO1xuXHRcdGNhbWVyYS5wb3NpdGlvbi5jb3B5RnJvbSh0ZW1wUG9zaXRpb24pO1xuXG5cdFx0Ly8gSW50ZXJwb2xhdGlvbiBkZSBsYSByb3RhdGlvblxuXHRcdEJBQllMT04uVmVjdG9yMy5MZXJwVG9SZWYoc3RhcnRSb3RhdGlvbiwgdGFyZ2V0Um90YXRpb24sIGVhc2VkVCwgdGVtcFJvdGF0aW9uKTtcblx0XHRjYW1lcmEucm90YXRpb24uY29weUZyb20odGVtcFJvdGF0aW9uKTtcblx0fSk7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNoYW5nZVZpZXcodmlld05hbWUsIGZvcmNlID0gZmFsc2UpIHtcblx0Y29uc3QgdmlldyA9IHZpZXdzW3ZpZXdOYW1lXTtcblx0aWYgKCF2aWV3IHx8ICh3aW5kb3cuY3VycmVudFZpZXcgPT09IHZpZXdOYW1lICYmICFmb3JjZSkpIHJldHVybjtcblx0XG5cdGNvbnN0IHByZXZpb3VzVmlldyA9IHdpbmRvdy5jdXJyZW50Vmlldztcblx0aWYgKCFpc0xvYWRpbmcgfHwgZm9yY2UpIHtcblx0XHR3aW5kb3cuY3VycmVudFZpZXcgPSB2aWV3TmFtZTtcblx0XHR0YXJnZXRWaWV3ID0gdmlld05hbWU7XG5cdFx0c21vb3RoVHJhbnNpdGlvbih2aWV3LnBvc2l0aW9uLCB2aWV3LnJvdGF0aW9uLCAxLjUpO1xuXHR9XG5cdFxuXHRpZiAoIWZvcmNlKSB7XG5cdFx0aGFuZGxlVmlld1RyYW5zaXRpb25zKHZpZXdOYW1lLCBwcmV2aW91c1ZpZXcpO1xuXHR9XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVZpZXdUcmFuc2l0aW9ucyh2aWV3TmFtZSwgcHJldmlvdXNWaWV3KVxue1xuXHRjb25zb2xlLmxvZyhcImplIHJlbnRyZSBkYW5zIGhhbmRsZVZpZXdUcmFuc2l0aW9uc1wiKTtcblx0Y29uc29sZS5sb2codmlld05hbWUsIHByZXZpb3VzVmlldyk7XG5cdGlmIChpc0xvYWRpbmcpXG5cdHJldHVybjtcbmlmICghcHJldmlvdXNWaWV3KVxucHJldmlvdXNWaWV3ID0gJ2RlZmF1bHQnO1xuXG5pZiAodmlld05hbWUgPT09ICd2dWUxJyAmJiBwcmV2aW91c1ZpZXcgPT09ICdkZWZhdWx0Jylcbntcblx0Y2hhbmdlVmlldygndnVlMScsIHRydWUpO1xuXHRzZXRUaW1lb3V0KCgpID0+XG5cdHtcblx0XHR3aW5kb3cuY3VycmVudFZpZXcgPSAndnVlMSc7XG5cdFx0Y3JlYXRlTG9hZGluZ092ZXJsYXkoKTtcblx0fSwgMTIwMCk7XG5cdHNldFRpbWVvdXQoKCkgPT5cblx0e1xuXHRcdFx0Y2hhbmdlVmlldygndnVlMicsIHRydWUpO1xuXHRcdH0sIDM1MDApO1xuXHRcdHNldFRpbWVvdXQoKCkgPT4gcmVtb3ZlTG9hZGluZ092ZXJsYXkoKSwgNTAwMCk7XG5cdH1cblx0aWYgKHZpZXdOYW1lID09PSAndnVlMycgJiYgcHJldmlvdXNWaWV3ID09PSAndnVlMicpXG5cdHtcblx0XHRjcmVhdGVMb2FkaW5nT3ZlcmxheSgpO1xuXHRcdHNldFRpbWVvdXQoKCkgPT5cblx0XHR7XG5cdFx0XHRjaGFuZ2VWaWV3KCd2dWUzJywgdHJ1ZSk7XG5cdFx0XHR3aW5kb3cuY3VycmVudFZpZXcgPSAndnVlMyc7XG5cdFx0fSwgMTUwMCk7XG5cdFx0c2V0VGltZW91dCgoKSA9PiBcblx0XHR7XG5cdFx0XHRyZW1vdmVMb2FkaW5nT3ZlcmxheSgpO1xuXHRcdFx0Y2hhbmdlVmlldygndnVlNCcsIHRydWUpO1xuXHRcdH0sIDUwMDApO1xuXHR9XG5cdGlmICh2aWV3TmFtZSA9PT0gJ3Z1ZTInICYmIChwcmV2aW91c1ZpZXcgPT09ICd2dWU0JyB8fCBwcmV2aW91c1ZpZXcgPT09ICd3aW5uZXInKSkge1xuXHRcdGlzTG9hZGluZyA9IHRydWU7XG5cdFx0Y2hhbmdlVmlldygndnVlMycsIHRydWUpO1xuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0Y3JlYXRlTG9hZGluZ092ZXJsYXkoKTtcblx0XHR9LCAxNTAwKTtcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdGNoYW5nZVZpZXcoJ3Z1ZTInLCB0cnVlKTtcblx0XHRcdHdpbmRvdy5jdXJyZW50VmlldyA9ICd2dWUyJzsgXG5cblx0XHR9LCAyMDAwKTtcblx0XHRcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdHJlbW92ZUxvYWRpbmdPdmVybGF5KCk7XG5cdFx0XHRpc0xvYWRpbmcgPSBmYWxzZTtcblx0XHR9LCA1MDAwKTtcblx0fVxuXHRpZiAodmlld05hbWUgPT09ICd2dWUxJyAmJiBwcmV2aW91c1ZpZXcgPT09ICd2dWUyJylcblx0e1xuXHRcdGNvbnNvbGUubG9nKCdqZSBzdWlzIGxhICcpO1xuXHRcdGlzTG9hZGluZyA9IHRydWU7XG5cdFx0Y3JlYXRlTG9hZGluZ092ZXJsYXkoKTtcblx0XHRcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdGNoYW5nZVZpZXcoJ3Z1ZTEnLCB0cnVlKTtcblx0XHR9LCAxNTAwKTtcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdHJlbW92ZUxvYWRpbmdPdmVybGF5KCk7XG5cdFx0XHRjaGFuZ2VWaWV3KCdkZWZhdWx0JywgdHJ1ZSk7XG5cdFx0XHRpc0xvYWRpbmcgPSBmYWxzZTtcblx0XHR9LCA1MDAwKTtcblx0fVxuXHRpZiAodmlld05hbWUgPT09ICd3aW5uZXInKVxuXHR7XG5cdFx0Y2hhbmdlVmlldygnd2lubmVyJywgdHJ1ZSk7XG5cdH1cblx0aWYgKHZpZXdOYW1lID09PSAndG91cm5hbWVudCcpXG5cdHtcblx0XHRjaGFuZ2VWaWV3KCd0b3VybmFtZW50JywgdHJ1ZSk7XG5cdH1cblx0aWYgKHZpZXdOYW1lID09PSAndnVlMicgJiYgcHJldmlvdXNWaWV3ID09PSAndG91cm5hbWVudCcpXG5cdHtcblx0XHRjaGFuZ2VWaWV3KCd2dWUyJywgdHJ1ZSk7XG5cdH1cblx0aWYgKHZpZXdOYW1lID09PSAndG91cm5hbWVudF9nYW1lX3N0YXJ0JyAmJiBwcmV2aW91c1ZpZXcgPT09ICd0b3VybmFtZW50Jylcblx0e1xuXHRcdGNyZWF0ZUxvYWRpbmdPdmVybGF5KCk7XG5cdFx0c2V0VGltZW91dCgoKSA9PlxuXHRcdHtcblx0XHRcdGNoYW5nZVZpZXcoJ3Z1ZTMnLCB0cnVlKTtcblx0XHRcdHdpbmRvdy5jdXJyZW50VmlldyA9ICd2dWUzJztcblx0XHR9LCAxNTAwKTtcblx0XHRzZXRUaW1lb3V0KCgpID0+IFxuXHRcdHtcblx0XHRcdHJlbW92ZUxvYWRpbmdPdmVybGF5KCk7XG5cdFx0XHRjaGFuZ2VWaWV3KCd2dWU0JywgdHJ1ZSk7XG5cdFx0fSwgNTAwMCk7XG5cdH1cblx0aWYgKHZpZXdOYW1lID09PSAndG91cm5hbWVudCcgJiYgcHJldmlvdXNWaWV3ID09PSAndnVlNCcpXG5cdHtcblx0XHRpc0xvYWRpbmcgPSB0cnVlO1xuXHRcdGNoYW5nZVZpZXcoJ3Z1ZTMnLCB0cnVlKTtcblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdGNyZWF0ZUxvYWRpbmdPdmVybGF5KCk7XG5cdFx0fSwgMTUwMCk7XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRjaGFuZ2VWaWV3KCd0b3VybmFtZW50JywgdHJ1ZSk7XG5cdFx0XHR3aW5kb3cuY3VycmVudFZpZXcgPSAndG91cm5hbWVudCc7IFxuXG5cdFx0fSwgMzUwMCk7XG5cdFx0XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRyZW1vdmVMb2FkaW5nT3ZlcmxheSgpO1xuXHRcdFx0aXNMb2FkaW5nID0gZmFsc2U7XG5cdFx0fSwgNTAwMCk7XG5cdH1cblx0aWYgKHZpZXdOYW1lID09PSAncGxhdGZvcm1lcicgJiYgcHJldmlvdXNWaWV3ID09PSAndnVlMicpXG5cdHtcblx0XHRjaGFuZ2VWaWV3KCdwbGF0Zm9ybWVyJywgdHJ1ZSk7XG5cdH1cblx0aWYgKHZpZXdOYW1lID09PSAndnVlMicgJiYgcHJldmlvdXNWaWV3ID09PSAncGxhdGZvcm1lcicpXG5cdHtcblx0XHRjaGFuZ2VWaWV3KCd2dWUyJywgdHJ1ZSk7XG5cdH1cbn0iXX0=