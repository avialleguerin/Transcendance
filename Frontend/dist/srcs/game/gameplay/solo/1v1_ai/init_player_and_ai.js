import { simple_ai_move } from "./ai_move.js";
let minX = 0;
let maxX = 0;
function init_border() {
    const borderTop = new BABYLON.MeshBuilder.CreateBox("border", {
        width: 115,
        height: 3,
        depth: 1
    }, scene);
    borderTop.position = new BABYLON.Vector3(25, 300, -72);
    borderTop.rotation = new BABYLON.Vector3(0, Math.PI / 2, 0);
    borderTop.visibility = 0;
    const borderBottom = new BABYLON.MeshBuilder.CreateBox("border", {
        width: 115,
        height: 3,
        depth: 1
    }, scene);
    borderBottom.position = new BABYLON.Vector3(-40, 300, -72);
    borderBottom.rotation = new BABYLON.Vector3(0, Math.PI / 2, 0);
    borderBottom.visibility = 0;
    minX = borderBottom.position.x + (borderBottom.scaling.x / 2) + 4.5;
    maxX = borderTop.position.x - (borderTop.scaling.x / 2) - 4.5;
}
export function init_players_and_ai(scene, player_1, ai_player) {
    init_border();
    player_1 = new BABYLON.MeshBuilder.CreateBox("player_1", {
        width: 10,
        height: 1.5,
        depth: 1.5
    }, scene);
    player_1.position = new BABYLON.Vector3(-7, 301, -120);
    player_1.checkPaddleCollision = true;
    player_1.metadata = { isPlayer_paddle: true }; // Tag ajouté pour identifier ce mesh comme joueur
    player_1.visibility = 0;
    ai_player = new BABYLON.MeshBuilder.CreateBox("ai_player", {
        width: 10,
        height: 1.5,
        depth: 1.5
    }, scene);
    ai_player.position = new BABYLON.Vector3(-7, 301, -24);
    ai_player.checkPaddleCollision = true;
    ai_player.metadata = { isPlayer_paddle: true }; // Tag ajouté pour identifier ce mesh comme joueur
    ai_player.visibility = 0;
    BABYLON.SceneLoader.ImportMesh("", "/srcs/game/assets/player/", "PlayerIdleAnnimation.glb", scene, function (newMeshes) {
        const rootMesh = newMeshes.find(mesh => mesh.name === "__root__");
        if (rootMesh) {
            rootMesh.position = player_1.position.clone();
            rootMesh.scaling = new BABYLON.Vector3(6, 6, 6);
            rootMesh.rotationQuaternion = BABYLON.Quaternion.FromEulerAngles(0, Math.PI, 0);
            rootMesh.metadata = { isPlayer: true }; // Tag ajouté pour identifier ce mesh comme joueur
        }
        newMeshes.forEach(mesh => {
            if (mesh instanceof BABYLON.Mesh) {
                mesh.rotationQuaternion = null;
                mesh.rotation = new BABYLON.Vector3(Math.PI, 0, 0);
                mesh.metadata = { isPlayer: true }; // Tag ajouté pour identifier ce mesh comme joueur
            }
        });
        const playerRepere = new BABYLON.MeshBuilder.CreateBox("playerRepere", {
            width: 10,
            height: 0.1,
            depth: 1,
        }, scene);
        playerRepere.position = new BABYLON.Vector3(-7, 301, -120);
        playerRepere.material = new BABYLON.StandardMaterial("playerRepereMat", scene);
        playerRepere.material.emissiveColor = new BABYLON.Color3.Red();
        playerRepere.metadata = { isPlayerRepere: true }; // Tag ajouté pour le repère du joueur
        scene.registerBeforeRender(() => {
            rootMesh.position.x = player_1.position.x;
            rootMesh.position.y = player_1.position.y;
            rootMesh.position.z = player_1.position.z;
            playerRepere.position.x = player_1.position.x;
            playerRepere.position.y = player_1.position.y;
        });
    });
    BABYLON.SceneLoader.ImportMesh("", "/srcs/game/assets/player/", "PlayerIdleAnnimation.glb", scene, function (newMeshes) {
        const playerModel = newMeshes[0];
        playerModel.position = ai_player.position.clone();
        playerModel.scaling = new BABYLON.Vector3(6, 6, 6);
        playerModel.rotation = new BABYLON.Vector3(0, Math.PI, 0);
        playerModel.metadata = { isPlayer: true }; // Tag ajouté pour le joueur 2
        const playerRepere = new BABYLON.MeshBuilder.CreateBox("playerRepere", {
            width: 10,
            height: 0.1,
            depth: 1,
        }, scene);
        playerRepere.position = new BABYLON.Vector3(-7, 301, -24.5);
        playerRepere.material = new BABYLON.StandardMaterial("playerRepereMat", scene);
        playerRepere.material.emissiveColor = new BABYLON.Color3.Red();
        playerRepere.metadata = { isPlayerRepere: true }; // Tag ajouté pour le repère du joueur 2
        // Synchronisation continue de la position
        scene.registerBeforeRender(() => {
            playerModel.position.x = ai_player.position.x;
            playerModel.position.y = ai_player.position.y;
            playerModel.position.z = ai_player.position.z;
            playerRepere.position.x = ai_player.position.x;
            playerRepere.position.y = ai_player.position.y;
        });
    });
    console.log("player 1 " + player_1.position);
    console.log("player 2 " + ai_player.position);
    return { player_1, ai_player };
}
// Fonction pour récupérer les références des joueurs
export function getPlayerRef() {
    console.log("player 1 bis " + player_1.position);
    console.log("player 2 bis " + ai_player.position);
    return { player_1, ai_player };
}
const paddleSpeed = 1.1;
const keys = {};
// const init_players_instance = init_players(scene);
addEventListener("keydown", (event) => keys[event.key] = true);
addEventListener("keyup", (event) => keys[event.key] = false);
export function UpdatePlayerAndAI_Pose(player_1, ai_player, ball) {
    if (keys["w"] && player_1.position.x > minX) {
        player_1.position.x -= paddleSpeed;
    }
    if (keys["s"] && player_1.position.x < maxX) {
        player_1.position.x += paddleSpeed;
    }
    // if (keys["i"] && ai_player.position.x > minX) {
    // 	ai_player.position.x -= paddleSpeed;
    // }
    // if (keys["k"] && ai_player.position.x < maxX) {
    // 	ai_player.position.x += paddleSpeed;
    // }
    simple_ai_move(ai_player, ball, minX, maxX);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdF9wbGF5ZXJfYW5kX2FpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHVibGljL3NyY3MvZ2FtZS9nYW1lcGxheS9zb2xvLzF2MV9haS9pbml0X3BsYXllcl9hbmRfYWkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUc5QyxJQUFJLElBQUksR0FBRyxDQUFDLENBQUM7QUFDYixJQUFJLElBQUksR0FBRyxDQUFDLENBQUM7QUFFYixTQUFTLFdBQVc7SUFDbkIsTUFBTSxTQUFTLEdBQUcsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUU7UUFDN0QsS0FBSyxFQUFFLEdBQUc7UUFDVixNQUFNLEVBQUUsQ0FBQztRQUNULEtBQUssRUFBRSxDQUFDO0tBQ1IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNWLFNBQVMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN2RCxTQUFTLENBQUMsUUFBUSxHQUFHLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUQsU0FBUyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFFekIsTUFBTSxZQUFZLEdBQUcsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUU7UUFDaEUsS0FBSyxFQUFFLEdBQUc7UUFDVixNQUFNLEVBQUUsQ0FBQztRQUNULEtBQUssRUFBRSxDQUFDO0tBQ1IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNWLFlBQVksQ0FBQyxRQUFRLEdBQUcsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFB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RSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDN0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNpbXBsZV9haV9tb3ZlIH0gZnJvbSBcIi4vYWlfbW92ZS5qc1wiO1xuXG5cbmxldCBtaW5YID0gMDtcbmxldCBtYXhYID0gMDtcblxuZnVuY3Rpb24gaW5pdF9ib3JkZXIoKSB7XG5cdGNvbnN0IGJvcmRlclRvcCA9IG5ldyBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUJveChcImJvcmRlclwiLCB7XG5cdFx0d2lkdGg6IDExNSxcblx0XHRoZWlnaHQ6IDMsXG5cdFx0ZGVwdGg6IDFcblx0fSwgc2NlbmUpO1xuXHRib3JkZXJUb3AucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDI1LCAzMDAsIC03Mik7XG5cdGJvcmRlclRvcC5yb3RhdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgTWF0aC5QSSAvIDIsIDApO1xuXHRib3JkZXJUb3AudmlzaWJpbGl0eSA9IDA7XG5cdFxuXHRjb25zdCBib3JkZXJCb3R0b20gPSBuZXcgQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goXCJib3JkZXJcIiwge1xuXHRcdHdpZHRoOiAxMTUsXG5cdFx0aGVpZ2h0OiAzLFxuXHRcdGRlcHRoOiAxXG5cdH0sIHNjZW5lKTtcblx0Ym9yZGVyQm90dG9tLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygtNDAsIDMwMCwgLTcyKTtcblx0Ym9yZGVyQm90dG9tLnJvdGF0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygwLCBNYXRoLlBJIC8gMiwgMCk7XG5cdGJvcmRlckJvdHRvbS52aXNpYmlsaXR5ID0gMDtcblxuXHRtaW5YID0gYm9yZGVyQm90dG9tLnBvc2l0aW9uLnggKyAoYm9yZGVyQm90dG9tLnNjYWxpbmcueCAvIDIpICsgNC41O1xuXHRtYXhYID0gYm9yZGVyVG9wLnBvc2l0aW9uLnggLSAoYm9yZGVyVG9wLnNjYWxpbmcueCAvIDIpIC0gNC41O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdF9wbGF5ZXJzX2FuZF9haShzY2VuZSwgcGxheWVyXzEsIGFpX3BsYXllcikge1xuXG5cdGluaXRfYm9yZGVyKCk7XG5cblx0cGxheWVyXzEgPSBuZXcgQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goXCJwbGF5ZXJfMVwiLCB7XG5cdFx0d2lkdGg6IDEwLFxuXHRcdGhlaWdodDogMS41LFxuXHRcdGRlcHRoOiAxLjVcblx0fSwgc2NlbmUpO1xuXHRwbGF5ZXJfMS5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTcsIDMwMSwgLTEyMCk7XG5cdHBsYXllcl8xLmNoZWNrUGFkZGxlQ29sbGlzaW9uID0gdHJ1ZTtcblx0cGxheWVyXzEubWV0YWRhdGEgPSB7IGlzUGxheWVyX3BhZGRsZTogdHJ1ZSB9OyAgLy8gVGFnIGFqb3V0w6kgcG91ciBpZGVudGlmaWVyIGNlIG1lc2ggY29tbWUgam91ZXVyXG5cdHBsYXllcl8xLnZpc2liaWxpdHkgPSAwO1xuXHRcblx0YWlfcGxheWVyID0gbmV3IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlQm94KFwiYWlfcGxheWVyXCIsIHtcblx0XHR3aWR0aDogMTAsXG5cdFx0aGVpZ2h0OiAxLjUsXG5cdFx0ZGVwdGg6IDEuNVxuXHR9LCBzY2VuZSk7XG5cdGFpX3BsYXllci5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTcsIDMwMSwgLTI0KTtcblx0YWlfcGxheWVyLmNoZWNrUGFkZGxlQ29sbGlzaW9uID0gdHJ1ZTtcblx0YWlfcGxheWVyLm1ldGFkYXRhID0geyBpc1BsYXllcl9wYWRkbGU6IHRydWUgfTsgIC8vIFRhZyBham91dMOpIHBvdXIgaWRlbnRpZmllciBjZSBtZXNoIGNvbW1lIGpvdWV1clxuXHRhaV9wbGF5ZXIudmlzaWJpbGl0eSA9IDA7XG5cblxuXHRCQUJZTE9OLlNjZW5lTG9hZGVyLkltcG9ydE1lc2goXCJcIiwgXCIvc3Jjcy9nYW1lL2Fzc2V0cy9wbGF5ZXIvXCIsIFwiUGxheWVySWRsZUFubmltYXRpb24uZ2xiXCIsIHNjZW5lLCBmdW5jdGlvbiAobmV3TWVzaGVzKSB7XG5cdFx0Y29uc3Qgcm9vdE1lc2ggPSBuZXdNZXNoZXMuZmluZChtZXNoID0+IG1lc2gubmFtZSA9PT0gXCJfX3Jvb3RfX1wiKTtcblx0XHRpZiAocm9vdE1lc2gpIHtcblx0XHRcdHJvb3RNZXNoLnBvc2l0aW9uID0gcGxheWVyXzEucG9zaXRpb24uY2xvbmUoKTtcblx0XHRcdHJvb3RNZXNoLnNjYWxpbmcgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDYsIDYsIDYpO1xuXHRcdFx0cm9vdE1lc2gucm90YXRpb25RdWF0ZXJuaW9uID0gQkFCWUxPTi5RdWF0ZXJuaW9uLkZyb21FdWxlckFuZ2xlcygwLCBNYXRoLlBJLCAwKTtcblx0XHRcdHJvb3RNZXNoLm1ldGFkYXRhID0geyBpc1BsYXllcjogdHJ1ZSB9OyAgLy8gVGFnIGFqb3V0w6kgcG91ciBpZGVudGlmaWVyIGNlIG1lc2ggY29tbWUgam91ZXVyXG5cdFx0fVxuXHRcblx0XHRuZXdNZXNoZXMuZm9yRWFjaChtZXNoID0+IHtcblx0XHRcdGlmIChtZXNoIGluc3RhbmNlb2YgQkFCWUxPTi5NZXNoKSB7XG5cdFx0XHRcdG1lc2gucm90YXRpb25RdWF0ZXJuaW9uID0gbnVsbDtcblx0XHRcdFx0bWVzaC5yb3RhdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoTWF0aC5QSSwgMCwgMCk7XG5cdFx0XHRcdG1lc2gubWV0YWRhdGEgPSB7IGlzUGxheWVyOiB0cnVlIH07ICAvLyBUYWcgYWpvdXTDqSBwb3VyIGlkZW50aWZpZXIgY2UgbWVzaCBjb21tZSBqb3VldXJcblx0XHRcdH1cblx0XHR9KTtcblx0XG5cdFx0Y29uc3QgcGxheWVyUmVwZXJlID0gbmV3IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlQm94KFwicGxheWVyUmVwZXJlXCIsIHtcblx0XHRcdHdpZHRoOiAxMCxcblx0XHRcdGhlaWdodDogMC4xLFxuXHRcdFx0ZGVwdGg6IDEsXG5cdFx0fSwgc2NlbmUpO1xuXHRcdHBsYXllclJlcGVyZS5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTcsIDMwMSwgLTEyMCk7XG5cdFx0cGxheWVyUmVwZXJlLm1hdGVyaWFsID0gbmV3IEJBQllMT04uU3RhbmRhcmRNYXRlcmlhbChcInBsYXllclJlcGVyZU1hdFwiLCBzY2VuZSk7XG5cdFx0cGxheWVyUmVwZXJlLm1hdGVyaWFsLmVtaXNzaXZlQ29sb3IgPSBuZXcgQkFCWUxPTi5Db2xvcjMuUmVkKCk7XG5cdFx0cGxheWVyUmVwZXJlLm1ldGFkYXRhID0geyBpc1BsYXllclJlcGVyZTogdHJ1ZSB9OyAgLy8gVGFnIGFqb3V0w6kgcG91ciBsZSByZXDDqHJlIGR1IGpvdWV1clxuXHRcblx0XHRzY2VuZS5yZWdpc3RlckJlZm9yZVJlbmRlcigoKSA9PiB7XG5cdFx0XHRyb290TWVzaC5wb3NpdGlvbi54ID0gcGxheWVyXzEucG9zaXRpb24ueDtcblx0XHRcdHJvb3RNZXNoLnBvc2l0aW9uLnkgPSBwbGF5ZXJfMS5wb3NpdGlvbi55O1xuXHRcdFx0cm9vdE1lc2gucG9zaXRpb24ueiA9IHBsYXllcl8xLnBvc2l0aW9uLno7XG5cdFx0XHRwbGF5ZXJSZXBlcmUucG9zaXRpb24ueCA9IHBsYXllcl8xLnBvc2l0aW9uLng7XG5cdFx0XHRwbGF5ZXJSZXBlcmUucG9zaXRpb24ueSA9IHBsYXllcl8xLnBvc2l0aW9uLnk7XG5cdFx0fSk7XG5cdH0pO1xuXHRcblx0QkFCWUxPTi5TY2VuZUxvYWRlci5JbXBvcnRNZXNoKFwiXCIsIFwiL3NyY3MvZ2FtZS9hc3NldHMvcGxheWVyL1wiLCBcIlBsYXllcklkbGVBbm5pbWF0aW9uLmdsYlwiLCBzY2VuZSwgZnVuY3Rpb24gKG5ld01lc2hlcykge1xuXHRcdGNvbnN0IHBsYXllck1vZGVsID0gbmV3TWVzaGVzWzBdO1xuXHRcdHBsYXllck1vZGVsLnBvc2l0aW9uID0gYWlfcGxheWVyLnBvc2l0aW9uLmNsb25lKCk7XG5cdFx0cGxheWVyTW9kZWwuc2NhbGluZyA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoNiwgNiwgNik7XG5cdFx0cGxheWVyTW9kZWwucm90YXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIE1hdGguUEksIDApO1xuXHRcdHBsYXllck1vZGVsLm1ldGFkYXRhID0geyBpc1BsYXllcjogdHJ1ZSB9OyAgLy8gVGFnIGFqb3V0w6kgcG91ciBsZSBqb3VldXIgMlxuXHRcblx0XHRjb25zdCBwbGF5ZXJSZXBlcmUgPSBuZXcgQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goXCJwbGF5ZXJSZXBlcmVcIiwge1xuXHRcdFx0d2lkdGg6IDEwLFxuXHRcdFx0aGVpZ2h0OiAwLjEsXG5cdFx0XHRkZXB0aDogMSxcblx0XHR9LCBzY2VuZSk7XG5cdFx0cGxheWVyUmVwZXJlLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygtNywgMzAxLCAtMjQuNSk7XG5cdFx0cGxheWVyUmVwZXJlLm1hdGVyaWFsID0gbmV3IEJBQllMT04uU3RhbmRhcmRNYXRlcmlhbChcInBsYXllclJlcGVyZU1hdFwiLCBzY2VuZSk7XG5cdFx0cGxheWVyUmVwZXJlLm1hdGVyaWFsLmVtaXNzaXZlQ29sb3IgPSBuZXcgQkFCWUxPTi5Db2xvcjMuUmVkKCk7XG5cdFx0cGxheWVyUmVwZXJlLm1ldGFkYXRhID0geyBpc1BsYXllclJlcGVyZTogdHJ1ZSB9OyAgLy8gVGFnIGFqb3V0w6kgcG91ciBsZSByZXDDqHJlIGR1IGpvdWV1ciAyXG5cdFxuXHRcdC8vIFN5bmNocm9uaXNhdGlvbiBjb250aW51ZSBkZSBsYSBwb3NpdGlvblxuXHRcdHNjZW5lLnJlZ2lzdGVyQmVmb3JlUmVuZGVyKCgpID0+IHtcblx0XHRcdHBsYXllck1vZGVsLnBvc2l0aW9uLnggPSBhaV9wbGF5ZXIucG9zaXRpb24ueDtcblx0XHRcdHBsYXllck1vZGVsLnBvc2l0aW9uLnkgPSBhaV9wbGF5ZXIucG9zaXRpb24ueTtcblx0XHRcdHBsYXllck1vZGVsLnBvc2l0aW9uLnogPSBhaV9wbGF5ZXIucG9zaXRpb24uejtcblx0XHRcdHBsYXllclJlcGVyZS5wb3NpdGlvbi54ID0gYWlfcGxheWVyLnBvc2l0aW9uLng7XG5cdFx0XHRwbGF5ZXJSZXBlcmUucG9zaXRpb24ueSA9IGFpX3BsYXllci5wb3NpdGlvbi55O1xuXHRcdH0pO1xuXHR9KTtcblx0XG5cdFxuXG5cdFxuXHRjb25zb2xlLmxvZyhcInBsYXllciAxIFwiICsgcGxheWVyXzEucG9zaXRpb24pO1xuXHRjb25zb2xlLmxvZyhcInBsYXllciAyIFwiICsgYWlfcGxheWVyLnBvc2l0aW9uKTtcblxuXHRyZXR1cm4geyBwbGF5ZXJfMSwgYWlfcGxheWVyIH07XG59XG5cbi8vIEZvbmN0aW9uIHBvdXIgcsOpY3Vww6lyZXIgbGVzIHLDqWbDqXJlbmNlcyBkZXMgam91ZXVyc1xuZXhwb3J0IGZ1bmN0aW9uIGdldFBsYXllclJlZigpIHtcblx0Y29uc29sZS5sb2coXCJwbGF5ZXIgMSBiaXMgXCIgKyBwbGF5ZXJfMS5wb3NpdGlvbik7XG5cdGNvbnNvbGUubG9nKFwicGxheWVyIDIgYmlzIFwiICsgYWlfcGxheWVyLnBvc2l0aW9uKTtcblx0cmV0dXJuIHsgcGxheWVyXzEsIGFpX3BsYXllciB9O1xufVxuXG5cblxuY29uc3QgcGFkZGxlU3BlZWQgPSAxLjE7XG5jb25zdCBrZXlzID0ge307IFxuLy8gY29uc3QgaW5pdF9wbGF5ZXJzX2luc3RhbmNlID0gaW5pdF9wbGF5ZXJzKHNjZW5lKTtcblxuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiBrZXlzW2V2ZW50LmtleV0gPSB0cnVlKTtcbmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZXZlbnQpID0+IGtleXNbZXZlbnQua2V5XSA9IGZhbHNlKTtcblxuXG5leHBvcnQgZnVuY3Rpb24gVXBkYXRlUGxheWVyQW5kQUlfUG9zZShwbGF5ZXJfMSwgYWlfcGxheWVyLCBiYWxsKSB7XG5cdGlmIChrZXlzW1wid1wiXSAmJiBwbGF5ZXJfMS5wb3NpdGlvbi54ID4gbWluWCkge1xuXHRcdHBsYXllcl8xLnBvc2l0aW9uLnggLT0gcGFkZGxlU3BlZWQ7XG5cdH1cblx0aWYgKGtleXNbXCJzXCJdICYmIHBsYXllcl8xLnBvc2l0aW9uLnggPCBtYXhYKSB7XG5cdFx0cGxheWVyXzEucG9zaXRpb24ueCArPSBwYWRkbGVTcGVlZDtcblx0fVxuXHQvLyBpZiAoa2V5c1tcImlcIl0gJiYgYWlfcGxheWVyLnBvc2l0aW9uLnggPiBtaW5YKSB7XG5cdC8vIFx0YWlfcGxheWVyLnBvc2l0aW9uLnggLT0gcGFkZGxlU3BlZWQ7XG5cdC8vIH1cblx0Ly8gaWYgKGtleXNbXCJrXCJdICYmIGFpX3BsYXllci5wb3NpdGlvbi54IDwgbWF4WCkge1xuXHQvLyBcdGFpX3BsYXllci5wb3NpdGlvbi54ICs9IHBhZGRsZVNwZWVkO1xuXHQvLyB9XG5cdHNpbXBsZV9haV9tb3ZlKGFpX3BsYXllciwgYmFsbCwgbWluWCwgbWF4WCk7XG59XG4iXX0=