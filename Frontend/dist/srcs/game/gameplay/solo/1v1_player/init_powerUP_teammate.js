let canUsePowerUP_player1 = true;
let canUsePowerUP_player2 = true;
let nb_powerUP_player_1 = 0;
let nb_powerUP_player_2 = 0;
export function init_nb_powerUP_teammate(number) {
    nb_powerUP_player_1 = number;
    nb_powerUP_player_2 = number;
}
export function reset_powerUP_teammate() {
    nb_powerUP_player_1 = 0;
    nb_powerUP_player_2 = 0;
}
export function init_Teammate_player_1(scene) {
    if (nb_powerUP_player_1 > 0 && canUsePowerUP_player1) {
        nb_powerUP_player_1--;
        canUsePowerUP_player1 = false;
        const player_bonus1 = BABYLON.MeshBuilder.CreateBox("player_bonus1", {
            width: 10,
            height: 1.5,
            depth: 1.5
        }, scene);
        player_bonus1.position = new BABYLON.Vector3(-7, 301, -118);
        player_bonus1.visibility = 0;
        player_bonus1.metadata = { isPlayer_bonus1: true };
        if (player_bonus1) {
            console.log("je rentre la");
            console.log(player_bonus1.position);
        }
        BABYLON.SceneLoader.ImportMesh("", "/srcs/game/assets/player/", "PlayerIdleAnnimation.glb", scene, function (newMeshes) {
            const rootMesh = newMeshes.find(mesh => mesh.name === "__root__");
            if (rootMesh) {
                rootMesh.position = player_bonus1.position.clone();
                rootMesh.scaling = new BABYLON.Vector3(6, 6, 6);
                rootMesh.rotationQuaternion = BABYLON.Quaternion.FromEulerAngles(0, Math.PI, 0);
                rootMesh.metadata = { isPlayer_root_bonus1: true };
            }
            newMeshes.forEach(mesh => {
                if (mesh instanceof BABYLON.Mesh) {
                    mesh.rotationQuaternion = null;
                    mesh.rotation = new BABYLON.Vector3(Math.PI, 0, 0);
                }
            });
            const playerRepere = new BABYLON.MeshBuilder.CreateBox("playerRepere", {
                width: 10,
                height: 0.1,
                depth: 1,
            }, scene);
            playerRepere.position = new BABYLON.Vector3(-30, 301, -118);
            playerRepere.material = new BABYLON.StandardMaterial("playerRepereMat", scene);
            playerRepere.material.emissiveColor = new BABYLON.Color3.Red();
            playerRepere.metadata = { isPlayerRepere_bonus1: true };
            scene.registerBeforeRender(() => {
                rootMesh.position.x = player_bonus1.position.x;
                rootMesh.position.y = player_bonus1.position.y;
                rootMesh.position.z = player_bonus1.position.z;
                playerRepere.position.x = player_bonus1.position.x;
                playerRepere.position.y = player_bonus1.position.y;
            });
            setTimeout(() => {
                destroy_metadata_player1_bonus(scene);
            }, 10000);
        });
        setTimeout(() => {
            canUsePowerUP_player1 = true;
            console.log("PowerUP player 1 rechargé !");
        }, 20000);
        return player_bonus1;
    }
    return null;
}
export function init_Teammate_player_2(scene) {
    if (nb_powerUP_player_2 > 0 && canUsePowerUP_player2) {
        nb_powerUP_player_2--;
        canUsePowerUP_player2 = false;
        const player_bonus2 = BABYLON.MeshBuilder.CreateBox("player_bonus2", {
            width: 10,
            height: 1.5,
            depth: 1.5
        }, scene);
        player_bonus2.position = new BABYLON.Vector3(-7, 301, -26.5);
        player_bonus2.visibility = 0;
        player_bonus2.metadata = { isPlayer_bonus2: true };
        BABYLON.SceneLoader.ImportMesh("", "/srcs/game/assets/player/", "PlayerIdleAnnimation.glb", scene, function (newMeshes) {
            const playerModel = newMeshes[0];
            playerModel.position = player_bonus2.position.clone();
            playerModel.scaling = new BABYLON.Vector3(6, 6, 6);
            playerModel.rotation = new BABYLON.Vector3(0, Math.PI, 0);
            playerModel.metadata = { isPlayer_Model2: true };
            const playerRepere = new BABYLON.MeshBuilder.CreateBox("playerRepere", {
                width: 10,
                height: 0.1,
                depth: 1,
            }, scene);
            playerRepere.position = new BABYLON.Vector3(-7, 301, -26.5);
            playerRepere.material = new BABYLON.StandardMaterial("playerRepereMat", scene);
            playerRepere.material.emissiveColor = new BABYLON.Color3.Red();
            playerRepere.metadata = { isPlayerRepere2: true };
            scene.registerBeforeRender(() => {
                playerModel.position.x = player_bonus2.position.x;
                playerModel.position.y = player_bonus2.position.y;
                playerModel.position.z = player_bonus2.position.z;
                playerRepere.position.x = player_bonus2.position.x;
                playerRepere.position.y = player_bonus2.position.y;
            });
            setTimeout(() => {
                destroy_metadata_player2_bonus(scene);
            }, 15000);
        });
        setTimeout(() => {
            canUsePowerUP_player2 = true;
            console.log("PowerUP player 2 rechargé !");
        }, 25000);
        return player_bonus2;
    }
    return null;
}
function destroy_all_by_metadata(scene, metadataKey) {
    scene.meshes
        .filter(mesh => mesh.metadata && mesh.metadata[metadataKey])
        .forEach(mesh => mesh.dispose());
}
function destroy_metadata_player1_bonus(scene) {
    destroy_all_by_metadata(scene, "isPlayer_bonus1");
    destroy_all_by_metadata(scene, "isPlayer_root_bonus1");
    destroy_all_by_metadata(scene, "isPlayerRepere_bonus1");
}
function destroy_metadata_player2_bonus(scene) {
    destroy_all_by_metadata(scene, "isPlayer_bonus2");
    destroy_all_by_metadata(scene, "isPlayer_Model2");
    destroy_all_by_metadata(scene, "isPlayerRepere2");
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdF9wb3dlclVQX3RlYW1tYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHVibGljL3NyY3MvZ2FtZS9nYW1lcGxheS9zb2xvLzF2MV9wbGF5ZXIvaW5pdF9wb3dlclVQX3RlYW1tYXRlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUkscUJBQXFCLEdBQUcsSUFBSSxDQUFDO0FBQ2pDLElBQUkscUJBQXFCLEdBQUcsSUFBSSxDQUFDO0FBQ2pDLElBQUksbUJBQW1CLEdBQUcsQ0FBQyxDQUFDO0FBQzVCLElBQUksbUJBQW1CLEdBQUcsQ0FBQyxDQUFDO0FBRTVCLE1BQU0sVUFBVSx3QkFBd0IsQ0FBQyxNQUFNO0lBRTlDLG1CQUFtQixHQUFHLE1BQU0sQ0FBQztJQUM3QixtQkFBbUIsR0FBRyxNQUFNLENBQUM7QUFDOUIsQ0FBQztBQUVELE1BQU0sVUFBVSxzQkFBc0I7SUFFckMsbUJBQW1CLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLG1CQUFtQixHQUFHLENBQUMsQ0FBQztBQUN6QixDQUFDO0FBRUQsTUFBTSxVQUFVLHNCQUFzQixDQUFDLEtBQUs7SUFFM0MsSUFBSSxtQkFBbUIsR0FBRyxDQUFDLElBQUkscUJBQXFCLEVBQ3BELENBQUM7UUFDQSxtQkFBbUIsRUFBRSxDQUFDO1FBQ3RCLHFCQUFxQixHQUFHLEtBQUssQ0FBQztRQUM5QixNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxlQUFlLEVBQUU7WUFDcEUsS0FBSyxFQUFFLEVBQUU7WUFDVCxNQUFNLEVBQUUsR0FBRztZQUNYLEtBQUssRUFBRSxHQUFHO1NBQ1YsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUVWLGFBQWEsQ0FBQyxRQUFRLEdBQUcsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVELGFBQWEsQ0FBQyxVQUFV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QkFBdUIsQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztJQUN2RCx1QkFBdUIsQ0FBQyxLQUFLLEVBQUUsdUJBQXVCLENBQUMsQ0FBQztBQUN6RCxDQUFDO0FBRUQsU0FBUyw4QkFBOEIsQ0FBQyxLQUFLO0lBRTVDLHVCQUF1QixDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2xELHVCQUF1QixDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2xELHVCQUF1QixDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0FBQ25ELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgY2FuVXNlUG93ZXJVUF9wbGF5ZXIxID0gdHJ1ZTtcbmxldCBjYW5Vc2VQb3dlclVQX3BsYXllcjIgPSB0cnVlO1xubGV0IG5iX3Bvd2VyVVBfcGxheWVyXzEgPSAwO1xubGV0IG5iX3Bvd2VyVVBfcGxheWVyXzIgPSAwO1xuXG5leHBvcnQgZnVuY3Rpb24gaW5pdF9uYl9wb3dlclVQX3RlYW1tYXRlKG51bWJlcilcbntcblx0bmJfcG93ZXJVUF9wbGF5ZXJfMSA9IG51bWJlcjtcblx0bmJfcG93ZXJVUF9wbGF5ZXJfMiA9IG51bWJlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0X3Bvd2VyVVBfdGVhbW1hdGUoKVxue1xuXHRuYl9wb3dlclVQX3BsYXllcl8xID0gMDtcblx0bmJfcG93ZXJVUF9wbGF5ZXJfMiA9IDA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0X1RlYW1tYXRlX3BsYXllcl8xKHNjZW5lKVxue1xuXHRpZiAobmJfcG93ZXJVUF9wbGF5ZXJfMSA+IDAgJiYgY2FuVXNlUG93ZXJVUF9wbGF5ZXIxKVxuXHR7XG5cdFx0bmJfcG93ZXJVUF9wbGF5ZXJfMS0tO1xuXHRcdGNhblVzZVBvd2VyVVBfcGxheWVyMSA9IGZhbHNlO1xuXHRcdGNvbnN0IHBsYXllcl9ib251czEgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUJveChcInBsYXllcl9ib251czFcIiwge1xuXHRcdFx0d2lkdGg6IDEwLFxuXHRcdFx0aGVpZ2h0OiAxLjUsXG5cdFx0XHRkZXB0aDogMS41XG5cdFx0fSwgc2NlbmUpO1xuXHRcblx0XHRwbGF5ZXJfYm9udXMxLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygtNywgMzAxLCAtMTE4KTtcblx0XHRwbGF5ZXJfYm9udXMxLnZpc2liaWxpdHkgPSAwO1xuXHRcdHBsYXllcl9ib251czEubWV0YWRhdGEgPSB7IGlzUGxheWVyX2JvbnVzMTogdHJ1ZSB9O1xuXHRcblx0XHRpZiAocGxheWVyX2JvbnVzMSkge1xuXHRcdFx0Y29uc29sZS5sb2coXCJqZSByZW50cmUgbGFcIik7XG5cdFx0XHRjb25zb2xlLmxvZyhwbGF5ZXJfYm9udXMxLnBvc2l0aW9uKTtcblx0XHR9XG5cdFxuXHRcdEJBQllMT04uU2NlbmVMb2FkZXIuSW1wb3J0TWVzaChcIlwiLCBcIi9zcmNzL2dhbWUvYXNzZXRzL3BsYXllci9cIiwgXCJQbGF5ZXJJZGxlQW5uaW1hdGlvbi5nbGJcIiwgc2NlbmUsIGZ1bmN0aW9uIChuZXdNZXNoZXMpIHtcblx0XHRcdGNvbnN0IHJvb3RNZXNoID0gbmV3TWVzaGVzLmZpbmQobWVzaCA9PiBtZXNoLm5hbWUgPT09IFwiX19yb290X19cIik7XG5cdFx0XHRpZiAocm9vdE1lc2gpIHtcblx0XHRcdFx0cm9vdE1lc2gucG9zaXRpb24gPSBwbGF5ZXJfYm9udXMxLnBvc2l0aW9uLmNsb25lKCk7XG5cdFx0XHRcdHJvb3RNZXNoLnNjYWxpbmcgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDYsIDYsIDYpO1xuXHRcdFx0XHRyb290TWVzaC5yb3RhdGlvblF1YXRlcm5pb24gPSBCQUJZTE9OLlF1YXRlcm5pb24uRnJvbUV1bGVyQW5nbGVzKDAsIE1hdGguUEksIDApO1xuXHRcdFx0XHRyb290TWVzaC5tZXRhZGF0YSA9IHsgaXNQbGF5ZXJfcm9vdF9ib251czE6IHRydWUgfTtcblx0XHRcdH1cblx0XHRcblx0XHRcdG5ld01lc2hlcy5mb3JFYWNoKG1lc2ggPT4ge1xuXHRcdFx0XHRpZiAobWVzaCBpbnN0YW5jZW9mIEJBQllMT04uTWVzaCkge1xuXHRcdFx0XHRcdG1lc2gucm90YXRpb25RdWF0ZXJuaW9uID0gbnVsbDtcblx0XHRcdFx0XHRtZXNoLnJvdGF0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMyhNYXRoLlBJLCAwLCAwKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XG5cdFx0XHRjb25zdCBwbGF5ZXJSZXBlcmUgPSBuZXcgQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goXCJwbGF5ZXJSZXBlcmVcIiwge1xuXHRcdFx0XHR3aWR0aDogMTAsXG5cdFx0XHRcdGhlaWdodDogMC4xLFxuXHRcdFx0XHRkZXB0aDogMSxcblx0XHRcdH0sIHNjZW5lKTtcblx0XHRcdHBsYXllclJlcGVyZS5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTMwLCAzMDEsIC0xMTgpO1xuXHRcdFx0cGxheWVyUmVwZXJlLm1hdGVyaWFsID0gbmV3IEJBQllMT04uU3RhbmRhcmRNYXRlcmlhbChcInBsYXllclJlcGVyZU1hdFwiLCBzY2VuZSk7XG5cdFx0XHRwbGF5ZXJSZXBlcmUubWF0ZXJpYWwuZW1pc3NpdmVDb2xvciA9IG5ldyBCQUJZTE9OLkNvbG9yMy5SZWQoKTtcblx0XHRcdHBsYXllclJlcGVyZS5tZXRhZGF0YSA9IHsgaXNQbGF5ZXJSZXBlcmVfYm9udXMxOiB0cnVlIH07XG5cdFx0XHRzY2VuZS5yZWdpc3RlckJlZm9yZVJlbmRlcigoKSA9PiB7XG5cdFx0XHRcdHJvb3RNZXNoLnBvc2l0aW9uLnggPSBwbGF5ZXJfYm9udXMxLnBvc2l0aW9uLng7XG5cdFx0XHRcdHJvb3RNZXNoLnBvc2l0aW9uLnkgPSBwbGF5ZXJfYm9udXMxLnBvc2l0aW9uLnk7XG5cdFx0XHRcdHJvb3RNZXNoLnBvc2l0aW9uLnogPSBwbGF5ZXJfYm9udXMxLnBvc2l0aW9uLno7XG5cdFx0XHRcdHBsYXllclJlcGVyZS5wb3NpdGlvbi54ID0gcGxheWVyX2JvbnVzMS5wb3NpdGlvbi54O1xuXHRcdFx0XHRwbGF5ZXJSZXBlcmUucG9zaXRpb24ueSA9IHBsYXllcl9ib251czEucG9zaXRpb24ueTtcblx0XHRcdH0pO1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdGRlc3Ryb3lfbWV0YWRhdGFfcGxheWVyMV9ib251cyhzY2VuZSk7XG5cdFx0XHR9LCAxMDAwMCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRjYW5Vc2VQb3dlclVQX3BsYXllcjEgPSB0cnVlO1xuXHRcdFx0Y29uc29sZS5sb2coXCJQb3dlclVQIHBsYXllciAxIHJlY2hhcmfDqSAhXCIpO1xuXHRcdH0sIDIwMDAwKTtcblx0XHRcblx0XHRyZXR1cm4gcGxheWVyX2JvbnVzMTtcblx0fVxuXHRyZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRfVGVhbW1hdGVfcGxheWVyXzIoc2NlbmUpIHtcblx0aWYgKG5iX3Bvd2VyVVBfcGxheWVyXzIgPiAwICYmIGNhblVzZVBvd2VyVVBfcGxheWVyMikge1xuXHRcdG5iX3Bvd2VyVVBfcGxheWVyXzItLTtcblx0XHRjYW5Vc2VQb3dlclVQX3BsYXllcjIgPSBmYWxzZTtcblxuXHRcdGNvbnN0IHBsYXllcl9ib251czIgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUJveChcInBsYXllcl9ib251czJcIiwge1xuXHRcdFx0d2lkdGg6IDEwLFxuXHRcdFx0aGVpZ2h0OiAxLjUsXG5cdFx0XHRkZXB0aDogMS41XG5cdFx0fSwgc2NlbmUpO1xuXHRcdHBsYXllcl9ib251czIucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC03LCAzMDEsIC0yNi41KTtcblx0XHRwbGF5ZXJfYm9udXMyLnZpc2liaWxpdHkgPSAwO1xuXHRcdHBsYXllcl9ib251czIubWV0YWRhdGEgPSB7IGlzUGxheWVyX2JvbnVzMjogdHJ1ZSB9O1xuXG5cdFx0QkFCWUxPTi5TY2VuZUxvYWRlci5JbXBvcnRNZXNoKFwiXCIsIFwiL3NyY3MvZ2FtZS9hc3NldHMvcGxheWVyL1wiLCBcIlBsYXllcklkbGVBbm5pbWF0aW9uLmdsYlwiLCBzY2VuZSwgZnVuY3Rpb24gKG5ld01lc2hlcykge1xuXHRcdFx0Y29uc3QgcGxheWVyTW9kZWwgPSBuZXdNZXNoZXNbMF07XG5cdFx0XHRwbGF5ZXJNb2RlbC5wb3NpdGlvbiA9IHBsYXllcl9ib251czIucG9zaXRpb24uY2xvbmUoKTtcblx0XHRcdHBsYXllck1vZGVsLnNjYWxpbmcgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDYsIDYsIDYpO1xuXHRcdFx0cGxheWVyTW9kZWwucm90YXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIE1hdGguUEksIDApO1xuXHRcdFx0cGxheWVyTW9kZWwubWV0YWRhdGEgPSB7IGlzUGxheWVyX01vZGVsMjogdHJ1ZSB9O1xuXG5cdFx0XHRjb25zdCBwbGF5ZXJSZXBlcmUgPSBuZXcgQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goXCJwbGF5ZXJSZXBlcmVcIiwge1xuXHRcdFx0XHR3aWR0aDogMTAsXG5cdFx0XHRcdGhlaWdodDogMC4xLFxuXHRcdFx0XHRkZXB0aDogMSxcblx0XHRcdH0sIHNjZW5lKTtcblx0XHRcdHBsYXllclJlcGVyZS5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTcsIDMwMSwgLTI2LjUpO1xuXHRcdFx0cGxheWVyUmVwZXJlLm1hdGVyaWFsID0gbmV3IEJBQllMT04uU3RhbmRhcmRNYXRlcmlhbChcInBsYXllclJlcGVyZU1hdFwiLCBzY2VuZSk7XG5cdFx0XHRwbGF5ZXJSZXBlcmUubWF0ZXJpYWwuZW1pc3NpdmVDb2xvciA9IG5ldyBCQUJZTE9OLkNvbG9yMy5SZWQoKTtcblx0XHRcdHBsYXllclJlcGVyZS5tZXRhZGF0YSA9IHsgaXNQbGF5ZXJSZXBlcmUyOiB0cnVlIH07XG5cdFx0XHRcblx0XHRcdHNjZW5lLnJlZ2lzdGVyQmVmb3JlUmVuZGVyKCgpID0+IHtcblx0XHRcdFx0cGxheWVyTW9kZWwucG9zaXRpb24ueCA9IHBsYXllcl9ib251czIucG9zaXRpb24ueDtcblx0XHRcdFx0cGxheWVyTW9kZWwucG9zaXRpb24ueSA9IHBsYXllcl9ib251czIucG9zaXRpb24ueTtcblx0XHRcdFx0cGxheWVyTW9kZWwucG9zaXRpb24ueiA9IHBsYXllcl9ib251czIucG9zaXRpb24uejtcblx0XHRcdFx0cGxheWVyUmVwZXJlLnBvc2l0aW9uLnggPSBwbGF5ZXJfYm9udXMyLnBvc2l0aW9uLng7XG5cdFx0XHRcdHBsYXllclJlcGVyZS5wb3NpdGlvbi55ID0gcGxheWVyX2JvbnVzMi5wb3NpdGlvbi55O1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRkZXN0cm95X21ldGFkYXRhX3BsYXllcjJfYm9udXMoc2NlbmUpO1xuXHRcdFx0fSwgMTUwMDApO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0Y2FuVXNlUG93ZXJVUF9wbGF5ZXIyID0gdHJ1ZTtcblx0XHRcdGNvbnNvbGUubG9nKFwiUG93ZXJVUCBwbGF5ZXIgMiByZWNoYXJnw6kgIVwiKTtcblx0XHR9LCAyNTAwMCk7XG5cdFx0cmV0dXJuIHBsYXllcl9ib251czI7XG5cdH1cblx0cmV0dXJuIG51bGw7XG59XG5cblxuZnVuY3Rpb24gZGVzdHJveV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIG1ldGFkYXRhS2V5KSB7XG5cdHNjZW5lLm1lc2hlc1xuXHRcdC5maWx0ZXIobWVzaCA9PiBtZXNoLm1ldGFkYXRhICYmIG1lc2gubWV0YWRhdGFbbWV0YWRhdGFLZXldKVxuXHRcdC5mb3JFYWNoKG1lc2ggPT4gbWVzaC5kaXNwb3NlKCkpO1xufVxuXG5cbmZ1bmN0aW9uIGRlc3Ryb3lfbWV0YWRhdGFfcGxheWVyMV9ib251cyhzY2VuZSlcbntcblx0ZGVzdHJveV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIFwiaXNQbGF5ZXJfYm9udXMxXCIpO1xuXHRkZXN0cm95X2FsbF9ieV9tZXRhZGF0YShzY2VuZSwgXCJpc1BsYXllcl9yb290X2JvbnVzMVwiKTtcblx0ZGVzdHJveV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIFwiaXNQbGF5ZXJSZXBlcmVfYm9udXMxXCIpO1xufVxuXG5mdW5jdGlvbiBkZXN0cm95X21ldGFkYXRhX3BsYXllcjJfYm9udXMoc2NlbmUpXG57XG5cdGRlc3Ryb3lfYWxsX2J5X21ldGFkYXRhKHNjZW5lLCBcImlzUGxheWVyX2JvbnVzMlwiKTtcblx0ZGVzdHJveV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIFwiaXNQbGF5ZXJfTW9kZWwyXCIpO1xuXHRkZXN0cm95X2FsbF9ieV9tZXRhZGF0YShzY2VuZSwgXCJpc1BsYXllclJlcGVyZTJcIik7XG59Il19