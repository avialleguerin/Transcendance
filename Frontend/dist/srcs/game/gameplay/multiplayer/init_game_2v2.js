import { init_2v2_Players } from "./2v2_game/init_players2v2.js";
import { create_environment_view3, create_game, destroy_game } from "../init_game.js";
import { createBall, destroy_ball } from "../ball.js";
import { loadScoreModel, destroy_score } from "../score.js";
import { reset_player_pos_multi } from "./2v2_game/init_players2v2.js";
import { init_game } from "../init_game.js";
import { init_ball } from "../ball.js";
let gameStart = false;
let ball = null;
let is_init = false;
// Déclarer les variables de joueurs dans la portée du module
let player_1 = null;
let player_2 = null;
let player_3 = null;
let player_4 = null;
export async function init_game_multiplayer(scene) {
    if (!is_init) {
        console.log("init_game_multiplayer");
        create_game(scene);
        // Assignez les joueurs aux variables du module
        let players = init_2v2_Players(scene);
        player_1 = players[0];
        player_2 = players[1];
        player_3 = players[2];
        player_4 = players[3];
        ball = await createBall(scene).catch(error => {
            console.error(error);
            return null;
        });
        if (ball) {
            console.log("Balle chargée avec position :", ball.position);
        }
        loadScoreModel(0, "left", true);
        loadScoreModel(0, "right", false);
        is_init = true;
        return { player_1, player_2, player_3, player_4, ball };
    }
    else {
        console.log("init_game_multiplayer else");
        already_init();
        reset_player_pos_multi(player_1, player_2, player_3, player_4);
        return { player_1, player_2, player_3, player_4, ball };
    }
}
export function start_game_multiplayer(scene) {
    gameStart = true;
}
export function destroy_game_multiplayer(scene) {
    destroy_all_by_metadata(scene, "isPlayer_parent");
    destroy_all_by_metadata(scene, "isPlayer_paddle");
    destroy_all_by_metadata(scene, "isPlayerRepere");
    destroy_all_by_metadata(scene, "isPlayer");
    destroy_ball(ball);
    destroy_score();
    destroy_game(scene);
}
function already_init() {
    enable_all_by_metadata(scene, "isPlayer_parent");
    enable_all_by_metadata(scene, "isPlayer_paddle");
    enable_all_by_metadata(scene, "isPlayerRepere");
    enable_all_by_metadata(scene, "isPlayer");
    init_game(scene);
    init_ball(ball);
}
function enable_all_by_metadata(scene, metadataKey) {
    scene.meshes
        .filter(mesh => mesh.metadata && mesh.metadata[metadataKey])
        .forEach(mesh => mesh.setEnabled(true));
}
function destroy_all_by_metadata(scene, metadataKey) {
    scene.meshes
        .filter(mesh => mesh.metadata && mesh.metadata[metadataKey])
        .forEach(mesh => mesh.setEnabled(false));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdF9nYW1lXzJ2Mi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3B1YmxpYy9zcmNzL2dhbWUvZ2FtZXBsYXkvbXVsdGlwbGF5ZXIvaW5pdF9nYW1lXzJ2Mi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3JGLE9BQU8sRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsYUFBYSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQzVELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBRXZDLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztBQUN0QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7QUFDaEIsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDO0FBQ3BCLDZEQUE2RDtBQUM3RCxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFDcEIsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQ3BCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQztBQUNwQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFFcEIsTUFBTSxDQUFDLEtBQUssVUFBVSxxQkFBcUIsQ0FBQyxLQUFLO0lBRTdDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNYLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUNyQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFbkIsK0NBQStDO1FBQy9DLElB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VztJQUNsRCxLQUFLLENBQUMsTUFBTTtTQUNWLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUMzRCxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDM0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGluaXRfMnYyX1BsYXllcnMgfSBmcm9tIFwiLi8ydjJfZ2FtZS9pbml0X3BsYXllcnMydjIuanNcIjtcbmltcG9ydCB7IGNyZWF0ZV9lbnZpcm9ubWVudF92aWV3MywgY3JlYXRlX2dhbWUsIGRlc3Ryb3lfZ2FtZX0gZnJvbSBcIi4uL2luaXRfZ2FtZS5qc1wiO1xuaW1wb3J0IHsgY3JlYXRlQmFsbCwgZGVzdHJveV9iYWxsIH0gZnJvbSBcIi4uL2JhbGwuanNcIjtcbmltcG9ydCB7IGxvYWRTY29yZU1vZGVsLCBkZXN0cm95X3Njb3JlIH0gZnJvbSBcIi4uL3Njb3JlLmpzXCI7XG5pbXBvcnQgeyByZXNldF9wbGF5ZXJfcG9zX211bHRpIH0gZnJvbSBcIi4vMnYyX2dhbWUvaW5pdF9wbGF5ZXJzMnYyLmpzXCI7XG5pbXBvcnQgeyBpbml0X2dhbWUgfSBmcm9tIFwiLi4vaW5pdF9nYW1lLmpzXCI7XG5pbXBvcnQgeyBpbml0X2JhbGwgfSBmcm9tIFwiLi4vYmFsbC5qc1wiO1xuXG5sZXQgZ2FtZVN0YXJ0ID0gZmFsc2U7XG5sZXQgYmFsbCA9IG51bGw7XG5sZXQgaXNfaW5pdCA9IGZhbHNlO1xuLy8gRMOpY2xhcmVyIGxlcyB2YXJpYWJsZXMgZGUgam91ZXVycyBkYW5zIGxhIHBvcnTDqWUgZHUgbW9kdWxlXG5sZXQgcGxheWVyXzEgPSBudWxsO1xubGV0IHBsYXllcl8yID0gbnVsbDtcbmxldCBwbGF5ZXJfMyA9IG51bGw7XG5sZXQgcGxheWVyXzQgPSBudWxsO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdF9nYW1lX211bHRpcGxheWVyKHNjZW5lKSB7XG5cbiAgICBpZiAoIWlzX2luaXQpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJpbml0X2dhbWVfbXVsdGlwbGF5ZXJcIik7XG4gICAgICAgIGNyZWF0ZV9nYW1lKHNjZW5lKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFzc2lnbmV6IGxlcyBqb3VldXJzIGF1eCB2YXJpYWJsZXMgZHUgbW9kdWxlXG4gICAgICAgIGxldCBwbGF5ZXJzID0gaW5pdF8ydjJfUGxheWVycyhzY2VuZSk7XG4gICAgICAgIHBsYXllcl8xID0gcGxheWVyc1swXTtcbiAgICAgICAgcGxheWVyXzIgPSBwbGF5ZXJzWzFdO1xuICAgICAgICBwbGF5ZXJfMyA9IHBsYXllcnNbMl07XG4gICAgICAgIHBsYXllcl80ID0gcGxheWVyc1szXTtcbiAgICBcbiAgICAgICAgYmFsbCA9IGF3YWl0IGNyZWF0ZUJhbGwoc2NlbmUpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0pO1xuICAgIFxuICAgICAgICBpZiAoYmFsbCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJCYWxsZSBjaGFyZ8OpZSBhdmVjIHBvc2l0aW9uIDpcIiwgYmFsbC5wb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgbG9hZFNjb3JlTW9kZWwoMCwgXCJsZWZ0XCIsIHRydWUpO1xuICAgICAgICBsb2FkU2NvcmVNb2RlbCgwLCBcInJpZ2h0XCIsIGZhbHNlKTtcbiAgICAgICAgaXNfaW5pdCA9IHRydWU7XG4gICAgICAgIHJldHVybiB7IHBsYXllcl8xLCBwbGF5ZXJfMiwgcGxheWVyXzMsIHBsYXllcl80LCBiYWxsIH07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcImluaXRfZ2FtZV9tdWx0aXBsYXllciBlbHNlXCIpO1xuICAgICAgICBhbHJlYWR5X2luaXQoKTtcbiAgICAgICAgcmVzZXRfcGxheWVyX3Bvc19tdWx0aShwbGF5ZXJfMSwgcGxheWVyXzIsIHBsYXllcl8zLCBwbGF5ZXJfNCk7XG4gICAgICAgIHJldHVybiB7IHBsYXllcl8xLCBwbGF5ZXJfMiwgcGxheWVyXzMsIHBsYXllcl80LCBiYWxsIH07XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RhcnRfZ2FtZV9tdWx0aXBsYXllcihzY2VuZSkge1xuXHRnYW1lU3RhcnQgPSB0cnVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVzdHJveV9nYW1lX211bHRpcGxheWVyKHNjZW5lKSB7XG5cdGRlc3Ryb3lfYWxsX2J5X21ldGFkYXRhKHNjZW5lLCBcImlzUGxheWVyX3BhcmVudFwiKTtcblx0ZGVzdHJveV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIFwiaXNQbGF5ZXJfcGFkZGxlXCIpO1xuXHRkZXN0cm95X2FsbF9ieV9tZXRhZGF0YShzY2VuZSwgXCJpc1BsYXllclJlcGVyZVwiKTtcblx0ZGVzdHJveV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIFwiaXNQbGF5ZXJcIik7XG5cdGRlc3Ryb3lfYmFsbChiYWxsKTtcblx0ZGVzdHJveV9zY29yZSgpO1xuXHRkZXN0cm95X2dhbWUoc2NlbmUpO1xufVxuXG5mdW5jdGlvbiBhbHJlYWR5X2luaXQoKVxue1xuXHRlbmFibGVfYWxsX2J5X21ldGFkYXRhKHNjZW5lLCBcImlzUGxheWVyX3BhcmVudFwiKTtcblx0ZW5hYmxlX2FsbF9ieV9tZXRhZGF0YShzY2VuZSwgXCJpc1BsYXllcl9wYWRkbGVcIik7XG5cdGVuYWJsZV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIFwiaXNQbGF5ZXJSZXBlcmVcIik7XG5cdGVuYWJsZV9hbGxfYnlfbWV0YWRhdGEoc2NlbmUsIFwiaXNQbGF5ZXJcIik7XG5cdGluaXRfZ2FtZShzY2VuZSk7XG5cdGluaXRfYmFsbChiYWxsKTtcbn1cblxuZnVuY3Rpb24gZW5hYmxlX2FsbF9ieV9tZXRhZGF0YShzY2VuZSwgbWV0YWRhdGFLZXkpIHtcbiAgICBzY2VuZS5tZXNoZXNcbiAgICAgICAgLmZpbHRlcihtZXNoID0+IG1lc2gubWV0YWRhdGEgJiYgbWVzaC5tZXRhZGF0YVttZXRhZGF0YUtleV0pXG4gICAgICAgIC5mb3JFYWNoKG1lc2ggPT4gbWVzaC5zZXRFbmFibGVkKHRydWUpKTtcbn1cblxuXG5mdW5jdGlvbiBkZXN0cm95X2FsbF9ieV9tZXRhZGF0YShzY2VuZSwgbWV0YWRhdGFLZXkpIHtcblx0c2NlbmUubWVzaGVzXG5cdFx0LmZpbHRlcihtZXNoID0+IG1lc2gubWV0YWRhdGEgJiYgbWVzaC5tZXRhZGF0YVttZXRhZGF0YUtleV0pXG5cdFx0LmZvckVhY2gobWVzaCA9PiBtZXNoLnNldEVuYWJsZWQoZmFsc2UpKTtcbn0iXX0=