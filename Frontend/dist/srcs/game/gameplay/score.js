import { handleViewTransitions } from "./views/camera.js";
import { enable_skin_perso_player_first_and_second } from "./solo/skin/init_skin_player_podium.js";
import { getSoloGameStart, getMultiGameStart, getTournamentGameStart } from "./babylon.js";
import { enable_skin_multi_podium } from "./multiplayer/init_teamPlayer_podium.js";
let scoreLeft = 0;
let scoreRight = 0;
let scoreLeftMesh = null;
let scoreRightMesh = null;
let gameIsFinished = false;
let isPlayer1_win = false;
let isPlayer2_win = false;
let isTeam1_win = false;
let isTeam2_win = false;
export function getPlayer_1_win() {
    return isPlayer1_win;
}
export function getPlayer_2_win() {
    return isPlayer2_win;
}
export function loadScoreModel(score, isLeft) {
    if (isLeft && scoreLeftMesh)
        scoreLeftMesh.dispose();
    else if (!isLeft && scoreRightMesh)
        scoreRightMesh.dispose();
    BABYLON.SceneLoader.ImportMesh("", "/srcs/game/assets/score_object/", `3d_number_-_${score}_${getNumberWord(score)}.glb`, scene, function (newMeshes) {
        let rootMesh = null;
        newMeshes.forEach(mesh => {
            if (!mesh.parent) {
                rootMesh = mesh;
            }
        });
        if (rootMesh) {
            if (isLeft) {
                rootMesh.position = new BABYLON.Vector3(-65, 325, -80);
                scoreLeftMesh = rootMesh;
            }
            else {
                rootMesh.position = new BABYLON.Vector3(-65, 325, -65);
                scoreRightMesh = rootMesh;
            }
            rootMesh.scaling = new BABYLON.Vector3(10, 10, 10);
            rootMesh.rotation = new BABYLON.Vector3(0, -Math.PI / 2, 0);
        }
        else {
            let container = new BABYLON.TransformNode("scoreContainer", scene);
            newMeshes.forEach(mesh => {
                mesh.setParent(container);
            });
            if (isLeft) {
                container.position = new BABYLON.Vector3(-65, 325, -80);
                scoreLeftMesh = container;
            }
            else {
                container.position = new BABYLON.Vector3(-65, 325, -65);
                scoreRightMesh = container;
            }
            container.scaling = new BABYLON.Vector3(10, 10, 10);
            container.rotation = new BABYLON.Vector3(0, -Math.PI / 2, 0);
        }
    });
}
export function getNumberWord(number) {
    const words = ['zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
    return words[number] || 'zero';
}
export function updateScore(side) {
    let soloGameStart = getSoloGameStart();
    let multi_player_game = getMultiGameStart();
    let tournament_game = getTournamentGameStart();
    if (side === 'left') {
        scoreLeft++;
        if (scoreLeft > 9)
            scoreLeft = 0;
        loadScoreModel(scoreLeft, 'left', true);
    }
    else if (side === 'right') {
        scoreRight++;
        if (scoreRight > 9)
            scoreRight = 0;
        loadScoreModel(scoreRight, 'right', false);
    }
    if (soloGameStart) {
        if (scoreLeft === 1 || scoreRight === 1) {
            SetIsGameFinished(true);
            if (scoreLeft === 3) {
                isPlayer1_win = true;
                isPlayer2_win = false;
            }
            else {
                isPlayer1_win = false;
                isPlayer2_win = true;
            }
            handleViewTransitions('winner', true);
            enable_skin_perso_player_first_and_second();
        }
    }
    else if (multi_player_game) {
        if (scoreLeft === 1 || scoreRight === 1) {
            SetIsGameFinished(true);
            if (scoreLeft === 3) {
                isTeam1_win = true;
                isTeam2_win = false;
            }
            else {
                isTeam1_win = false;
                isTeam2_win = true;
            }
            handleViewTransitions('winner', true);
            enable_skin_multi_podium();
        }
    }
    else if (tournament_game) {
        if (scoreLeft === 1 || scoreRight === 1) {
            SetIsGameFinished(true);
            if (scoreLeft === 1) {
                isPlayer1_win = true;
                isPlayer2_win = false;
            }
            else {
                isPlayer1_win = false;
                isPlayer2_win = true;
            }
        }
    }
}
export function resetScore() {
    scoreLeft = 0;
    scoreRight = 0;
}
export function destroy_score() {
    if (scoreLeftMesh) {
        scoreLeftMesh.dispose();
    }
    if (scoreRightMesh) {
        scoreRightMesh.dispose();
    }
    resetScore();
    scoreLeftMesh = null;
    scoreRightMesh = null;
}
export function initScoreDisplay() {
    loadScoreModel(scoreLeft, 'left', true);
    loadScoreModel(scoreRight, 'right', false);
}
export function isGameFinished() {
    return gameIsFinished;
}
export function SetIsGameFinished(value) {
    gameIsFinished = value;
}
export function getIsTeam1Win() {
    return isTeam1_win;
}
export function getIsTeam2Win() {
    return isTeam2_win;
}
export { gameIsFinished };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wdWJsaWMvc3Jjcy9nYW1lL2dhbWVwbGF5L3Njb3JlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzFELE9BQU8sRUFBRSx5Q0FBeUMsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ25HLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxpQkFBaUIsRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMzRixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUduRixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFDbEIsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBQ25CLElBQUksYUFBYSxHQUFHLElBQUksQ0FBQztBQUN6QixJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUM7QUFDMUIsSUFBSSxjQUFjLEdBQUcsS0FBSyxDQUFDO0FBRTNCLElBQUksYUFBYSxHQUFHLEtBQUssQ0FBQztBQUMxQixJQUFJLGFBQWEsR0FBRyxLQUFLLENBQUM7QUFFMUIsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDO0FBQ3hCLElBQUksV0FBVyxHQUFHLEtBQUssQ0FBQztBQUV4QixNQUFNLFVBQVUsZUFBZTtJQUM5QixPQUFPLGFBQWEsQ0FBQztBQUN0QixDQUFDO0FBRUQsTUFBTSxVQUFVLGVBQWU7SUFDOUIsT0FBTyxhQUFhLENBQUM7QUFDdEIsQ0FBQztBQUVELE1BQU0sVUFBVSxjQUFjLENBQUMsS0FBSyxFQUFFLE1BQU07SUFFM0MsSUFBSSxNQUFNLElBQUksYUFBYTtRQUMxQixhQUFhLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDcEIsSUFBSSxDQUFDLE1BQU0sSUFBSSxjQUFjO1FBQ2pDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUUxQixPQUFPLENBQUMsV0FBVyxDQUFD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QUFjLEdBQUcsSUFBSSxDQUFDO0FBQ3ZCLENBQUM7QUFFRCxNQUFNLFVBQVUsZ0JBQWdCO0lBQy9CLGNBQWMsQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3hDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVDLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYztJQUM3QixPQUFPLGNBQWMsQ0FBQztBQUN2QixDQUFDO0FBRUQsTUFBTSxVQUFVLGlCQUFpQixDQUFDLEtBQUs7SUFDdEMsY0FBYyxHQUFHLEtBQUssQ0FBQztBQUN4QixDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWE7SUFDNUIsT0FBTyxXQUFXLENBQUM7QUFDcEIsQ0FBQztBQUVELE1BQU0sVUFBVSxhQUFhO0lBQzVCLE9BQU8sV0FBVyxDQUFDO0FBQ3BCLENBQUM7QUFHRCxPQUFPLEVBQUUsY0FBYyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBoYW5kbGVWaWV3VHJhbnNpdGlvbnMgfSBmcm9tIFwiLi92aWV3cy9jYW1lcmEuanNcIjtcbmltcG9ydCB7IGVuYWJsZV9za2luX3BlcnNvX3BsYXllcl9maXJzdF9hbmRfc2Vjb25kIH0gZnJvbSBcIi4vc29sby9za2luL2luaXRfc2tpbl9wbGF5ZXJfcG9kaXVtLmpzXCI7XG5pbXBvcnQgeyBnZXRTb2xvR2FtZVN0YXJ0LCBnZXRNdWx0aUdhbWVTdGFydCwgZ2V0VG91cm5hbWVudEdhbWVTdGFydCB9IGZyb20gXCIuL2JhYnlsb24uanNcIjtcbmltcG9ydCB7IGVuYWJsZV9za2luX211bHRpX3BvZGl1bSB9IGZyb20gXCIuL211bHRpcGxheWVyL2luaXRfdGVhbVBsYXllcl9wb2RpdW0uanNcIjtcblxuXG5sZXQgc2NvcmVMZWZ0ID0gMDtcbmxldCBzY29yZVJpZ2h0ID0gMDtcbmxldCBzY29yZUxlZnRNZXNoID0gbnVsbDtcbmxldCBzY29yZVJpZ2h0TWVzaCA9IG51bGw7XG5sZXQgZ2FtZUlzRmluaXNoZWQgPSBmYWxzZTtcblxubGV0IGlzUGxheWVyMV93aW4gPSBmYWxzZTtcbmxldCBpc1BsYXllcjJfd2luID0gZmFsc2U7XG5cbmxldCBpc1RlYW0xX3dpbiA9IGZhbHNlO1xubGV0IGlzVGVhbTJfd2luID0gZmFsc2U7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQbGF5ZXJfMV93aW4oKSB7XG5cdHJldHVybiBpc1BsYXllcjFfd2luO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGxheWVyXzJfd2luKCkge1xuXHRyZXR1cm4gaXNQbGF5ZXIyX3dpbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRTY29yZU1vZGVsKHNjb3JlLCBpc0xlZnQpXG57XG5cdGlmIChpc0xlZnQgJiYgc2NvcmVMZWZ0TWVzaClcblx0XHRzY29yZUxlZnRNZXNoLmRpc3Bvc2UoKTtcblx0ZWxzZSBpZiAoIWlzTGVmdCAmJiBzY29yZVJpZ2h0TWVzaClcblx0XHRzY29yZVJpZ2h0TWVzaC5kaXNwb3NlKCk7XG5cblx0QkFCWUxPTi5TY2VuZUxvYWRlci5JbXBvcnRNZXNoKFxuXHRcdFwiXCIsXG5cdFx0XCIvc3Jjcy9nYW1lL2Fzc2V0cy9zY29yZV9vYmplY3QvXCIsXG5cdFx0YDNkX251bWJlcl8tXyR7c2NvcmV9XyR7Z2V0TnVtYmVyV29yZChzY29yZSl9LmdsYmAsXG5cdFx0c2NlbmUsXG5cdFx0ZnVuY3Rpb24gKG5ld01lc2hlcylcblx0XHR7XG5cdFx0XHRsZXQgcm9vdE1lc2ggPSBudWxsO1xuXHRcdFx0bmV3TWVzaGVzLmZvckVhY2gobWVzaCA9PlxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoIW1lc2gucGFyZW50KVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cm9vdE1lc2ggPSBtZXNoO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHJvb3RNZXNoKVxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoaXNMZWZ0KVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cm9vdE1lc2gucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC02NSwgMzI1LCAtODApO1xuXHRcdFx0XHRcdHNjb3JlTGVmdE1lc2ggPSByb290TWVzaDtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRyb290TWVzaC5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTY1LCAzMjUsIC02NSk7XG5cdFx0XHRcdFx0c2NvcmVSaWdodE1lc2ggPSByb290TWVzaDtcblx0XHRcdFx0fVxuXHRcdFx0XHRyb290TWVzaC5zY2FsaW5nID0gbmV3IEJBQllMT04uVmVjdG9yMygxMCwgMTAsIDEwKTtcblx0XHRcdFx0cm9vdE1lc2gucm90YXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIC1NYXRoLlBJLzIsIDApO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgY29udGFpbmVyID0gbmV3IEJBQllMT04uVHJhbnNmb3JtTm9kZShcInNjb3JlQ29udGFpbmVyXCIsIHNjZW5lKTtcblx0XHRcdFx0bmV3TWVzaGVzLmZvckVhY2gobWVzaCA9PiB7XG5cdFx0XHRcdFx0bWVzaC5zZXRQYXJlbnQoY29udGFpbmVyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZiAoaXNMZWZ0KSB7XG5cdFx0XHRcdFx0Y29udGFpbmVyLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygtNjUsIDMyNSwgLTgwKTtcblx0XHRcdFx0XHRzY29yZUxlZnRNZXNoID0gY29udGFpbmVyO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnRhaW5lci5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTY1LCAzMjUsIC02NSk7XG5cdFx0XHRcdFx0c2NvcmVSaWdodE1lc2ggPSBjb250YWluZXI7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGNvbnRhaW5lci5zY2FsaW5nID0gbmV3IEJBQllMT04uVmVjdG9yMygxMCwgMTAsIDEwKTtcblx0XHRcdFx0Y29udGFpbmVyLnJvdGF0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygwLCAtTWF0aC5QSS8yLCAwKTtcblx0XHRcdH1cblx0XHR9XG5cdCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXROdW1iZXJXb3JkKG51bWJlcikge1xuXHRjb25zdCB3b3JkcyA9IFsnemVybycsICdvbmUnLCAndHdvJywgJ3RocmVlJywgJ2ZvdXInLCAnZml2ZScsICdzaXgnLCAnc2V2ZW4nLCAnZWlnaHQnLCAnbmluZSddO1xuXHRyZXR1cm4gd29yZHNbbnVtYmVyXSB8fCAnemVybyc7XG59XG5cblxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlU2NvcmUoc2lkZSlcbntcblx0bGV0IHNvbG9HYW1lU3RhcnQgPSBnZXRTb2xvR2FtZVN0YXJ0KCk7XG5cdGxldCBtdWx0aV9wbGF5ZXJfZ2FtZSA9IGdldE11bHRpR2FtZVN0YXJ0KCk7XG5cdGxldCB0b3VybmFtZW50X2dhbWUgPSBnZXRUb3VybmFtZW50R2FtZVN0YXJ0KCk7XG5cdGlmIChzaWRlID09PSAnbGVmdCcpXG5cdHtcblx0XHRzY29yZUxlZnQrKztcblx0XHRpZiAoc2NvcmVMZWZ0ID4gOSlcblx0XHRcdHNjb3JlTGVmdCA9IDA7XG5cdFx0bG9hZFNjb3JlTW9kZWwoc2NvcmVMZWZ0LCAnbGVmdCcsIHRydWUpO1xuXHR9IGVsc2UgaWYgKHNpZGUgPT09ICdyaWdodCcpXG5cdHtcblx0XHRzY29yZVJpZ2h0Kys7XG5cdFx0aWYgKHNjb3JlUmlnaHQgPiA5KVxuXHRcdFx0c2NvcmVSaWdodCA9IDA7XG5cdFx0bG9hZFNjb3JlTW9kZWwoc2NvcmVSaWdodCwgJ3JpZ2h0JywgZmFsc2UpO1xuXHR9XG5cdGlmIChzb2xvR2FtZVN0YXJ0KVxuXHR7XG5cdFx0aWYgKHNjb3JlTGVmdCA9PT0gMSB8fCBzY29yZVJpZ2h0ID09PSAxKSB7XG5cdFx0XHRTZXRJc0dhbWVGaW5pc2hlZCh0cnVlKTtcblx0XHRcdGlmIChzY29yZUxlZnQgPT09IDMpXG5cdFx0XHR7XG5cdFx0XHRcdGlzUGxheWVyMV93aW4gPSB0cnVlO1xuXHRcdFx0XHRpc1BsYXllcjJfd2luID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdGlzUGxheWVyMV93aW4gPSBmYWxzZTtcblx0XHRcdFx0aXNQbGF5ZXIyX3dpbiA9IHRydWU7XG5cdFx0XHR9XG5cdFx0XHRoYW5kbGVWaWV3VHJhbnNpdGlvbnMoJ3dpbm5lcicsIHRydWUpO1xuXHRcdFx0ZW5hYmxlX3NraW5fcGVyc29fcGxheWVyX2ZpcnN0X2FuZF9zZWNvbmQoKTtcblx0XHR9XG5cdH1cblx0ZWxzZSBpZiAobXVsdGlfcGxheWVyX2dhbWUpXG5cdHtcblx0XHRpZiAoc2NvcmVMZWZ0ID09PSAxIHx8IHNjb3JlUmlnaHQgPT09IDEpIHtcblx0XHRcdFNldElzR2FtZUZpbmlzaGVkKHRydWUpO1xuXHRcdFx0aWYgKHNjb3JlTGVmdCA9PT0gMylcblx0XHRcdHtcblx0XHRcdFx0aXNUZWFtMV93aW4gPSB0cnVlO1xuXHRcdFx0XHRpc1RlYW0yX3dpbiA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHRpc1RlYW0xX3dpbiA9IGZhbHNlO1xuXHRcdFx0XHRpc1RlYW0yX3dpbiA9IHRydWU7XG5cdFx0XHR9XG5cdFx0XHRoYW5kbGVWaWV3VHJhbnNpdGlvbnMoJ3dpbm5lcicsIHRydWUpO1xuXHRcdFx0ZW5hYmxlX3NraW5fbXVsdGlfcG9kaXVtKCk7XG5cdFx0fVxuXHR9XG5cdGVsc2UgaWYgKHRvdXJuYW1lbnRfZ2FtZSlcblx0e1xuXHRcdGlmIChzY29yZUxlZnQgPT09IDEgfHwgc2NvcmVSaWdodCA9PT0gMSkge1xuXHRcdFx0U2V0SXNHYW1lRmluaXNoZWQodHJ1ZSk7XG5cdFx0XHRpZiAoc2NvcmVMZWZ0ID09PSAxKVxuXHRcdFx0e1xuXHRcdFx0XHRpc1BsYXllcjFfd2luID0gdHJ1ZTtcblx0XHRcdFx0aXNQbGF5ZXIyX3dpbiA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHRpc1BsYXllcjFfd2luID0gZmFsc2U7XG5cdFx0XHRcdGlzUGxheWVyMl93aW4gPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzZXRTY29yZSgpIHtcblx0c2NvcmVMZWZ0ID0gMDtcblx0c2NvcmVSaWdodCA9IDA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXN0cm95X3Njb3JlKCkge1xuXHRpZiAoc2NvcmVMZWZ0TWVzaCkge1xuXHRcdHNjb3JlTGVmdE1lc2guZGlzcG9zZSgpO1xuXHR9XG5cdGlmIChzY29yZVJpZ2h0TWVzaCkge1xuXHRcdHNjb3JlUmlnaHRNZXNoLmRpc3Bvc2UoKTtcblx0fVxuXG5cdHJlc2V0U2NvcmUoKTtcblxuXHRzY29yZUxlZnRNZXNoID0gbnVsbDtcblx0c2NvcmVSaWdodE1lc2ggPSBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdFNjb3JlRGlzcGxheSgpIHtcblx0bG9hZFNjb3JlTW9kZWwoc2NvcmVMZWZ0LCAnbGVmdCcsIHRydWUpO1xuXHRsb2FkU2NvcmVNb2RlbChzY29yZVJpZ2h0LCAncmlnaHQnLCBmYWxzZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0dhbWVGaW5pc2hlZCgpIHtcblx0cmV0dXJuIGdhbWVJc0ZpbmlzaGVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gU2V0SXNHYW1lRmluaXNoZWQodmFsdWUpIHtcblx0Z2FtZUlzRmluaXNoZWQgPSB2YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldElzVGVhbTFXaW4oKSB7XG5cdHJldHVybiBpc1RlYW0xX3dpbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldElzVGVhbTJXaW4oKSB7ICBcblx0cmV0dXJuIGlzVGVhbTJfd2luO1xufVxuXG5cbmV4cG9ydCB7IGdhbWVJc0ZpbmlzaGVkIH07Il19