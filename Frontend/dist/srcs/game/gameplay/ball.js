import { updateScore } from "./score.js";
import { init_Teammate_player_1 } from "./solo/1v1_player/init_powerUP_teammate.js";
import { init_Teammate_player_2 } from "./solo/1v1_player/init_powerUP_teammate.js";
const FIELD_LEFT = -40;
const FIELD_RIGHT = 25;
const FIELD_TOP = -14;
const FIELD_BOTTOM = -130;
const BALL_RADIUS = 1;
const PADDLE_WIDTH = 10;
const PADDLE_HEIGHT = 1.5;
const PADDLE_DEPTH = 1.5;
export function createBall(scene) {
    if (!scene) {
        console.error('Scene is not defined');
        return;
    }
    return new Promise((resolve, reject) => {
        BABYLON.SceneLoader.ImportMesh("", "/srcs/game/assets/3d_object/", "soccer_ball__football (3).glb", scene, function (newMeshes, particleSystems, skeletons, animationGroups) {
            console.log("Modèle chargé avec succès !");
            let rootMesh = null;
            newMeshes.forEach(mesh => {
                if (!mesh.parent) {
                    rootMesh = mesh;
                }
            });
            if (rootMesh) {
                let ball = rootMesh;
                ball.position = new BABYLON.Vector3(-7, 300.8, -72.5);
                ball.scaling = new BABYLON.Vector3(10, 10, 10);
                let ballCollisionBox = BABYLON.MeshBuilder.CreateBox("ballCollisionBox", {
                    width: BALL_RADIUS * 2,
                    height: BALL_RADIUS * 2,
                    depth: BALL_RADIUS * 2
                }, scene);
                ballCollisionBox.isPickable = false;
                ballCollisionBox.visibility = 0;
                ballCollisionBox.parent = ball;
                resolve(ball);
            }
            else {
                reject("Impossible de trouver le root mesh de la balle.");
            }
        }, null, function (message) {
            reject(`Erreur lors du chargement du modèle: ${message}`);
        });
    });
}
function resetBall(ball) {
    ball.position = new BABYLON.Vector3(-7, 300.8, -72.5);
    ballSpeed = 0.7;
    ballDirection = getRandomDirection();
}
let ballSpeed = 0.7;
function getRandomDirection() {
    let x = Math.random() * 2 - 1;
    let z = Math.random() * 2 - 1;
    const length = Math.sqrt(x * x + z * z);
    x /= length;
    z /= length;
    if (Math.abs(x) < 0.3)
        x = x > 0 ? 0.3 : -0.3;
    if (Math.abs(z) < 0.3)
        z = z > 0 ? 0.3 : -0.3;
    return { x, z };
}
let ballDirection = getRandomDirection();
export function MoveBall(player_1, player_2, ball, player_1_bonus, player_2_bonus) {
    if (!ball) {
        return;
    }
    if (!player_1 || !player_2) {
        return;
    }
    const BALL_RADIUS = 1.5;
    ball.position.x += ballDirection.x * ballSpeed;
    ball.position.z += ballDirection.z * ballSpeed;
    ball.rotate(BABYLON.Axis.X, 0.1 * ballSpeed);
    ball.rotate(BABYLON.Axis.Z, 0.1 * ballDirection.x * ballSpeed);
    if (ball.position.z <= FIELD_BOTTOM + BALL_RADIUS) {
        ball.position.z = FIELD_BOTTOM + BALL_RADIUS;
        resetBall(ball);
        updateScore('right');
    }
    if (ball.position.z >= FIELD_TOP - BALL_RADIUS) {
        ball.position.z = FIELD_TOP - BALL_RADIUS;
        resetBall(ball);
        updateScore('left');
    }
    if (ball.position.x <= FIELD_LEFT + BALL_RADIUS) {
        ball.position.x = FIELD_LEFT + BALL_RADIUS;
        ballDirection.x *= -1;
    }
    if (ball.position.x >= FIELD_RIGHT - BALL_RADIUS) {
        ball.position.x = FIELD_RIGHT - BALL_RADIUS;
        ballDirection.x *= -1;
    }
    if (ball.position.x + BALL_RADIUS >= player_1.position.x - PADDLE_WIDTH / 2 &&
        ball.position.x - BALL_RADIUS <= player_1.position.x + PADDLE_WIDTH / 2 &&
        ball.position.z + BALL_RADIUS >= player_1.position.z - PADDLE_HEIGHT / 2 &&
        ball.position.z - BALL_RADIUS <= player_1.position.z + PADDLE_HEIGHT / 2) {
        ballDirection.x *= -1;
        const relativeImpact = (ball.position.z - player_1.position.z) / (PADDLE_HEIGHT / 2);
        const MAX_ANGLE_FACTOR = 0.8;
        ballDirection.z = relativeImpact * MAX_ANGLE_FACTOR;
        const length = Math.sqrt(ballDirection.x * ballDirection.x + ballDirection.z * ballDirection.z);
        ballDirection.x /= length;
        ballDirection.z /= length;
        ballSpeed += 0.05;
        ball.position.x += ballDirection.x * 0.1;
    }
    if (ball.position.x + BALL_RADIUS >= player_2.position.x - PADDLE_WIDTH / 2 &&
        ball.position.x - BALL_RADIUS <= player_2.position.x + PADDLE_WIDTH / 2 &&
        ball.position.z + BALL_RADIUS >= player_2.position.z - PADDLE_HEIGHT / 2 &&
        ball.position.z - BALL_RADIUS <= player_2.position.z + PADDLE_HEIGHT / 2) {
        ballDirection.x *= -1;
        const relativeImpact = (ball.position.z - player_2.position.z) / (PADDLE_HEIGHT / 2);
        const MAX_ANGLE_FACTOR = 0.8;
        ballDirection.z = relativeImpact * MAX_ANGLE_FACTOR;
        const length = Math.sqrt(ballDirection.x * ballDirection.x + ballDirection.z * ballDirection.z);
        ballDirection.x /= length;
        ballDirection.z /= length;
        ballSpeed += 0.05;
        ball.position.x += ballDirection.x * 0.1;
    }
    if (player_1_bonus) {
        if (ball.position.x + BALL_RADIUS >= player_1_bonus.position.x - PADDLE_WIDTH / 2 &&
            ball.position.x - BALL_RADIUS <= player_1_bonus.position.x + PADDLE_WIDTH / 2 &&
            ball.position.z + BALL_RADIUS >= player_1_bonus.position.z - PADDLE_HEIGHT / 2 &&
            ball.position.z - BALL_RADIUS <= player_1_bonus.position.z + PADDLE_HEIGHT / 2) {
            const relativeImpact = (ball.position.z - player_1_bonus.position.z) / (PADDLE_HEIGHT / 2);
            ballDirection.z = relativeImpact * 1;
            ballSpeed += 0.01;
        }
    }
    if (player_2_bonus) {
        if (ball.position.x + BALL_RADIUS >= player_2_bonus.position.x - PADDLE_WIDTH / 2 &&
            ball.position.x - BALL_RADIUS <= player_2_bonus.position.x + PADDLE_WIDTH / 2 &&
            ball.position.z + BALL_RADIUS >= player_2_bonus.position.z - PADDLE_HEIGHT / 2 &&
            ball.position.z - BALL_RADIUS <= player_2_bonus.position.z + PADDLE_HEIGHT / 2) {
            const relativeImpact = (ball.position.z - player_2_bonus.position.z) / (PADDLE_HEIGHT / 2);
            ballDirection.z = relativeImpact * 1;
            ballSpeed += 0.01;
        }
    }
}
export function MoveBall2v2(player_1, player_2, player_3, player_4, ball) {
    if (!ball)
        return;
    if (!player_1 || !player_2 || !player_3 || !player_4)
        return;
    const BALL_RADIUS = 1.5;
    const PADDLE_WIDTH = 10;
    const PADDLE_HEIGHT = 1.5;
    const PADDLE_DEPTH = 1.5;
    ball.position.x += ballDirection.x * ballSpeed;
    ball.position.z += ballDirection.z * ballSpeed;
    ball.rotate(BABYLON.Axis.X, 0.1 * ballSpeed);
    ball.rotate(BABYLON.Axis.Z, 0.1 * ballDirection.x * ballSpeed);
    if (ball.position.z <= FIELD_BOTTOM + BALL_RADIUS) {
        ball.position.z = FIELD_BOTTOM + BALL_RADIUS;
        resetBall(ball);
        updateScore('right');
    }
    if (ball.position.z >= FIELD_TOP - BALL_RADIUS) {
        ball.position.z = FIELD_TOP - BALL_RADIUS;
        resetBall(ball);
        updateScore('left');
    }
    if (ball.position.x <= FIELD_LEFT + BALL_RADIUS) {
        ball.position.x = FIELD_LEFT + BALL_RADIUS;
        ballDirection.x *= -1;
    }
    if (ball.position.x >= FIELD_RIGHT - BALL_RADIUS) {
        ball.position.x = FIELD_RIGHT - BALL_RADIUS;
        ballDirection.x *= -1;
    }
    checkPaddleCollision(player_1.leftPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
    checkPaddleCollision(player_1.rightPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
    checkPaddleCollision(player_2.leftPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
    checkPaddleCollision(player_2.rightPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
    checkPaddleCollision(player_3.leftPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
    checkPaddleCollision(player_3.rightPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
    checkPaddleCollision(player_4.leftPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
    checkPaddleCollision(player_4.rightPaddle, ball, BALL_RADIUS, PADDLE_WIDTH);
}
function checkPaddleCollision(paddle, ball, BALL_RADIUS, PADDLE_WIDTH) {
    if (!paddle)
        return;
    const paddleWorldPosition = paddle.getAbsolutePosition();
    if (ball.position.x + BALL_RADIUS >= paddleWorldPosition.x - PADDLE_WIDTH / 2 &&
        ball.position.x - BALL_RADIUS <= paddleWorldPosition.x + PADDLE_WIDTH / 2 &&
        ball.position.z + BALL_RADIUS >= paddleWorldPosition.z - PADDLE_DEPTH / 2 &&
        ball.position.z - BALL_RADIUS <= paddleWorldPosition.z + PADDLE_DEPTH / 2) {
        // const relativeImpact = (ball.position.z - paddleWorldPosition.z) / (PADDLE_DEPTH / 2);
        // ballDirection.x *= -1;
        // ballDirection.z = relativeImpact * 1;
        // ballSpeed += 0.01;
        ballDirection.x *= -1;
        const relativeImpact = (ball.position.z - paddleWorldPosition.z) / (PADDLE_DEPTH / 2);
        const MAX_ANGLE_FACTOR = 0.8;
        ballDirection.z = relativeImpact * MAX_ANGLE_FACTOR;
        const length = Math.sqrt(ballDirection.x * ballDirection.x + ballDirection.z * ballDirection.z);
        ballDirection.x /= length;
        ballDirection.z /= length;
        ballSpeed += 0.05;
        ball.position.x += ballDirection.x * 0.1;
    }
}
export function destroy_ball(ball) {
    if (!ball)
        return;
    if (ball)
        ball.setEnabled(false);
    ball = null;
}
export function init_ball(ball) {
    if (ball)
        ball.setEnabled(true);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFsbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3B1YmxpYy9zcmNzL2dhbWUvZ2FtZXBsYXkvYmFsbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBRXBGLE1BQU0sVUFBVSxHQUFHLENBQUMsRUFBRSxDQUFDO0FBQ3ZCLE1BQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQztBQUN2QixNQUFNLFNBQVMsR0FBRyxDQUFDLEVBQUUsQ0FBQztBQUN0QixNQUFNLFlBQVksR0FBRyxDQUFDLEdBQUcsQ0FBQztBQUMxQixNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUM7QUFDdEIsTUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDO0FBQ3hCLE1BQU0sYUFBYSxHQUFHLEdBQUcsQ0FBQztBQUMxQixNQUFNLFlBQVksR0FBRyxHQUFHLENBQUM7QUFFekIsTUFBTSxVQUFVLFVBQVUsQ0FBQyxLQUFLO0lBQy9CLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUN0QyxPQUFPO0lBQ1IsQ0FBQztJQUVELE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDdEMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLDhCQUE4QixFQUFFLCtCQUErQixFQUFFLEtBQUssRUFBRSxVQUFVLFNBQVMsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLGVBQWU7WUFDMUssT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1lBRTNDLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQztZQUNw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UUFDMUIsYUFBYSxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUM7UUFDMUIsU0FBUyxJQUFJLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxhQUFhLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztJQUMxQyxDQUFDO0FBQ0YsQ0FBQztBQUVELE1BQU0sVUFBVSxZQUFZLENBQUMsSUFBSTtJQUVoQyxJQUFJLENBQUMsSUFBSTtRQUNSLE9BQU87SUFDUixJQUFJLElBQUk7UUFDUCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hCLElBQUksR0FBRyxJQUFJLENBQUM7QUFDYixDQUFDO0FBRUQsTUFBTSxVQUFVLFNBQVMsQ0FBQyxJQUFJO0lBRTdCLElBQUksSUFBSTtRQUNQLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDeEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVwZGF0ZVNjb3JlIH0gZnJvbSBcIi4vc2NvcmUuanNcIjtcbmltcG9ydCB7IGluaXRfVGVhbW1hdGVfcGxheWVyXzEgfSBmcm9tIFwiLi9zb2xvLzF2MV9wbGF5ZXIvaW5pdF9wb3dlclVQX3RlYW1tYXRlLmpzXCI7XG5pbXBvcnQgeyBpbml0X1RlYW1tYXRlX3BsYXllcl8yIH0gZnJvbSBcIi4vc29sby8xdjFfcGxheWVyL2luaXRfcG93ZXJVUF90ZWFtbWF0ZS5qc1wiO1xuXG5jb25zdCBGSUVMRF9MRUZUID0gLTQwO1xuY29uc3QgRklFTERfUklHSFQgPSAyNTtcbmNvbnN0IEZJRUxEX1RPUCA9IC0xNDtcbmNvbnN0IEZJRUxEX0JPVFRPTSA9IC0xMzA7XG5jb25zdCBCQUxMX1JBRElVUyA9IDE7XG5jb25zdCBQQURETEVfV0lEVEggPSAxMDtcbmNvbnN0IFBBRERMRV9IRUlHSFQgPSAxLjU7XG5jb25zdCBQQURETEVfREVQVEggPSAxLjU7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCYWxsKHNjZW5lKSB7XG5cdGlmICghc2NlbmUpIHtcblx0XHRjb25zb2xlLmVycm9yKCdTY2VuZSBpcyBub3QgZGVmaW5lZCcpO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0QkFCWUxPTi5TY2VuZUxvYWRlci5JbXBvcnRNZXNoKFwiXCIsIFwiL3NyY3MvZ2FtZS9hc3NldHMvM2Rfb2JqZWN0L1wiLCBcInNvY2Nlcl9iYWxsX19mb290YmFsbCAoMykuZ2xiXCIsIHNjZW5lLCBmdW5jdGlvbiAobmV3TWVzaGVzLCBwYXJ0aWNsZVN5c3RlbXMsIHNrZWxldG9ucywgYW5pbWF0aW9uR3JvdXBzKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhcIk1vZMOobGUgY2hhcmfDqSBhdmVjIHN1Y2PDqHMgIVwiKTtcblxuXHRcdFx0bGV0IHJvb3RNZXNoID0gbnVsbDtcblx0XHRcdG5ld01lc2hlcy5mb3JFYWNoKG1lc2ggPT4ge1xuXHRcdFx0XHRpZiAoIW1lc2gucGFyZW50KSB7XG5cdFx0XHRcdFx0cm9vdE1lc2ggPSBtZXNoO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHJvb3RNZXNoKSB7XG5cdFx0XHRcdGxldCBiYWxsID0gcm9vdE1lc2g7XG5cdFx0XHRcdGJhbGwucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC03LCAzMDAuOCwgLTcyLjUpO1xuXHRcdFx0XHRiYWxsLnNjYWxpbmcgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDEwLCAxMCwgMTApO1xuXHRcdFx0XHRcblx0XHRcdFx0bGV0IGJhbGxDb2xsaXNpb25Cb3ggPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUJveChcImJhbGxDb2xsaXNpb25Cb3hcIiwge1xuXHRcdFx0XHRcdHdpZHRoOiBCQUxMX1JBRElVUyAqIDIsXG5cdFx0XHRcdFx0aGVpZ2h0OiBCQUxMX1JBRElVUyAqIDIsXG5cdFx0XHRcdFx0ZGVwdGg6IEJBTExfUkFESVVTICogMlxuXHRcdFx0XHR9LCBzY2VuZSk7XG5cdFx0XHRcdGJhbGxDb2xsaXNpb25Cb3guaXNQaWNrYWJsZSA9IGZhbHNlO1xuXHRcdFx0XHRiYWxsQ29sbGlzaW9uQm94LnZpc2liaWxpdHkgPSAwO1xuXHRcdFx0XHRiYWxsQ29sbGlzaW9uQm94LnBhcmVudCA9IGJhbGw7XG5cblx0XHRcdFx0cmVzb2x2ZShiYWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJlamVjdChcIkltcG9zc2libGUgZGUgdHJvdXZlciBsZSByb290IG1lc2ggZGUgbGEgYmFsbGUuXCIpO1xuXHRcdFx0fVxuXHRcdH0sIG51bGwsIGZ1bmN0aW9uIChtZXNzYWdlKSB7XG5cdFx0XHRyZWplY3QoYEVycmV1ciBsb3JzIGR1IGNoYXJnZW1lbnQgZHUgbW9kw6hsZTogJHttZXNzYWdlfWApO1xuXHRcdH0pO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gcmVzZXRCYWxsKGJhbGwpIHsgXG5cdGJhbGwucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC03LCAzMDAuOCwgLTcyLjUpO1xuXHRiYWxsU3BlZWQgPSAwLjc7XG5cdGJhbGxEaXJlY3Rpb24gPSBnZXRSYW5kb21EaXJlY3Rpb24oKTtcbn1cblxubGV0IGJhbGxTcGVlZCA9IDAuNztcblxuZnVuY3Rpb24gZ2V0UmFuZG9tRGlyZWN0aW9uKClcbntcblx0bGV0IHggPSBNYXRoLnJhbmRvbSgpICogMiAtIDE7XG5cdGxldCB6ID0gTWF0aC5yYW5kb20oKSAqIDIgLSAxO1xuXHRcblx0Y29uc3QgbGVuZ3RoID0gTWF0aC5zcXJ0KHggKiB4ICsgeiAqIHopO1xuXHR4IC89IGxlbmd0aDtcblx0eiAvPSBsZW5ndGg7XG5cblx0aWYgKE1hdGguYWJzKHgpIDwgMC4zKSB4ID0geCA+IDAgPyAwLjMgOiAtMC4zO1xuXHRpZiAoTWF0aC5hYnMoeikgPCAwLjMpIHogPSB6ID4gMCA/IDAuMyA6IC0wLjM7XG5cdHJldHVybiB7IHgsIHogfTtcbn1cblxubGV0IGJhbGxEaXJlY3Rpb24gPSBnZXRSYW5kb21EaXJlY3Rpb24oKTtcblxuXG5cbmV4cG9ydCBmdW5jdGlvbiBNb3ZlQmFsbChwbGF5ZXJfMSwgcGxheWVyXzIsIGJhbGwsIHBsYXllcl8xX2JvbnVzLCBwbGF5ZXJfMl9ib251cykge1xuXG5cdGlmICghYmFsbClcblx0e1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGlmICghcGxheWVyXzEgfHwgIXBsYXllcl8yKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Y29uc3QgQkFMTF9SQURJVVMgPSAxLjU7XG5cblx0YmFsbC5wb3NpdGlvbi54ICs9IGJhbGxEaXJlY3Rpb24ueCAqIGJhbGxTcGVlZDtcblx0YmFsbC5wb3NpdGlvbi56ICs9IGJhbGxEaXJlY3Rpb24ueiAqIGJhbGxTcGVlZDtcblxuXHRiYWxsLnJvdGF0ZShCQUJZTE9OLkF4aXMuWCwgMC4xICogYmFsbFNwZWVkKTtcblx0YmFsbC5yb3RhdGUoQkFCWUxPTi5BeGlzLlosIDAuMSAqIGJhbGxEaXJlY3Rpb24ueCAqIGJhbGxTcGVlZCk7XG5cblx0aWYgKGJhbGwucG9zaXRpb24ueiA8PSBGSUVMRF9CT1RUT00gKyBCQUxMX1JBRElVUykge1xuXHRcdGJhbGwucG9zaXRpb24ueiA9IEZJRUxEX0JPVFRPTSArIEJBTExfUkFESVVTO1xuXHRcdHJlc2V0QmFsbChiYWxsKTtcblx0XHR1cGRhdGVTY29yZSgncmlnaHQnKTtcblx0fVxuXG5cdGlmIChiYWxsLnBvc2l0aW9uLnogPj0gRklFTERfVE9QIC0gQkFMTF9SQURJVVMpIHtcblx0XHRiYWxsLnBvc2l0aW9uLnogPSBGSUVMRF9UT1AgLSBCQUxMX1JBRElVUztcblx0XHRyZXNldEJhbGwoYmFsbCk7XG5cdFx0dXBkYXRlU2NvcmUoJ2xlZnQnKTtcblx0fVxuXG5cdGlmIChiYWxsLnBvc2l0aW9uLnggPD0gRklFTERfTEVGVCArIEJBTExfUkFESVVTKSB7XG5cdFx0YmFsbC5wb3NpdGlvbi54ID0gRklFTERfTEVGVCArIEJBTExfUkFESVVTO1xuXHRcdGJhbGxEaXJlY3Rpb24ueCAqPSAtMTtcblx0fVxuXG5cdGlmIChiYWxsLnBvc2l0aW9uLnggPj0gRklFTERfUklHSFQgLSBCQUxMX1JBRElVUykge1xuXHRcdGJhbGwucG9zaXRpb24ueCA9IEZJRUxEX1JJR0hUIC0gQkFMTF9SQURJVVM7XG5cdFx0YmFsbERpcmVjdGlvbi54ICo9IC0xO1xuXHR9XG5cblx0aWYgKGJhbGwucG9zaXRpb24ueCArIEJBTExfUkFESVVTID49IHBsYXllcl8xLnBvc2l0aW9uLnggLSBQQURETEVfV0lEVEggLyAyICYmXG5cdFx0YmFsbC5wb3NpdGlvbi54IC0gQkFMTF9SQURJVVMgPD0gcGxheWVyXzEucG9zaXRpb24ueCArIFBBRERMRV9XSURUSCAvIDIgJiZcblx0XHRiYWxsLnBvc2l0aW9uLnogKyBCQUxMX1JBRElVUyA+PSBwbGF5ZXJfMS5wb3NpdGlvbi56IC0gUEFERExFX0hFSUdIVCAvIDIgJiZcblx0XHRiYWxsLnBvc2l0aW9uLnogLSBCQUxMX1JBRElVUyA8PSBwbGF5ZXJfMS5wb3NpdGlvbi56ICsgUEFERExFX0hFSUdIVCAvIDIpIHtcblxuXHRcdGJhbGxEaXJlY3Rpb24ueCAqPSAtMTsgXG5cdFx0Y29uc3QgcmVsYXRpdmVJbXBhY3QgPSAoYmFsbC5wb3NpdGlvbi56IC0gcGxheWVyXzEucG9zaXRpb24ueikgLyAoUEFERExFX0hFSUdIVCAvIDIpO1xuXHRcdGNvbnN0IE1BWF9BTkdMRV9GQUNUT1IgPSAwLjg7XG5cdFx0YmFsbERpcmVjdGlvbi56ID0gcmVsYXRpdmVJbXBhY3QgKiBNQVhfQU5HTEVfRkFDVE9SO1xuXHRcdGNvbnN0IGxlbmd0aCA9IE1hdGguc3FydChiYWxsRGlyZWN0aW9uLnggKiBiYWxsRGlyZWN0aW9uLnggKyBiYWxsRGlyZWN0aW9uLnogKiBiYWxsRGlyZWN0aW9uLnopO1xuXHRcdGJhbGxEaXJlY3Rpb24ueCAvPSBsZW5ndGg7XG5cdFx0YmFsbERpcmVjdGlvbi56IC89IGxlbmd0aDtcblx0XHRiYWxsU3BlZWQgKz0gMC4wNTtcblx0XHRiYWxsLnBvc2l0aW9uLnggKz0gYmFsbERpcmVjdGlvbi54ICogMC4xO1xuXHR9XG5cblx0aWYgKGJhbGwucG9zaXRpb24ueCArIEJBTExfUkFESVVTID49IHBsYXllcl8yLnBvc2l0aW9uLnggLSBQQURETEVfV0lEVEggLyAyICYmXG5cdFx0YmFsbC5wb3NpdGlvbi54IC0gQkFMTF9SQURJVVMgPD0gcGxheWVyXzIucG9zaXRpb24ueCArIFBBRERMRV9XSURUSCAvIDIgJiZcblx0XHRiYWxsLnBvc2l0aW9uLnogKyBCQUxMX1JBRElVUyA+PSBwbGF5ZXJfMi5wb3NpdGlvbi56IC0gUEFERExFX0hFSUdIVCAvIDIgJiZcblx0XHRiYWxsLnBvc2l0aW9uLnogLSBCQUxMX1JBRElVUyA8PSBwbGF5ZXJfMi5wb3NpdGlvbi56ICsgUEFERExFX0hFSUdIVCAvIDIpIHtcblx0XHRiYWxsRGlyZWN0aW9uLnggKj0gLTE7XG5cdFx0Y29uc3QgcmVsYXRpdmVJbXBhY3QgPSAoYmFsbC5wb3NpdGlvbi56IC0gcGxheWVyXzIucG9zaXRpb24ueikgLyAoUEFERExFX0hFSUdIVCAvIDIpO1xuXHRcdGNvbnN0IE1BWF9BTkdMRV9GQUNUT1IgPSAwLjg7XG5cdFx0YmFsbERpcmVjdGlvbi56ID0gcmVsYXRpdmVJbXBhY3QgKiBNQVhfQU5HTEVfRkFDVE9SO1xuXHRcdGNvbnN0IGxlbmd0aCA9IE1hdGguc3FydChiYWxsRGlyZWN0aW9uLnggKiBiYWxsRGlyZWN0aW9uLnggKyBiYWxsRGlyZWN0aW9uLnogKiBiYWxsRGlyZWN0aW9uLnopO1xuXHRcdGJhbGxEaXJlY3Rpb24ueCAvPSBsZW5ndGg7XG5cdFx0YmFsbERpcmVjdGlvbi56IC89IGxlbmd0aDtcblx0XHRiYWxsU3BlZWQgKz0gMC4wNTtcblx0XHRiYWxsLnBvc2l0aW9uLnggKz0gYmFsbERpcmVjdGlvbi54ICogMC4xO1xuXHR9XG5cblx0aWYgKHBsYXllcl8xX2JvbnVzKVxuXHR7XG5cdFx0aWYgKGJhbGwucG9zaXRpb24ueCArIEJBTExfUkFESVVTID49IHBsYXllcl8xX2JvbnVzLnBvc2l0aW9uLnggLSBQQURETEVfV0lEVEggLyAyICYmXG5cdFx0XHRiYWxsLnBvc2l0aW9uLnggLSBCQUxMX1JBRElVUyA8PSBwbGF5ZXJfMV9ib251cy5wb3NpdGlvbi54ICsgUEFERExFX1dJRFRIIC8gMiAmJlxuXHRcdFx0YmFsbC5wb3NpdGlvbi56ICsgQkFMTF9SQURJVVMgPj0gcGxheWVyXzFfYm9udXMucG9zaXRpb24ueiAtIFBBRERMRV9IRUlHSFQgLyAyICYmXG5cdFx0XHRiYWxsLnBvc2l0aW9uLnogLSBCQUxMX1JBRElVUyA8PSBwbGF5ZXJfMV9ib251cy5wb3NpdGlvbi56ICsgUEFERExFX0hFSUdIVCAvIDIpIHtcblx0XHRcdGNvbnN0IHJlbGF0aXZlSW1wYWN0ID0gKGJhbGwucG9zaXRpb24ueiAtIHBsYXllcl8xX2JvbnVzLnBvc2l0aW9uLnopIC8gKFBBRERMRV9IRUlHSFQgLyAyKTtcblx0XHRcdGJhbGxEaXJlY3Rpb24ueiA9IHJlbGF0aXZlSW1wYWN0ICogMTtcblx0XHRcdGJhbGxTcGVlZCArPSAwLjAxO1xuXHRcdH1cblx0fVxuXG5cdGlmIChwbGF5ZXJfMl9ib251cylcblx0e1xuXHRcdGlmIChiYWxsLnBvc2l0aW9uLnggKyBCQUxMX1JBRElVUyA+PSBwbGF5ZXJfMl9ib251cy5wb3NpdGlvbi54IC0gUEFERExFX1dJRFRIIC8gMiAmJlxuXHRcdFx0YmFsbC5wb3NpdGlvbi54IC0gQkFMTF9SQURJVVMgPD0gcGxheWVyXzJfYm9udXMucG9zaXRpb24ueCArIFBBRERMRV9XSURUSCAvIDIgJiZcblx0XHRcdGJhbGwucG9zaXRpb24ueiArIEJBTExfUkFESVVTID49IHBsYXllcl8yX2JvbnVzLnBvc2l0aW9uLnogLSBQQURETEVfSEVJR0hUIC8gMiAmJlxuXHRcdFx0YmFsbC5wb3NpdGlvbi56IC0gQkFMTF9SQURJVVMgPD0gcGxheWVyXzJfYm9udXMucG9zaXRpb24ueiArIFBBRERMRV9IRUlHSFQgLyAyKSB7XG5cdFx0XHRjb25zdCByZWxhdGl2ZUltcGFjdCA9IChiYWxsLnBvc2l0aW9uLnogLSBwbGF5ZXJfMl9ib251cy5wb3NpdGlvbi56KSAvIChQQURETEVfSEVJR0hUIC8gMik7XG5cdFx0XHRiYWxsRGlyZWN0aW9uLnogPSByZWxhdGl2ZUltcGFjdCAqIDE7XG5cdFx0XHRiYWxsU3BlZWQgKz0gMC4wMTtcblx0XHR9XG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIE1vdmVCYWxsMnYyKHBsYXllcl8xLCBwbGF5ZXJfMiwgcGxheWVyXzMsIHBsYXllcl80LCBiYWxsKVxue1xuXHRpZiAoIWJhbGwpXG5cdFx0cmV0dXJuO1xuXG5cdGlmICghcGxheWVyXzEgfHwgIXBsYXllcl8yIHx8ICFwbGF5ZXJfMyB8fCAhcGxheWVyXzQpXG5cdFx0cmV0dXJuO1xuXG5cdGNvbnN0IEJBTExfUkFESVVTID0gMS41O1xuXHRjb25zdCBQQURETEVfV0lEVEggPSAxMDtcblx0Y29uc3QgUEFERExFX0hFSUdIVCA9IDEuNTtcblx0Y29uc3QgUEFERExFX0RFUFRIID0gMS41O1xuXG5cdGJhbGwucG9zaXRpb24ueCArPSBiYWxsRGlyZWN0aW9uLnggKiBiYWxsU3BlZWQ7XG5cdGJhbGwucG9zaXRpb24ueiArPSBiYWxsRGlyZWN0aW9uLnogKiBiYWxsU3BlZWQ7XG5cblx0YmFsbC5yb3RhdGUoQkFCWUxPTi5BeGlzLlgsIDAuMSAqIGJhbGxTcGVlZCk7XG5cdGJhbGwucm90YXRlKEJBQllMT04uQXhpcy5aLCAwLjEgKiBiYWxsRGlyZWN0aW9uLnggKiBiYWxsU3BlZWQpO1xuXG5cdGlmIChiYWxsLnBvc2l0aW9uLnogPD0gRklFTERfQk9UVE9NICsgQkFMTF9SQURJVVMpIHtcblx0XHRiYWxsLnBvc2l0aW9uLnogPSBGSUVMRF9CT1RUT00gKyBCQUxMX1JBRElVUztcblx0XHRyZXNldEJhbGwoYmFsbCk7XG5cdFx0dXBkYXRlU2NvcmUoJ3JpZ2h0Jyk7XG5cdH1cblxuXHRpZiAoYmFsbC5wb3NpdGlvbi56ID49IEZJRUxEX1RPUCAtIEJBTExfUkFESVVTKSB7XG5cdFx0YmFsbC5wb3NpdGlvbi56ID0gRklFTERfVE9QIC0gQkFMTF9SQURJVVM7XG5cdFx0cmVzZXRCYWxsKGJhbGwpO1xuXHRcdHVwZGF0ZVNjb3JlKCdsZWZ0Jyk7XG5cdH1cblxuXHRpZiAoYmFsbC5wb3NpdGlvbi54IDw9IEZJRUxEX0xFRlQgKyBCQUxMX1JBRElVUykge1xuXHRcdGJhbGwucG9zaXRpb24ueCA9IEZJRUxEX0xFRlQgKyBCQUxMX1JBRElVUztcblx0XHRiYWxsRGlyZWN0aW9uLnggKj0gLTE7XG5cdH1cblxuXHRpZiAoYmFsbC5wb3NpdGlvbi54ID49IEZJRUxEX1JJR0hUIC0gQkFMTF9SQURJVVMpIHtcblx0XHRiYWxsLnBvc2l0aW9uLnggPSBGSUVMRF9SSUdIVCAtIEJBTExfUkFESVVTO1xuXHRcdGJhbGxEaXJlY3Rpb24ueCAqPSAtMTtcblx0fVxuXG5cdGNoZWNrUGFkZGxlQ29sbGlzaW9uKHBsYXllcl8xLmxlZnRQYWRkbGUsIGJhbGwsIEJBTExfUkFESVVTLCBQQURETEVfV0lEVEgpO1xuXHRjaGVja1BhZGRsZUNvbGxpc2lvbihwbGF5ZXJfMS5yaWdodFBhZGRsZSwgYmFsbCwgQkFMTF9SQURJVVMsIFBBRERMRV9XSURUSCk7XG5cdFxuXHRjaGVja1BhZGRsZUNvbGxpc2lvbihwbGF5ZXJfMi5sZWZ0UGFkZGxlLCBiYWxsLCBCQUxMX1JBRElVUywgUEFERExFX1dJRFRIKTtcblx0Y2hlY2tQYWRkbGVDb2xsaXNpb24ocGxheWVyXzIucmlnaHRQYWRkbGUsIGJhbGwsIEJBTExfUkFESVVTLCBQQURETEVfV0lEVEgpO1xuXHRcblx0Y2hlY2tQYWRkbGVDb2xsaXNpb24ocGxheWVyXzMubGVmdFBhZGRsZSwgYmFsbCwgQkFMTF9SQURJVVMsIFBBRERMRV9XSURUSCk7XG5cdGNoZWNrUGFkZGxlQ29sbGlzaW9uKHBsYXllcl8zLnJpZ2h0UGFkZGxlLCBiYWxsLCBCQUxMX1JBRElVUywgUEFERExFX1dJRFRIKTtcblx0XG5cdGNoZWNrUGFkZGxlQ29sbGlzaW9uKHBsYXllcl80LmxlZnRQYWRkbGUsIGJhbGwsIEJBTExfUkFESVVTLCBQQURETEVfV0lEVEgpO1xuXHRjaGVja1BhZGRsZUNvbGxpc2lvbihwbGF5ZXJfNC5yaWdodFBhZGRsZSwgYmFsbCwgQkFMTF9SQURJVVMsIFBBRERMRV9XSURUSCk7XG59XG5cbmZ1bmN0aW9uIGNoZWNrUGFkZGxlQ29sbGlzaW9uKHBhZGRsZSwgYmFsbCwgQkFMTF9SQURJVVMsIFBBRERMRV9XSURUSClcbntcblx0aWYgKCFwYWRkbGUpXG5cdFx0cmV0dXJuO1xuXG5cdGNvbnN0IHBhZGRsZVdvcmxkUG9zaXRpb24gPSBwYWRkbGUuZ2V0QWJzb2x1dGVQb3NpdGlvbigpO1xuXHRcblx0aWYgKGJhbGwucG9zaXRpb24ueCArIEJBTExfUkFESVVTID49IHBhZGRsZVdvcmxkUG9zaXRpb24ueCAtIFBBRERMRV9XSURUSCAvIDIgJiZcblx0XHRiYWxsLnBvc2l0aW9uLnggLSBCQUxMX1JBRElVUyA8PSBwYWRkbGVXb3JsZFBvc2l0aW9uLnggKyBQQURETEVfV0lEVEggLyAyICYmXG5cdFx0YmFsbC5wb3NpdGlvbi56ICsgQkFMTF9SQURJVVMgPj0gcGFkZGxlV29ybGRQb3NpdGlvbi56IC0gUEFERExFX0RFUFRIIC8gMiAmJlxuXHRcdGJhbGwucG9zaXRpb24ueiAtIEJBTExfUkFESVVTIDw9IHBhZGRsZVdvcmxkUG9zaXRpb24ueiArIFBBRERMRV9ERVBUSCAvIDIpXG5cdHtcblx0XHQvLyBjb25zdCByZWxhdGl2ZUltcGFjdCA9IChiYWxsLnBvc2l0aW9uLnogLSBwYWRkbGVXb3JsZFBvc2l0aW9uLnopIC8gKFBBRERMRV9ERVBUSCAvIDIpO1xuXG5cdFx0Ly8gYmFsbERpcmVjdGlvbi54ICo9IC0xO1xuXHRcdC8vIGJhbGxEaXJlY3Rpb24ueiA9IHJlbGF0aXZlSW1wYWN0ICogMTtcblxuXHRcdC8vIGJhbGxTcGVlZCArPSAwLjAxO1xuXHRcdGJhbGxEaXJlY3Rpb24ueCAqPSAtMTtcblx0XHRjb25zdCByZWxhdGl2ZUltcGFjdCA9IChiYWxsLnBvc2l0aW9uLnogLSBwYWRkbGVXb3JsZFBvc2l0aW9uLnopIC8gKFBBRERMRV9ERVBUSCAvIDIpO1xuXHRcdGNvbnN0IE1BWF9BTkdMRV9GQUNUT1IgPSAwLjg7XG5cdFx0YmFsbERpcmVjdGlvbi56ID0gcmVsYXRpdmVJbXBhY3QgKiBNQVhfQU5HTEVfRkFDVE9SO1xuXHRcdGNvbnN0IGxlbmd0aCA9IE1hdGguc3FydChiYWxsRGlyZWN0aW9uLnggKiBiYWxsRGlyZWN0aW9uLnggKyBiYWxsRGlyZWN0aW9uLnogKiBiYWxsRGlyZWN0aW9uLnopO1xuXHRcdGJhbGxEaXJlY3Rpb24ueCAvPSBsZW5ndGg7XG5cdFx0YmFsbERpcmVjdGlvbi56IC89IGxlbmd0aDtcblx0XHRiYWxsU3BlZWQgKz0gMC4wNTtcblx0XHRiYWxsLnBvc2l0aW9uLnggKz0gYmFsbERpcmVjdGlvbi54ICogMC4xO1xuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXN0cm95X2JhbGwoYmFsbClcbntcblx0aWYgKCFiYWxsKVxuXHRcdHJldHVybjtcblx0aWYgKGJhbGwpXG5cdFx0YmFsbC5zZXRFbmFibGVkKGZhbHNlKTtcblx0YmFsbCA9IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0X2JhbGwoYmFsbClcbntcblx0aWYgKGJhbGwpXG5cdFx0YmFsbC5zZXRFbmFibGVkKHRydWUpO1xufSJdfQ==