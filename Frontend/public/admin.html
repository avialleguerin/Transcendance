<!-- public/admin.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Admin - Gestion des Users</title>
	<!-- Chargement de Tailwind CSS via le CDN remote -->
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
	<script src="http://localhost:35729/livereload.js"></script>
	<header class="bg-blue-600 text-white p-4">
		<div class="container mx-auto">
			<h1 class="text-3xl font-bold">Administration - Gestion des Users</h1>
		</div>
	</header>

	<main class="container mx-auto p-4">
		<h2 class="text-xl font-semibold mb-4">Liste des Utilisateurs</h2>
		<table class="min-w-full bg-white shadow-md rounded">
			<thead>
				<tr>
					<th class="px-4 py-2 border">ID</th>
					<th class="px-4 py-2 border">Nom</th>
					<th class="px-4 py-2 border">Email</th>
					<th class="px-4 py-2 border">Actions</th>
				</tr>
			</thead>
			<tbody id="users-table">
				<!-- Les utilisateurs seront insérés ici dynamiquement -->
			</tbody>
		</table>
	</main>

	<script>
		async function fetchUsers() {
			try {
				const response = await fetch('/users');
				const users = await response.json();
				const tbody = document.getElementById('users-table');
				tbody.innerHTML = '';
				users.forEach(user => {
					const tr = document.createElement('tr');
					tr.innerHTML = `
						<td class="border px-4 py-2">${user.id}</td>
						<td class="border px-4 py-2">${user.username}</td>
						<td class="border px-4 py-2">${user.email}</td>
						<td class="border px-4 py-2">
							<button class="bg-red-500 text-white px-2 py-1 rounded" onclick="unregister(${user.id})">Supprimer</button>
						</td>
					`;
					tbody.appendChild(tr);
				});
			} catch (err) {
				console.error('Erreur lors de la récupération des utilisateurs :', err);
			}
		}

		async function unregister(id) {
			if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
				try {
					const response = await fetch(`/users/${id}`, { method: 'DELETE' });
					if (response.ok) {
						alert('Utilisateur supprimé avec succès.');
						fetchUsers();
					} else {
						const error = await response.json();
						alert('Erreur : ' + error.error);
					}
				} catch (err) {
					console.error('Erreur lors de la suppression :', err);
				}
			}
		}

		// Charger la liste des utilisateurs lors du chargement de la page
		window.addEventListener('DOMContentLoaded', fetchUsers);
	</script>



	<form id="userForm" class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg">
		<h2 class="text-2xl font-semibold text-center mb-4">Ajouter un utilisateur</h2>

		<div class="mb-4">
				<label for="username" class="block text-gray-700 font-medium">Nom :</label>
				<input type="text" id="username" name="username" placeholder="Nom"
						class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
						required>
		</div>

		<div class="mb-4">
				<label for="email" class="block text-gray-700 font-medium">Email :</label>
				<input type="email" id="email" name="email" placeholder="Email"
						class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
						required>
		</div>

		<button type="submit"
				class="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition">
				Ajouter
		</button>

		<p id="resultMessage" class="mt-4 text-center text-sm font-semibold text-gray-700"></p>
	</form>


	<script>
			document.getElementById("userForm").addEventListener("submit", async function (event) {
					event.preventDefault(); // Empêche le rechargement de la page

					const username = document.getElementById("username").value;
					const email = document.getElementById("email").value;

					const response = await fetch("/add-user", {
							method: "POST",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify({ username, email })
					});

					const result = await response.json();
					const resultMessage = document.getElementById("resultMessage");

					if (result.success) {
							resultMessage.textContent = `Utilisateur ajouté : ${result.username} (${result.email})`;
							resultMessage.classList.add("text-green-500");

							setTimeout(() => {
									location.reload(); // Rafraîchit la page après 1 seconde
							}, 300);
					} else {
							resultMessage.textContent = "Erreur : " + result.message;
							resultMessage.classList.add("text-red-500");
					}
			});


	</script>

	 <!-- Inclusion du script externe -->
	<!-- <script src="/utils/admin.js"></script> -->
</body>
</html>
